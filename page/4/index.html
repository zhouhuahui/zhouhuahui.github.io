<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <meta name="renderer" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=edge" >
  <link rel="dns-prefetch" href="https://zhouhuahui.github.io">
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="https://zhouhuahui.github.io/page/4/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="fantasy">
<meta name="twitter:card" content="summary">
  
    <link rel="alternative" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="stylesheet" type="text/css" href="/./main.0cf68a.css">
  <style type="text/css">
  
    #container.show {
      background: linear-gradient(200deg,#a0cfe4,#e8c37e);
    }
  </style>
  

  

<meta name="generator" content="Hexo 5.4.0"></head>

<body>
  <div id="container" q-class="show:isCtnShow">
    <canvas id="anm-canvas" class="anm-canvas"></canvas>
    <div class="left-col" q-class="show:isShow">
      
<div class="overlay" style="background: #4d4d4d"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			<img src="http://localhost:4000/1000/10/10/images/shanna.jpg" class="js-avatar">
		</a>
		<hgroup>
		  <h1 class="header-author"><a href="/"></a></h1>
		</hgroup>
		

		<nav class="header-menu">
			<ul>
			
				<li><a href="/">主页</a></li>
	        
				<li><a href="/tags/%E9%9A%8F%E7%AC%94/">随笔</a></li>
	        
			</ul>
		</nav>
		<nav class="header-smart-menu">
    		
    			
    			<a q-on="click: openSlider(e, 'innerArchive')" href="javascript:void(0)">所有文章</a>
    			
            
    			
    			<a q-on="click: openSlider(e, 'friends')" href="javascript:void(0)">友链</a>
    			
            
    			
    			<a q-on="click: openSlider(e, 'aboutme')" href="javascript:void(0)">关于我</a>
    			
            
		</nav>
		<nav class="header-nav">
			<div class="social">
				
					<a class="github" target="_blank" href="https://github.com/zhouhuahui" title="github"><i class="icon-github"></i></a>
		        
					<a class="zhihu" target="_blank" href="https://www.zhihu.com/people/ai-zai-xi-yuan-qian-51-86" title="zhihu"><i class="icon-zhihu"></i></a>
		        
					<a class="qq" target="_blank" href="/2957286012" title="qq"><i class="icon-qq"></i></a>
		        
					<a class="weixin" target="_blank" href="/18844116586" title="weixin"><i class="icon-weixin"></i></a>
		        
			</div>
		</nav>
	</header>		
</div>

    </div>
    <div class="mid-col" q-class="show:isShow,hide:isShow|isFalse">
      
<nav id="mobile-nav">
  	<div class="overlay js-overlay" style="background: #4d4d4d"></div>
	<div class="btnctn js-mobile-btnctn">
  		<div class="slider-trigger list" q-on="click: openSlider(e)"><i class="icon icon-sort"></i></div>
	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				<img src="http://localhost:4000/1000/10/10/images/shanna.jpg" class="js-avatar">
			</div>
			<hgroup>
			  <h1 class="header-author js-header-author"></h1>
			</hgroup>
			
			
			
				
			
				
			
			
			
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="https://github.com/zhouhuahui" title="github"><i class="icon-github"></i></a>
			        
						<a class="zhihu" target="_blank" href="https://www.zhihu.com/people/ai-zai-xi-yuan-qian-51-86" title="zhihu"><i class="icon-zhihu"></i></a>
			        
						<a class="qq" target="_blank" href="/2957286012" title="qq"><i class="icon-qq"></i></a>
			        
						<a class="weixin" target="_blank" href="/18844116586" title="weixin"><i class="icon-weixin"></i></a>
			        
				</div>
			</nav>

			<nav class="header-menu js-header-menu">
				<ul style="width: 50%">
				
				
					<li style="width: 50%"><a href="/">主页</a></li>
		        
					<li style="width: 50%"><a href="/tags/%E9%9A%8F%E7%AC%94/">随笔</a></li>
		        
				</ul>
			</nav>
		</header>				
	</div>
	<div class="mobile-mask" style="display:none" q-show="isShow"></div>
</nav>

      <div id="wrapper" class="body-wrap">
        <div class="menu-l">
          <div class="canvas-wrap">
            <canvas data-colors="#eaeaea" data-sectionHeight="100" data-contentId="js-content" id="myCanvas1" class="anm-canvas"></canvas>
          </div>
          <div id="js-content" class="content-ll">
            
  
    <article id="post-学习MIT6-824" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/08/05/%E5%AD%A6%E4%B9%A0MIT6-824/">学习MIT6.824</a>
    </h1>
  

        
        <a href="/2021/08/05/%E5%AD%A6%E4%B9%A0MIT6-824/" class="archive-article-date">
  	<time datetime="2021-08-05T15:20:14.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2021-08-05</time>
</a>
        
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="引用"><a href="#引用" class="headerlink" title="引用"></a>引用</h1><p>RAFT可视化介绍，简单了解RAFT：<a target="_blank" rel="noopener" href="http://thesecretlivesofdata.com/raft/">http://thesecretlivesofdata.com/raft/</a></p>
<p>RAFT官网，这里面有RAFT Visualization部分：<a target="_blank" rel="noopener" href="https://raft.github.io/">https://raft.github.io/</a></p>
<p>Raft作者的博士论文下载：<a href="https://link.zhihu.com/?target=https%3A//github.com/ongardie/dissertation/blob/master/book.pdf%3Fraw%3Dtrue">https://link.zhihu.com/?target=https%3A//github.com/ongardie/dissertation/blob/master/book.pdf%3Fraw%3Dtrue</a></p>
<p>MIT助教写的资料：<a target="_blank" rel="noopener" href="https://thesquareplanet.com/blog/students-guide-to-raft/">https://thesquareplanet.com/blog/students-guide-to-raft/</a></p>
<p>MIT6.824课程schedule：<a target="_blank" rel="noopener" href="https://pdos.csail.mit.edu/6.824/schedule.html">https://pdos.csail.mit.edu/6.824/schedule.html</a></p>
<p>raft论文：<a target="_blank" rel="noopener" href="https://raft.github.io/raft.pdf">https://raft.github.io/raft.pdf</a></p>
<p>PingCAP博客（有TiDB）：<a target="_blank" rel="noopener" href="https://pingcap.com/blog-cn/#Raft">https://pingcap.com/blog-cn/#Raft</a></p>
<p>github上的一个对MIT6.824-2021的参考答案MrGuin/6.824-labs-2021：<a target="_blank" rel="noopener" href="https://github.com/MrGuin/6.824-labs-2021">https://github.com/MrGuin/6.824-labs-2021</a></p>
<p>Anarion-zuo/AnBlogs上有6.824和6.828，cs143的文章：<a target="_blank" rel="noopener" href="https://github.com/Anarion-zuo/AnBlogs">https://github.com/Anarion-zuo/AnBlogs</a></p>
<p>6.824课程的翻译：<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/166409783">https://zhuanlan.zhihu.com/p/166409783</a></p>
<p>其他整理的参考资料：<a target="_blank" rel="noopener" href="https://github.com/tianbingJ/Trepang">https://github.com/tianbingJ/Trepang</a></p>

      

      
    </div>
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color4">分布式</a>
        		</li>
      		
		</ul>
	</div>

      

      
        <p class="article-more-link">
          <a class="article-more-a" href="/2021/08/05/%E5%AD%A6%E4%B9%A0MIT6-824/">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>

<aside class="wrap-side-operation">
    <div class="mod-side-operation">
        
        <div class="jump-container" id="js-jump-container" style="display:none;">
            <a href="javascript:void(0)" class="mod-side-operation__jump-to-top">
                <i class="icon-font icon-back"></i>
            </a>
            <div id="js-jump-plan-container" class="jump-plan-container" style="top: -11px;">
                <i class="icon-font icon-plane jump-plane"></i>
            </div>
        </div>
        
        
    </div>
</aside>




  
    <article id="post-基于NVM的postgres" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/08/03/%E5%9F%BA%E4%BA%8ENVM%E7%9A%84postgres/">基于NVM的postgres</a>
    </h1>
  

        
        <a href="/2021/08/03/%E5%9F%BA%E4%BA%8ENVM%E7%9A%84postgres/" class="archive-article-date">
  	<time datetime="2021-08-04T04:28:18.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2021-08-03</time>
</a>
        
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="NVM-WAL-BUFFER"><a href="#NVM-WAL-BUFFER" class="headerlink" title="NVM WAL BUFFER"></a>NVM WAL BUFFER</h1><p>【1】使用WAL段文件映射到内存作为WAL BUFFER</p>
<p>Non-volatile Memory Logging(PGCon 2016) <a target="_blank" rel="noopener" href="https://www.pgcon.org/2016/schedule/track/Performance/945.en.html">https://www.pgcon.org/2016/schedule/track/Performance/945.en.html</a></p>
<p>Persistent Memory(SNIA) <a target="_blank" rel="noopener" href="https://www.snia.org/PM">https://www.snia.org/PM</a></p>
<h1 id="读文章1"><a href="#读文章1" class="headerlink" title="读文章1"></a>读文章1</h1><p>读了一篇文章：《The impact of NVM as the main memory on the database management system》，网址是：<a target="_blank" rel="noopener" href="https://www.programmersought.com/article/75573496597/">https://www.programmersought.com/article/75573496597/</a>  其实，这篇文章是论文的《Implications of Non-Volatile Memory as Primary Storage for Database Management Systems》的简版。</p>
<p>“In addition, there are built-in substances related to leakage and voltage that limit the further expansion of DRAM. Therefore, as the main memory medium, DRAM cannot possibly keep up with the growth of current and future data sets.” 这句话表明DRAM不能做的很大。</p>
<p>“The simplest design method is to replace NVM with the disk, and use its low latency to obtain performance improvement. However, adapting the DBMS to the characteristics of NVM goes far beyond its low latency.” 因为NVM可以字节寻址，但是传统的磁盘是块寻址。</p>
<p>这篇文章也在研究如何在PG中部署NVM：</p>
<ol>
<li>“how to include NVM in the current system’s memory structure;”</li>
<li>“modifying the PostgreSQL storage engine to maximize the dividend of NVM”</li>
<li>“bypass the slow disk interface while ensuring the robustness of the DBMS”（这句话不是很懂）</li>
</ol>
<p>“the delay of STT-RAM is 1-20ns. Nevertheless, his delay is already very close to DRAM.”；“PC_RAM and R-RAM have higher write latency than DRAM. But write latency is not very important, because it can be alleviated by buffer.”（这句话的意思是，把DRAM作为NVM的buffer？还有可能是CPU内部的cache作为NVM的buffer）</p>
<p>“<strong>When using NVM as the main memory</strong>, not only the application software but also the system software needs to be modified, so that the advantages of NVM can be fully utilized. “</p>
<ol>
<li>为什么要改system software呢？“The traditional file system accesses the storage medium through the block layer. If only the disk is replaced with NVM without any modification, then the NVM storage also needs to pass the block layer to read and write data. ”，这样的话，NVM的字节寻址能力就没有用到。</li>
</ol>
<p>“PMFS is a POSIX file system developed by Intel and open source”，PMFS作为传统文件系统的替代品，有两个特征：</p>
<ol>
<li>“NVM and memory are addressed uniformly”. 这就意味着 “there is no need to copy data from NVM to DRAM for application access”</li>
<li>“ traditional databases access blocks in two ways: file IO; memory mapped IO. PMFS implements file IO in a manner similar to traditional FS. However, the implementation of memory mapped IO is different.”，因为：“In the traditional file system, memory mapped IO first copies pages to DRAM. PMFS does not need this step, it directly maps pages directly to the address space of the process” （PMFS是一个基于操作系统的软件，还是对操作系统的改变呢？）</li>
</ol>
<img src="/2021/08/03/%E5%9F%BA%E4%BA%8ENVM%E7%9A%84postgres/81822a71cc3103d974ac229f043e7988.png" class="">
<p><img src="基于NVM的postgres/81822a71cc3103d974ac229f043e7988.png" alt="img"></p>
<h2 id="memory-layered-design"><a href="#memory-layered-design" class="headerlink" title="memory layered design"></a>memory layered design</h2><p>这篇文章提供了三种“DBMS memory layered design based on NVM”：</p>
<img src="/2021/08/03/%E5%9F%BA%E4%BA%8ENVM%E7%9A%84postgres/6ca7e80c6a28cd51b6e577e30cdb1529.png" class="">
<p><img src="基于NVM的postgres/6ca7e80c6a28cd51b6e577e30cdb1529.png" alt="img"></p>
<p>文章中不建议把DRAM替换为NVM，原因是：”such changes require a redesign of the current operating system and application software. In addition, as a substitute for DRAM, NVM technology is not mature in terms of durability. Therefore, we advocate that the platform still contains DRAM memory, and the disk is completely or partially replaced with NVM”</p>
<p>DRAM+NVM的组合是：DRAM快速处理暂存的数据；“it allows applications to access the data of the database system through the PMFS file system, and uses the NVM byte addressing feature to avoid the API overhead of the current traditional file system.”（我不懂，字节寻址避免了什么开销呢）</p>
<p>当使用NVM替换磁盘时，我们如何更改DBMS的重要部分：</p>
<ol>
<li>Avoid block-level access。使用NVM作为main memory medium时，字节寻址比块寻址要更加高效，但是“this reduces the data granularity to the byte level, without data warm-up. A better method needs to balance the advantages of these two aspects.” 所以，<strong>什么是data warm-up</strong>。</li>
<li>Remove the internal buffer cache of the DBMS：“If the address space of NVM can be seen by other processes, there is no need to do block copying for a long time. <strong>Direct access to records in NVM will be more efficient</strong>. However, this <strong>requires an operating system that supports NVM</strong>, such as PMFS, which can directly expose the NVM address space to the process.” （我觉得，还是要buffer cache的吧）</li>
<li>Remove redo logs：“if the internal buffer cache is not deployed, when all writes are directly written to NVM, redo log is not needed, but undo log is still needed.”（对于最简单的恢复系统，也就是先写日志到持久化存储，再写对应的更新到持久化存储，那么确实不需要redo log了，但是对于PG来说，这个不适用，因为PG是直接把更新写到buffer中的。）</li>
</ol>
<h2 id="PG-read-and-write-architecture"><a href="#PG-read-and-write-architecture" class="headerlink" title="PG read and write architecture"></a>PG read and write architecture</h2>
<p><img src="基于NVM的postgres/image-20210804180735523.png" alt="image-20210804180735523"></p>
<p>Fig3 图a是传统的PG数据库的IO方式，“when the buffer cache is missed, the storage engine of the native PG will cause <strong>two copy operations</strong>. When the data set is very large, this will be a big overhead”</p>
<h1 id="PMEM"><a href="#PMEM" class="headerlink" title="PMEM"></a>PMEM</h1><p>参考：【3】关于mmap，ndctl，clwb等等很多相关知识都可以看到。</p>
<h2 id="mmap"><a href="#mmap" class="headerlink" title="mmap"></a>mmap</h2><p>”For <a target="_blank" rel="noopener" href="https://pmem.io/glossary/#persistent-memory">persistent memory</a>, a PMem-aware file system allows a memory mapped file to access the PMem directly, a feature known as <a target="_blank" rel="noopener" href="https://pmem.io/glossary/#dax">DAX</a>. “ 因为对于普通的mmap来说，都是直接操作文件映射的内存的，但是对于PM来说，mmap就是通过虚拟地址直接操作PM。</p>
<p>“Unlike memory mapped files on storage, where the OS performs <a target="_blank" rel="noopener" href="https://pmem.io/glossary/#paging">paging</a> to DRAM as necessary, the application is able to access persistent memory data structures in-place, right where they are located in PMem.”</p>
<p>但是由于CPU内部本身有缓存，所以不能保证数据一定会持久化到PM，所以就有了clwb, clflush, ntstore之类的指令。</p>
<img src="/2021/08/03/%E5%9F%BA%E4%BA%8ENVM%E7%9A%84postgres/dax.jpg" class="">
<p><img src="基于NVM的postgres/dax.jpg" alt="DAX"></p>
<p>pmem-Aware File System指的是可以支持DAX方式的文件系统，比如ext4。在pmem-Aware File System下，可以使用Standard File API的mmap()和msync()命令；同时，如果mmap()在“MAP_SYNC”模式下返回成功，则用户程序可以直接使用clwb等持久化命令。</p>
<h2 id="Device-DAX"><a href="#Device-DAX" class="headerlink" title="Device DAX"></a>Device DAX</h2><p>如果通过”pmem-Aware File System”来访问PM，这是访问PM的<code>fsdax</code>模式，如果不使用“pmem-Aware File System”来访问PM，这是访问PM的<code>dev dax</code>模式。两者的区别是什么呢？</p>
<ol>
<li>【2】fsdax模式由于提供的是标准的POSIX文件系统接口，所以他的兼容性更好，应用可以在完全不修改的情况下，把PMEM当作一个非常快速的磁盘来使用，同时因为是要模拟磁盘行为，IO的粒度也是512个字节，对于PMEM这样在cache line大小的IO中，能提供的超低延迟特性的硬件来说，IO的粒度仍旧太大了，无法真正发挥出PMEM的全部实力；只有devdax模式，才是真正的可以完全发挥PMEM所有高性能、可持久化、字节寻址能力的最强模式！但是唯一遗憾的就是要想使用devdax模式，必须重写现有的应用程序，和PMEM设备对接，同时，在非易失性内存上编程，也是和传统编程有较大的区别，需要考虑很多以前不需要处理的问题，所以对于很多现有的应用来说，虽然devdax模式“看上去很美”，但是却没办法采用。</li>
<li></li>
</ol>
<h1 id="DAX-FS"><a href="#DAX-FS" class="headerlink" title="DAX FS"></a>DAX FS</h1><p>参考【2】，【4】</p>
<h1 id="引用"><a href="#引用" class="headerlink" title="引用"></a>引用</h1><p>【1】postgresql email列表对NVM WAL BUFFER的讨论 <a target="_blank" rel="noopener" href="https://blog.csdn.net/yanzongshuai/article/details/111940166">https://blog.csdn.net/yanzongshuai/article/details/111940166</a></p>
<p><a target="_blank" rel="noopener" href="https://mp.ofweek.com/Internet/a956714781157">https://mp.ofweek.com/Internet/a956714781157</a></p>
<p>postgresql官网关于Yoshimi Ichiyanagi发送的NVM WAL BUFFER邮件：<a target="_blank" rel="noopener" href="https://www.postgresql.org/message-id/C20D38E97BCB33DAD59E3A1%40lab.ntt.co.jp">https://www.postgresql.org/message-id/C20D38E97BCB33DAD59E3A1%40lab.ntt.co.jp</a></p>
<p>这个作者<code>zys87</code>有很多相关的“PostgreSQL源码分析”的文章，比如：</p>
<p>非易失性WAL buffer <a target="_blank" rel="noopener" href="https://yanzongshuaidba.blog.csdn.net/article/details/104116169">https://yanzongshuaidba.blog.csdn.net/article/details/104116169</a></p>
<p>非易失性WAL buffer实现解析（一） <a target="_blank" rel="noopener" href="https://yanzongshuaidba.blog.csdn.net/article/details/104205001?utm_medium=distribute.pc_relevant_t0.none-task-blog-2%7Edefault%7EBlogCommendFromMachineLearnPai2%7Edefault-1.base&amp;depth_1-utm_source=distribute.pc_relevant_t0.none-task-blog-2%7Edefault%7EBlogCommendFromMachineLearnPai2%7Edefault-1.base">https://yanzongshuaidba.blog.csdn.net/article/details/104205001?utm_medium=distribute.pc_relevant_t0.none-task-blog-2%7Edefault%7EBlogCommendFromMachineLearnPai2%7Edefault-1.base&amp;depth_1-utm_source=distribute.pc_relevant_t0.none-task-blog-2%7Edefault%7EBlogCommendFromMachineLearnPai2%7Edefault-1.base</a></p>
<p>对应的专栏：PostgreSQL源码分析 <a target="_blank" rel="noopener" href="https://yanzongshuaidba.blog.csdn.net/category_9278392.html">https://yanzongshuaidba.blog.csdn.net/category_9278392.html</a></p>
<p>【2】dax fs：<a target="_blank" rel="noopener" href="https://www.usenix.org/system/files/login/articles/login_summer17_07_rudoff.pdf">https://www.usenix.org/system/files/login/articles/login_summer17_07_rudoff.pdf</a></p>
<p>MemVerge（PMEM）: <a target="_blank" rel="noopener" href="https://card.weibo.com/article/m/show/id/2309404633085408051536">https://card.weibo.com/article/m/show/id/2309404633085408051536</a></p>
<p>【3】pmem官网（关于mmap，ndctl，clwb等等很多相关知识都可以看到）：<a target="_blank" rel="noopener" href="https://pmem.io/">https://pmem.io/</a></p>
<p>【4】linux doc on DAX：<a target="_blank" rel="noopener" href="https://www.kernel.org/doc/Documentation/filesystems/dax.txt">https://www.kernel.org/doc/Documentation/filesystems/dax.txt</a></p>
<h1 id="网址"><a href="#网址" class="headerlink" title="网址"></a>网址</h1><p>应用PMDK修改WAL操作使之适配持久化内存 <a target="_blank" rel="noopener" href="https://blog.51cto.com/yanzongshuai/2428535">https://blog.51cto.com/yanzongshuai/2428535</a></p>
<p>yzs大神似乎很会研究PostgreSQL <a target="_blank" rel="noopener" href="https://blog.51cto.com/yanzongshuai">https://blog.51cto.com/yanzongshuai</a></p>
<p>dax fs：<a target="_blank" rel="noopener" href="https://www.usenix.org/system/files/login/articles/login_summer17_07_rudoff.pdf">https://www.usenix.org/system/files/login/articles/login_summer17_07_rudoff.pdf</a></p>
<p>MemVerge（PMEM）: <a target="_blank" rel="noopener" href="https://card.weibo.com/article/m/show/id/2309404633085408051536">https://card.weibo.com/article/m/show/id/2309404633085408051536</a></p>

      

      
    </div>
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color4">数据库</a>
        		</li>
      		
		</ul>
	</div>

      

      
        <p class="article-more-link">
          <a class="article-more-a" href="/2021/08/03/%E5%9F%BA%E4%BA%8ENVM%E7%9A%84postgres/">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>

<aside class="wrap-side-operation">
    <div class="mod-side-operation">
        
        <div class="jump-container" id="js-jump-container" style="display:none;">
            <a href="javascript:void(0)" class="mod-side-operation__jump-to-top">
                <i class="icon-font icon-back"></i>
            </a>
            <div id="js-jump-plan-container" class="jump-plan-container" style="top: -11px;">
                <i class="icon-font icon-plane jump-plane"></i>
            </div>
        </div>
        
        
    </div>
</aside>




  
    <article id="post-linux程序设计" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/08/02/linux%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1/">linux程序设计</a>
    </h1>
  

        
        <a href="/2021/08/02/linux%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1/" class="archive-article-date">
  	<time datetime="2021-08-03T06:04:47.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2021-08-02</time>
</a>
        
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="操作系统原理"><a href="#操作系统原理" class="headerlink" title="操作系统原理"></a>操作系统原理</h1><h2 id="linux下用户态和内核态的切换"><a href="#linux下用户态和内核态的切换" class="headerlink" title="linux下用户态和内核态的切换"></a>linux下用户态和内核态的切换</h2><p>参考“Linux下如何从用户态切换到内核态？”：<a target="_blank" rel="noopener" href="https://blog.csdn.net/shanghx_123/article/details/83151064">https://blog.csdn.net/shanghx_123/article/details/83151064</a></p>
<h1 id="linux命令"><a href="#linux命令" class="headerlink" title="linux命令"></a>linux命令</h1><h2 id="sudo"><a href="#sudo" class="headerlink" title="sudo"></a>sudo</h2><p>如果你是root用户，可以通过<code>su root</code>命令，然后输入root的密码切换到root用户。</p>
<p>如果你被划进了root用户组：更改<code>/etc/sudors</code>，此时你仍然只有普通用户的权限；但是你可以用命令<code>sudo -i</code>，然后输入你的密码，就可以执行root权限了；如果不用<code>sudo -i</code>，可以使用例如<code>sudo mkdir dir</code>类似的命令，在命令前面加上sudo，让这个命令有root权限。下面是root组用户关于sudo命令的详细介绍。</p>
<p>[sudo su]表示前用户暂时申请root权限，所以输入的不是root用户密码，而是当前用户的密码。sudo是用户申请管理员权限执行一个操作，而此处的操作就是变成管理员。运行结果 PWD=/home/用户名（当前用户主目录） 。</p>
<p>[sudo -i]表示为了频繁的执行某些只有超级用户才能执行的权限，而不用每次输入密码，可以使用该命令。提示输入密码时该密码为当前账户的密码。没有时间限制。执行该命令后提示符变为“#”而不是“$”。想退回普通账户时可以执行“exit”或“logout” 。运行结果 PWD=/root</p>
<p>[sudo !!]以root权限执行上一条命令。</p>
<p>[sudo -u userb ls -l]指定用户执行命令。</p>
<p>[sudo -l]列出目前的权限。</p>
<p>[sudo -u uggc vi ~www/index.html]以 uggc 用户身份编辑 home 目录下www目录中的 index.html 文件</p>
<p>[sudo su] 切换root身份，不携带当前用户环境变量。<br>[sudo su -]切换root身份，携带当前用户环境变量。</p>
<p>[sudo -i root]与[sudo - root]、[sudo -i] ,[sudo -] ，[sudo root]效果相同 提示输入密码时该密码为当前账户的密码 要求执行该命令的用户必须在sudoers中才可以 su需要的是切换后账户的密码。</p>
<h2 id="chmod"><a href="#chmod" class="headerlink" title="chmod"></a>chmod</h2><p>将nvmDir文件夹的组权限加上w。（意味着和nvmDir所有者同组的人可以有写权限了）</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod g+w <span class="regexp">/data/yumi</span>ng/nvmDir</span><br></pre></td></tr></table></figure>
<p>若加上<code>-R</code>选项，则意味着给目录及其所有子目录和子文件添加同样的权限</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod g+w -R <span class="regexp">/data/yumi</span>ng/nvmDir</span><br></pre></td></tr></table></figure>
<h2 id="usermod"><a href="#usermod" class="headerlink" title="usermod"></a>usermod</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">usermod -G hxlong zhouhuahui <span class="comment"># zhouhuahui加入到hxlong组，但是也不在原来的组了</span></span><br><span class="line">usermod -a -G zhouhuahui zhouhuahui <span class="comment"># zhouhuahui加入到zhouhuahui组，不影响原来的组</span></span><br></pre></td></tr></table></figure>
<h2 id="id"><a href="#id" class="headerlink" title="id"></a>id</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id zhouhuahui <span class="comment">#查看zhouhuahui的用户名，组名等</span></span><br></pre></td></tr></table></figure>
<h2 id="ln"><a href="#ln" class="headerlink" title="ln"></a>ln</h2><p>假如<code>/sublime_text/sublime_text</code>是sublime的可执行程序，我如何在命令行中输入<code>subl</code>就可以自动打开这个软件呢？</p>
<p>通过软链接：<code>ln -s /sublime_text/sublime_text /usr/bin/subl</code>就可以实现了。</p>
<h2 id="cat"><a href="#cat" class="headerlink" title="cat"></a>cat</h2><p>读取文件内容</p>
<p>比如，读取linux系统的cpu信息：<code>cat /proc/cpuinfo</code><br>读取linux系统的发行版信息：<code>cat /etc/os-release</code></p>
<h2 id="tar"><a href="#tar" class="headerlink" title="tar"></a>tar</h2><p><strong>tar -xvf \</strong>.tar //解压tar包**</p>
<p><strong>tar -xzvf \</strong>.tar.gz // 解压tar.gz**</p>
<p><strong>tar -xjvf \</strong>.tar.bz2 //解压 tar.bz2**</p>
<p><strong>tar -xZvf \</strong>.tar.Z // 解压tar.Z**</p>
<p>-z参数：表示解压的是dutar.gz文件（如果是tar.bz2就是-j）<br>-x参数：表示是执行解压缩操作而不是打包操作<br>-v参数：表示列出解压时的详细消息<br>-f参数：指定要解压的文件名</p>
<h2 id="ndctl"><a href="#ndctl" class="headerlink" title="ndctl"></a>ndctl</h2><p>参考：<a target="_blank" rel="noopener" href="https://pmem.io/ndctl/">https://pmem.io/ndctl/</a></p>
<h2 id="wget"><a href="#wget" class="headerlink" title="wget"></a>wget</h2><p>下载文件：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget -P &#123;保存文件的目录&#125; &#123;文件下载地址&#125; <span class="comment">#如果不指定保存目录，会下载在当前目录下</span></span><br></pre></td></tr></table></figure>
<p>比如：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wget https://ftp.postgresql.org/pub/<span class="built_in">source</span>/v13.3/postgresql-13.3.tar.gz</span><br><span class="line"><span class="comment"># 下载postgresql-13.3.tar.gz</span></span><br></pre></td></tr></table></figure>
<h2 id="patch：补丁工具"><a href="#patch：补丁工具" class="headerlink" title="patch：补丁工具"></a>patch：补丁工具</h2><p>使用diff命令产生补丁，使用patch命令给旧版本代码打补丁。参考【4】。</p>
<p>假设我们在<code>~</code>目录下有两个版本的proj1，分别是proj1_v1.0和proj1_v1.1。</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="regexp">//</span> ~<span class="regexp">/proj1_v1.0/</span>a/<span class="number">1</span>.c</span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> a = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="regexp">//</span> ~<span class="regexp">/proj1_v1.0/</span>b/<span class="number">1</span>.c</span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> b = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="regexp">//</span> ~<span class="regexp">/proj1_v1.1/</span>a/<span class="number">1</span>.c</span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> a = <span class="number">500</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="regexp">//</span> ~<span class="regexp">/proj1_v1.1/</span>b/<span class="number">1</span>.c</span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> a = <span class="number">55</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们可以使用diff命令产生从proj1_v1.0到proj1_v1.1的补丁。在<code>~</code>下执行：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">diff -Nrua proj1_v1.0 proj1_v1.1 &gt; c.patch <span class="comment"># 产生的补丁在c.patch中</span></span><br></pre></td></tr></table></figure>
<p>c.patch中的内容为：</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">diff -Nrua proj1_v1.0/a/1.c proj1_v1.1/a/1.c</span><br><span class="line"><span class="comment">--- proj1_v1.0/a/1.c    2021-08-29 23:58:03.127127776 +0800</span></span><br><span class="line"><span class="comment">+++ proj1_v1.1/a/1.c    2021-08-29 23:59:36.457121766 +0800</span></span><br><span class="line"><span class="meta">@@ -1,6 +1,5 @@</span></span><br><span class="line"> #include&lt;stdio.h&gt;</span><br><span class="line"></span><br><span class="line"> int main()&#123;</span><br><span class="line"><span class="deletion">-    int a = 1;</span></span><br><span class="line"><span class="deletion">-    return 0;</span></span><br><span class="line"><span class="addition">+    int a = 500;</span></span><br><span class="line"> &#125;</span><br><span class="line">diff -Nrua proj1_v1.0/b/1.c proj1_v1.1/b/1.c</span><br><span class="line"><span class="comment">--- proj1_v1.0/b/1.c    2021-08-29 23:58:39.998125402 +0800</span></span><br><span class="line"><span class="comment">+++ proj1_v1.1/b/1.c    2021-08-30 00:00:36.187117919 +0800</span></span><br><span class="line"><span class="meta">@@ -1,5 +1,6 @@</span></span><br><span class="line"> #include&lt;stdio.h&gt;</span><br><span class="line"></span><br><span class="line"> int main()&#123;</span><br><span class="line"><span class="deletion">-    int b = 1;</span></span><br><span class="line"><span class="addition">+    int b = 55;</span></span><br><span class="line"><span class="addition">+    return 0;</span></span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<p>为了将proj1_v1.0代码更新成proj1_v1.1的代码，需要使用patch命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> proj1_v1.0</span><br><span class="line">patch -p 1 &lt; ../c.patch</span><br><span class="line"><span class="comment"># -p指定了目录级别，从路径全称中除去几层目录</span></span><br><span class="line"><span class="comment"># 比如：如果指定-p 1， 那么proj1_v1.0/a/1.c就变成a/1.c</span></span><br><span class="line"><span class="comment"># 由于刚才cd到proj1_v1.0中，但是产生补丁时在~目录中，因此要除去一层目录：-p 1</span></span><br></pre></td></tr></table></figure>
<p><strong>使用patch命令必须保证被打补丁的项目没有改变，否则，会产生.rej文件</strong></p>
<h2 id="perf-linux原生性能分析工具"><a href="#perf-linux原生性能分析工具" class="headerlink" title="perf: linux原生性能分析工具"></a>perf: linux原生性能分析工具</h2><h1 id="进程"><a href="#进程" class="headerlink" title="进程"></a>进程</h1><p>用户在shell中可以同时执行多个命令。对于耗时很久的命令（如编译大型工程），用户不必傻傻等待命令运行完毕才执行下一个命令。用户在执行命令时，可以在命令的结尾添加“&amp;”符号，表示将命令放入后台执行。这样该命令对应的进程组即为后台进程组。在任意时刻，可能同时存在多个后台进程组，但是不管什么时候都只能有一个前台进程组。只有在前台进程组中进程才能在控制终端读取输入。当用户在终端输入信号生成终端字符（如ctrl+c、ctrl+z、ctr+\等）时，对应的信号只会发送给前台进程组。shell中可以存在多个进程组，无论是前台进程组还是后台进程组，它们或多或少存在一定的联系，为了更好地控制这些进程组（或者称为作业），系统引入了会话的概念。<strong>会话的意义在于将很多的工作囊括在一个终端，选取其中一个作为前台来直接接收终端的输入及信号，其他的工作则放在后台执</strong>行。</p>
<h2 id="waitpid"><a href="#waitpid" class="headerlink" title="waitpid()"></a>waitpid()</h2><p>系统调用waitpid，等待子进程退出: </p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">pid_t</span> <span class="title">waitpid</span><span class="params">(<span class="keyword">pid_t</span> pid,<span class="keyword">int</span> *status,<span class="keyword">int</span> options)</span></span></span><br></pre></td></tr></table></figure>
<p>pid参数的意义：</p>
<ul>
<li>pid&gt;0时，只<strong>等待进程ID等于pid的子进程</strong>，不管其它已经有多少子进程运行结束退出了，只要指定的子进程还没有结束，waitpid就会一直等下去。</li>
<li>pid=-1时，等待任何一个子进程退出，没有任何限制.</li>
<li>pid=0时，等待同一个进程组中的任何子进程，如果子进程已经加入了别的进程组，waitpid不会对它做任何理睬。</li>
<li>pid&lt;-1时，等待一个指定进程组中的任何子进程，这个进程组的ID等于pid的绝对值。</li>
</ul>
<p>options = WNOHANG表示非阻塞模式。</p>
<p>waitpid()的返回值：</p>
<ol>
<li>当正常返回的时候，waitpid返回收集到的子进程的进程ID；</li>
<li><strong>如果设置了选项WNOHANG，而调用中waitpid发现没有已退出的子进程可收集，则返回0；</strong></li>
<li>如果调用中出错，则返回-1，这时errno会被设置成相应的值以指示错误所在；</li>
</ol>
<h1 id="环境变量"><a href="#环境变量" class="headerlink" title="环境变量"></a>环境变量</h1><h2 id="环境变量-1"><a href="#环境变量-1" class="headerlink" title="环境变量"></a>环境变量</h2><p>环境变量是定义在整个计算机全局的变量，保存在文件中。</p>
<p>按照生效范围分类：</p>
<ol>
<li>系统环境变量：对全部用户有效</li>
<li>用户环境变量：用户私有的</li>
</ol>
<p>按照生存周期分类：</p>
<ol>
<li>永久环境变量</li>
<li>临时环境变量（比如，我在bash中写的命令<code>export PATH=$HOME/Desktop/postgres/13.3/bin:$PATH</code>只会在当前的会话中有效）</li>
</ol>
<h2 id="设置环境变量"><a href="#设置环境变量" class="headerlink" title="设置环境变量"></a>设置环境变量</h2><h3 id="bash中设置"><a href="#bash中设置" class="headerlink" title="bash中设置"></a>bash中设置</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> 变量名=<span class="string">&#x27;值&#x27;</span></span><br></pre></td></tr></table></figure>
<p>此时设置的是临时环境变量</p>
<h3 id="系统环境变量"><a href="#系统环境变量" class="headerlink" title="系统环境变量"></a>系统环境变量</h3><p>系统环境变量对全部的用户生效，设置系统环境变量有三种方法。</p>
<ol>
<li>在<code>/etc/profile</code>文件中设置。用户登录时执行<code>/etc/profile</code>文件中设置系统的环境变量。但是，linux不建议在<code>/etc/profile</code>文件中设置系统环境变量。</li>
<li>在<code>/etc/profile.d</code>目录中增加环境变量脚本文件，这是Linux推荐的方法。</li>
<li>在<code>/etc/bashrc</code>文件中设置环境变量。该文件配置的环境变量将会影响全部用户使用的bash shell。但是，Linux也不建议在/etc/bashrc文件中设置系统环境变量。</li>
</ol>
<h3 id="用户环境变量"><a href="#用户环境变量" class="headerlink" title="用户环境变量"></a>用户环境变量</h3><p>在用户的主目录，有几个特别的文件，用<code>ls</code>是看不见的，用 <code>ls .bash_*</code> 可以看见，它们设置了用户环境变量。</p>
<ol>
<li>在<code>.bash_profile</code>中设置（推荐首选）</li>
<li>在<code>.bash_logout</code>中设置。当每次退出系统（退出bash shell）时执行该文件。</li>
<li>在<code>.bash_history</code>中保存了用户使用过的历史命令</li>
</ol>
<h2 id="环境变量生效"><a href="#环境变量生效" class="headerlink" title="环境变量生效"></a>环境变量生效</h2><p>1）在Shell下，用export设置的环境变量对当前Shell立即生效，Shell退出后失效。</p>
<p>2）在脚本文件中设置的环境变量不会立即生效，退出Shell后重新登录时才生效，或者用source命令让它立即生效，例如：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">source</span> /etc/profile</span><br></pre></td></tr></table></figure>
<h1 id="linux-I-O"><a href="#linux-I-O" class="headerlink" title="linux I/O"></a>linux I/O</h1><h2 id="普通IO（read-write-）"><a href="#普通IO（read-write-）" class="headerlink" title="普通IO（read()/write()）"></a>普通IO（read()/write()）</h2><p>【3】假设我们使用普通的I/O读取文件，底层是如何工作的呢？</p>
<ol>
<li>进程通过系统调用读取数据</li>
<li>进程切换到内核态，通知设备进行读取</li>
<li>设备准备好的数据传送到内核空间</li>
<li>接收到数据后，内核态进程将数据从内核空间拷贝到用户空间</li>
<li>进程切换回用户态，继续执行用户空间的代码：处理数据</li>
<li>进程通过系统调用输出数据到设备</li>
<li>进程切换到内核态，把数据从用户空间拷贝到内核空间，通知设备进行输出操作</li>
<li>设备完成任务后，进程再次从内核态切换回用户态</li>
</ol>
<p>在上面的过程中，涉及到4次进程模式切换，两次内存拷贝。这些操作对性能会造成一定影响。</p>
<h2 id="sync-fsync-fdatasync"><a href="#sync-fsync-fdatasync" class="headerlink" title="sync() fsync() fdatasync()"></a>sync() fsync() fdatasync()</h2><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/hmxz2nn/article/details/82868980">https://blog.csdn.net/hmxz2nn/article/details/82868980</a> 参考了这篇文章，写的很不错</p>
<p>这几个函数都是针对文件的写操作的。由于<code>write()</code>函数对于数据持久化和一致性不是很友好，因为这个函数返回了，并不代表数据真的就立马写到磁盘中了，因此需要<code>fsync()</code>和<code>fdatasync()</code>函数。这两个函数都是等待数据完全写入磁盘后才返回，否则程序会阻塞。</p>
<h3 id="mmap的msync"><a href="#mmap的msync" class="headerlink" title="mmap的msync()"></a>mmap的msync()</h3><p>如果采用内存映射文件的方式进行文件IO（使用mmap，将文件的page cache直接映射到进程的地址空间，通过写内存的方式修改文件），也有类似的系统调用来确保修改的内容完全同步到硬盘之上：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">msync</span><span class="params">(<span class="keyword">void</span> *addr, <span class="keyword">size_t</span> length, <span class="keyword">int</span> flags)</span></span></span><br></pre></td></tr></table></figure>
<h3 id="使用fdatasync优化日志同步"><a href="#使用fdatasync优化日志同步" class="headerlink" title="使用fdatasync优化日志同步"></a>使用fdatasync优化日志同步</h3><p>文章开头时已提到，为了满足事务要求，数据库的日志文件是常常需要同步IO的。由于需要同步等待硬盘IO完成，所以事务的提交操作常常十分耗时，成为性能的瓶颈。</p>
<p>在Berkeley DB下，如果开启了AUTO_COMMIT（所有独立的写操作自动具有事务语义）并使用默认的同步级别（日志完全同步到硬盘才返回），写一条记录的耗时大约为5~10ms级别，基本和一次IO操作（10ms）的耗时相同。</p>
<p>我们已经知道，在同步上fsync是低效的。但是如果需要使用fdatasync减少对metadata的更新，则需要确保文件的尺寸在write前后没有发生变化。日志文件天生是追加型（append-only）的，总是在不断增大，似乎很难利用好fdatasync。</p>
<p>且看Berkeley DB是怎样处理日志文件的：</p>
<ol>
<li>每个log文件固定为10MB大小，从1开始编号，名称格式为“log.%010d”</li>
<li>每次log文件创建时，先写文件的最后1个page，将log文件扩展为10MB大小</li>
<li>向log文件中追加记录时，由于文件的尺寸不发生变化，使用fdatasync可以大大优化写log的效率</li>
<li>如果一个log文件写满了，则新建一个log文件，也只有一次同步metadata的开销</li>
</ol>
<h2 id="IO端口映射与I-O内存映射"><a href="#IO端口映射与I-O内存映射" class="headerlink" title="IO端口映射与I/O内存映射"></a>IO端口映射与I/O内存映射</h2><p>参考【1】：首先讲了CPU地址概念和两种编址方式：统一编址和独立编址。</p>
<ol>
<li>统一编址也称为<strong>“I/O内存”</strong>方式，外设寄存器位于“内存空间”（很多外设有自己的内存、缓冲区，外设的寄存器和内存统称“I/O空间”）；</li>
<li>独立编址也称为<strong>“I/O端口”</strong>方式，外设寄存器位于“I/O（地址）空间”，在系统中就存在了另一种与存储地址无关的IO地 址，CPU也必须具有专用与输入输出操作的IO指令（IN、OUT等）和控制逻辑。这为讲I/O内存映射的来由做了铺垫。</li>
</ol>
<p>虽然intel x86平台使用独立编址方式，但是x86平台普通使用了名为<strong>内存映射（MMIO）</strong>的技术，该技术是PCI规范的一部分，IO设备端口被映射到内存空间，映射后，CPU访问IO端口就如同访问内存一样。</p>
<p>对于Linux内核而言，它可能用于不同的CPU，所以它必须都要考虑上述两种编址方式，于是它采用一种新的方法，将基于I/O映射方式的或内存映射方式的I/O端口通称为<strong>“I/O区域”（I/O region）</strong>，不论你采用哪种方式，都要先申请IO区域：request_resource()，结束时释放 它：release_resource()。</p>
<p>如果CPU采用统一编址技术，对外设的访问就是<strong>I/O内存</strong>方式：访问I/O内存的流程是：request_mem_region() -&gt; ioremap() -&gt; ioread8()/iowrite8() -&gt; iounmap() -&gt; release_mem_region() 。</p>
<p>ioremap()用来将IO资源的物理地址映射到内核虚地址空间（3GB - 4GB）中。</p>
<p>如果CPU采用独立编址技术，那么访问I/O端口有两种方式：</p>
<ol>
<li>I/O映射方式（I/O－mapped）。不映射到内存空间，直接使用 intb()/outb()之类的函数来读写IO端口</li>
<li>内存映射方式（Memory－mapped）。MMIO是先把IO端口映射到IO内存（“内存空间”），再使用访问IO内存的函数来访问 IO端口。</li>
</ol>
<h3 id="使用I-O内存映射读取文件"><a href="#使用I-O内存映射读取文件" class="headerlink" title="使用I/O内存映射读取文件"></a>使用I/O内存映射读取文件</h3><p>【2】普通地使用C语言的<code>fread()</code>或者<code>fwrite()</code>函数都需要将内容拷贝到IO缓冲区以及页高速缓冲区，这就增加了数据拷贝的次数，无形之中增加了CPU和内存的开销。使用内存映射技术可以减少系统调用的次数同时又可以降低数据的拷贝次数。</p>
<p>将文件映射到内存：</p>
<ul>
<li>内存数据与文件数据一一对应</li>
<li>通过内存代替read/write系统调用接口来访问文件</li>
<li>减少数据拷贝，减少系统调用次数，提高了系统性能</li>
</ul>
<img src="/2021/08/02/linux%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1/20191007142039951.png" class="">
<p><img src="linux程序设计/20191007142039951.png" alt="在这里插入图片描述"></p>
<p><strong>但是我有一个问题没有搞懂：使用用户缓冲的目的就是为了效率，如果不用缓冲了，改用内存映射，那么每次都直接把数据发送到存储器，这样的开销会不会比系统调用和多次拷贝的开销要大。</strong></p>
<p>编程接口：</p>
<ul>
<li>头文件 <sys/mman.h></li>
<li>函数使用 void <em>mmap(void </em>addr, size_t length, int prot, int flags, int fd, off_t offset);</li>
<li>函数功能：在用户虚地址空间创建一个和实际物理内存相映射的关系。<br>函数参数:</li>
<li>addr:进程要映射的虚拟内存的起始地址，一般为NULL。操作系统会自动分配一个合适的内存地址。</li>
<li>length:要映射实际的内存区域大小</li>
<li>prot:内存保护标志,<br>PROT_EXEC(页内容可以被执行)，<br>PROT_READ（页内容可以被读），<br>PROT_WRITE（页内容可以被写），<br>PROT_NONE（页不可访问） </li>
<li>flags: 映射的对象类型，<br>MAP_FIXED（如果由addr个length参数指定的内存区重叠与现存的内存区；如果指定的地址不可用，操作将会失败；并且起始地址必须落在页的边界上），<br>MAP_SHARED（与其它所有映射这个对象的进程共享映射空间。对共享区的写入，相当于输出到文件。直到msync()或者munmap()被调用，文件实际上不会被更新。），<br>MAP_PRIVATE（建立一个写入时拷贝的私有映射。内存区域的写入不会影响到原文件。这个标志和以上标志是互斥的，）</li>
<li>fd:要映射的文件描述符</li>
<li>offset:文件偏移地址</li>
<li>mmap:以页单位操作，参数addr和offset必须按页对齐(4K对齐)</li>
<li>返回值：<br>成功：指向映射后的实际内存的地址<br>失败：MAP_FAILED</li>
</ul>
<p>后面讲到了一些编程用例，具体查看【2】。</p>
<h3 id="mmap工作机制"><a href="#mmap工作机制" class="headerlink" title="mmap工作机制"></a>mmap工作机制</h3><p><strong>mmap为什么是零拷贝呢？不是很懂</strong></p>
<p>通过调用memory map，我们让操作系统把文件的内容映射到内存，对内存的读写将关联到对应的文件。而应用通过访问用户空间操作这部分内存，避免了内存拷贝操作。</p>
<p>内存映射是文件到内存空间的映射。对于应用来说，和文件建立映射关系的是虚拟地址空间，而不是物理内存或者Heap。当我们建立一个2g大小的映射时，并不是在heap，更不是在物理内存中分配了这么大的空间，仅仅是在虚拟地址空间中划出了这么大一个区域而已，<strong>然后为虚拟空间分配一部分物理内存空间</strong>，就像页表一样。</p>
<p>应用访问内存映射区域时，操作系统会把虚拟的地址映射成真正的物理内存地址和底层文件的偏移量。如果应用访问的虚拟地址对应的文件内容尚未被装入内存，操作系统通过缺页中断，将内存中的部分内容交换出去，腾出空间将文件的内容读取到内存。</p>
<p><strong>内存映射对性能的提升是有条件的</strong>：通过内存映射访问文件，虽然减少了内存拷贝，减少了系统调用引起的进程模式切换，但是过程中需要承担<strong>缺页中断的负担</strong>；对于小文件的读取，或者对于append模式的文件读写，内存映射的性能未看，未必优于普通io操作。只有对大文件的随机访问，内存映射才可能有明显优势，不过这仍然需要更具体的分析和进一步的的benchmark测试。</p>
<p><strong>但是，对于NVM来说就不同了</strong>，mmap可以很好地利用NVM的字节寻址的特点；而且，mmap可以不用为映射的文件分配物理内存空间，直接把数据读写到NVM上的文件。</p>
<h1 id="网络编程"><a href="#网络编程" class="headerlink" title="网络编程"></a>网络编程</h1><h2 id="sockaddr-in"><a href="#sockaddr-in" class="headerlink" title="sockaddr_in"></a>sockaddr_in</h2><p>sockaddr_in就是为了保存TCP/IP相关的信息：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* netinet/in.h</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">sockaddr_in</span>&#123;</span></span><br><span class="line">    <span class="comment">/* 协议族：AF_UNIX, AF_NET, AF_INET6</span></span><br><span class="line"><span class="comment">     * AF_NET就是IPV4</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">short</span> <span class="keyword">int</span> sin_family;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/* 端口号（使用网络字节顺序）：例如80</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">short</span> <span class="keyword">int</span> sin_port;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/* IP地址：例如202.96.134.133</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">in_addr</span> <span class="title">sin_addr</span>;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">/* sockaddr和sockaddr大小一样了</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> sin_zero[<span class="number">8</span>];</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">in_addr</span>&#123;</span></span><br><span class="line">    <span class="comment">/* IP地址（网络字节顺序）</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">long</span> s_addr;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>为了将字符串形式的IP地址：SERV_IP和int类型的端口号SERV_PORT存储在sockaddr_in结构体serv_addr中：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/socket.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;arpa/inet.h&gt;</span></span></span><br><span class="line"><span class="built_in">inet_pton</span>(AF_INET, SERV_IP, &amp;serv_addr.sin_addr.s_addr);    </span><br><span class="line">serv_addr.sin_port = <span class="built_in">htons</span>(SERV_PORT);</span><br></pre></td></tr></table></figure>
<h2 id="sigaction和sigaction"><a href="#sigaction和sigaction" class="headerlink" title="sigaction和sigaction()"></a>sigaction和sigaction()</h2><p>struct sigaction主要在sigaction信号安装和sigqueue信号发送时会用到，这是linux进程间信号传递的内容；</p>
<p>struct sigaction的源码：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// usr/include/bits/sigaction.h</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* Structure describing the action to be taken when a signal arrives.     */</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">sigaction</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">       <span class="comment">/* Signal handler.     */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> __USE_POSIX199309</span></span><br><span class="line">	<span class="class"><span class="keyword">union</span> &#123;</span></span><br><span class="line">		<span class="comment">/* Used if SA_SIGINFO is not set.     */</span></span><br><span class="line">		<span class="keyword">__sighandler_t</span> sa_handler;</span><br><span class="line">       	<span class="comment">/* Used if SA_SIGINFO is set.     */</span></span><br><span class="line">       	<span class="built_in"><span class="keyword">void</span></span> (*sa_sigaction) (<span class="keyword">int</span>, <span class="keyword">siginfo_t</span> *, <span class="keyword">void</span> *);</span><br><span class="line">     &#125;</span><br><span class="line">     __sigaction_handler;</span><br><span class="line"><span class="meta"># <span class="meta-keyword">define</span> sa_handler __sigaction_handler.sa_handler</span></span><br><span class="line"><span class="meta"># <span class="meta-keyword">define</span> sa_sigaction      __sigaction_handler.sa_sigaction</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">else</span></span></span><br><span class="line">     <span class="keyword">__sighandler_t</span> sa_handler;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">     <span class="comment">/* Additional set of signals to be blocked.     */</span></span><br><span class="line">     <span class="keyword">__sigset_t</span> sa_mask;</span><br><span class="line"></span><br><span class="line">     <span class="comment">/* Special flags.     */</span></span><br><span class="line">     <span class="keyword">int</span> sa_flags;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>由<code>sa_handler</code>指定的处理函数只有一个参数，即<code>信号值</code>，所以信号不能传递除信号值之外的任何信息；由<code>sa_sigaction</code>是指定的信号处理函数带有三个参数，是为实时信号而设的（当然同样支持非实时信号），它指定一个3参数信号处理函数。第一个参数为信号值，第三个参数没有使用（posix没有规范使用该参数的标准），第二个参数是指向<code>siginfo_t</code>结构的指针，结构中包含信号携带的数据值。</p>
<p>属性<code>sa_mask</code>指定在信号处理程序执行过程中，哪些信号应当被阻塞。缺省情况下当前信号本身被阻塞，防止信号的嵌套发送，除非指定<code>SA_NODEFER</code>或者<code>SA_NOMASK</code>标志位。</p>
<p>属性<code>sa_flags</code>中包含了许多标志位，包括刚刚提到的<code>SA_NODEFER</code>及<code>SA_NOMASK</code>标志位。另一个比较重要的标志位是<code>SA_SIGINFO</code>，当设定了该标志位时，表示信号附带的参数可以被传递到信号处理函数中，因此，应该为sigaction结构中的<code>sa_sigaction</code>指定处理函数，而不应该为<code>sa_handler</code>指定信号处理函数。</p>
<p>sigaction()有3个参数：第一个参数是信号的值，第二个是sigaction结构的指针。第二个参数说明了第一个参数指定的信号发生时调用的函数和其它的一些信息。</p>
<p>下面是使用sigaction的例子：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">do_sigchild</span><span class="params">(<span class="keyword">int</span> num)</span></span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (<span class="built_in">waitpid</span>(<span class="number">0</span>, <span class="literal">NULL</span>, WNOHANG) &gt; <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">sigaction</span> <span class="title">newact</span>;</span></span><br><span class="line">	newact.sa_handler = do_sigchild; <span class="comment">// do_sigchild是一个函数</span></span><br><span class="line">	<span class="built_in">sigemptyset</span>(&amp;newact.sa_mask);</span><br><span class="line">	newact.sa_flags = <span class="number">0</span>;</span><br><span class="line">	<span class="built_in">sigaction</span>(SIGCHLD, &amp;newact, <span class="literal">NULL</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h1 id="gdb调试"><a href="#gdb调试" class="headerlink" title="gdb调试"></a>gdb调试</h1><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// debug1.c</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> DEBUG1 1</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> DEBUG2 2</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> DEBUG</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> DEBUG 0</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">if</span> (DEBUG &amp; DEBUG1)</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;debug1: &quot;</span> __DATE__ <span class="string">&quot; at &quot;</span> __TIME__ <span class="string">&quot;\n&quot;</span>);</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">if</span> (DEBUG &amp; DEBUG2)</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;This is a line %d of file %s&quot;</span>, __LINE__, __FILE__ <span class="string">&quot;\n&quot;</span>);</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;hello &quot;</span> <span class="string">&quot;world&quot;</span> <span class="string">&quot;\n&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>在linux bash下执行：<code>cc -o debug1 -DDEBUG=3 debug1.c</code></p>
<p>结果是：</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">debug1</span>: Aug <span class="number">17</span> <span class="number">2021</span> at <span class="number">08</span>:<span class="number">17</span>:<span class="number">47</span></span><br><span class="line"><span class="attribute">This</span> is a line <span class="number">14</span> of file debug<span class="number">1</span>.c</span><br><span class="line"><span class="attribute">hello</span> world</span><br></pre></td></tr></table></figure>
<p>通过指定<code>-DDEBUG</code>选项的值为0, 1, 2或者3，可以有不同的调试输出。</p>
<h2 id="启动gdb"><a href="#启动gdb" class="headerlink" title="启动gdb"></a>启动gdb</h2><p>假设已经编译好了<code>a.c</code>文件，然后可执行文件是<code>a</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cc -g -o a a.c</span><br></pre></td></tr></table></figure>
<p>然后：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gdb a</span><br></pre></td></tr></table></figure>
<p>此时只是启动gdb，但是并没有运行程序</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(gdb)</span><br></pre></td></tr></table></figure>
<h2 id="运行程序"><a href="#运行程序" class="headerlink" title="运行程序"></a>运行程序</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(gdb) run</span><br></pre></td></tr></table></figure>
<h2 id="栈跟踪"><a href="#栈跟踪" class="headerlink" title="栈跟踪"></a>栈跟踪</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(gdb) backtrace</span><br></pre></td></tr></table></figure>
<p>通过这个命令可以看到程序是如何到达这个断点的。</p>
<h2 id="检查变量"><a href="#检查变量" class="headerlink" title="检查变量"></a>检查变量</h2><p>print语句可以输出程序中的表达式的值。加入程序中有<code>int a[]</code>数组，则可以通过下面的命令输出<code>a[3]</code>的值。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(gdb) <span class="built_in">print</span> a[3]</span><br></pre></td></tr></table></figure>
<p>输出<code>a[0]</code>到<code>a[4]</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(gdb) <span class="built_in">print</span> a[0]@5</span><br></pre></td></tr></table></figure>
<h2 id="列出程序源代码"><a href="#列出程序源代码" class="headerlink" title="列出程序源代码"></a>列出程序源代码</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(gdb) list</span><br></pre></td></tr></table></figure>
<h2 id="设置断点"><a href="#设置断点" class="headerlink" title="设置断点"></a>设置断点</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(gdb) <span class="built_in">break</span> 3 <span class="comment"># 在第3行设置断点</span></span><br><span class="line">(gdb) run</span><br></pre></td></tr></table></figure>
<p>继续执行：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(gdb) cont</span><br></pre></td></tr></table></figure>
<p><strong>单步执行</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(gdb) next</span><br></pre></td></tr></table></figure>
<p>info命令：告诉gdb列出所有的断点</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(gdb) info <span class="built_in">break</span></span><br></pre></td></tr></table></figure>
<p>disable: disable某个编号的断点，如果想要用这个断点，只需enable</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(gdb) <span class="built_in">disable</span> <span class="built_in">break</span> 1 <span class="comment"># disable第一个断点</span></span><br></pre></td></tr></table></figure>
<p>在某个函数设置断点：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(gdb) <span class="built_in">break</span> func</span><br></pre></td></tr></table></figure>
<h2 id="attach"><a href="#attach" class="headerlink" title="attach"></a>attach</h2><p>如何用gdb调试已经运行的程序。加入一个程序的pid是1234</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(gdb) attach 1234</span><br></pre></td></tr></table></figure>
<h1 id="linux工具"><a href="#linux工具" class="headerlink" title="linux工具"></a>linux工具</h1><h2 id="gcc"><a href="#gcc" class="headerlink" title="gcc"></a>gcc</h2><p>多个源文件的编译：（假如有a.h, a.c, b.c文件）</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc a.c b.c -o b</span><br></pre></td></tr></table></figure>
<h1 id="引用"><a href="#引用" class="headerlink" title="引用"></a>引用</h1><p>【1】linux中的 IO端口映射和IO内存映射 <a target="_blank" rel="noopener" href="https://blog.csdn.net/geekster/article/details/11393995">https://blog.csdn.net/geekster/article/details/11393995</a></p>
<p>【2】linux 文件IO与内存映射：内存映射 <a target="_blank" rel="noopener" href="https://blog.csdn.net/Z_Stand/article/details/102305129">https://blog.csdn.net/Z_Stand/article/details/102305129</a></p>
<p>包含专栏“linux操作系统：io系统” <a target="_blank" rel="noopener" href="https://blog.csdn.net/z_stand/category_9403370.html">https://blog.csdn.net/z_stand/category_9403370.html</a></p>
<p>【3】虚拟内存/用户空间与内核空间/MMap与MUnmap</p>
<p>【4】打补丁patch 命令使用：<a target="_blank" rel="noopener" href="https://blog.csdn.net/xfxf996/article/details/103851041">https://blog.csdn.net/xfxf996/article/details/103851041</a></p>

      

      
    </div>
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color1">linux</a>
        		</li>
      		
		</ul>
	</div>

      

      
        <p class="article-more-link">
          <a class="article-more-a" href="/2021/08/02/linux%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1/">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>

<aside class="wrap-side-operation">
    <div class="mod-side-operation">
        
        <div class="jump-container" id="js-jump-container" style="display:none;">
            <a href="javascript:void(0)" class="mod-side-operation__jump-to-top">
                <i class="icon-font icon-back"></i>
            </a>
            <div id="js-jump-plan-container" class="jump-plan-container" style="top: -11px;">
                <i class="icon-font icon-plane jump-plane"></i>
            </div>
        </div>
        
        
    </div>
</aside>




  
    <article id="post-情商与智慧人生" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/07/31/%E6%83%85%E5%95%86%E4%B8%8E%E6%99%BA%E6%85%A7%E4%BA%BA%E7%94%9F/">情商与智慧人生</a>
    </h1>
  

        
        <a href="/2021/07/31/%E6%83%85%E5%95%86%E4%B8%8E%E6%99%BA%E6%85%A7%E4%BA%BA%E7%94%9F/" class="archive-article-date">
  	<time datetime="2021-07-31T14:27:44.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2021-07-31</time>
</a>
        
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="12-情商修炼在于细节"><a href="#12-情商修炼在于细节" class="headerlink" title="12 情商修炼在于细节"></a>12 情商修炼在于细节</h1><h2 id="12-1-情商修炼在于细节"><a href="#12-1-情商修炼在于细节" class="headerlink" title="12.1 情商修炼在于细节"></a>12.1 情商修炼在于细节</h2><p>情商修炼并不教你如何成功，而是教你如何快乐，它教你关注自己的心灵，改变我们对教育的看法，让我们像天才一样成长。</p>
<p>在大学，要更好地认识自己和社会，扬长避短，不断探寻、肯定、发展和超越自我；</p>
<p>高情商人有如下特点：</p>
<ol>
<li>外向，生活愉快；</li>
<li>不易陷入恐惧和伤感，调整不良情绪速度快；</li>
<li>目标明晰，对事业较投入，充满目标和激情；</li>
<li>为人正直，富于同情心，情感生活较丰富但不逾矩；</li>
<li>不管独处还是与人交往，都能怡然自得，具有正气场；</li>
<li>善于正向情绪主导意识，反省自己，激励自己，提升自己；</li>
</ol>
<p>低情商的人的特点：</p>
<ol>
<li>性格孤僻，怪异，不易与人合作；</li>
<li>自卑，脆弱，不能面对挫折；</li>
<li>急躁，固执，自负；</li>
<li>没有责任心，推三阻四，情绪不稳定；</li>
<li>不喜欢换位思考，不考虑别人的感受；</li>
<li>问明知故问的问题，说话戳人痛处；</li>
<li>即使是陌生，无关的人，仍然在意其怎么看自己；</li>
<li>把最好的脾气给了陌生人，把最差的耐心给了亲人；</li>
<li>说话难听，在众人面前喜欢贬低别人来抬高自己；</li>
<li>具有负气场，负能量，爱抱怨和指责，只见树木，不见森林，智商再高，也难有所成就；</li>
</ol>
<p>情商高的人在人生的各个方面都占尽优势，不管是谈恋爱，还是与人交往，主宰人生的方向；在生活中更有效率，更能满足，比较容易利用自己的智能获取丰硕的成果；</p>
<hr>
<p>想提高情商，要从细节做起。注重细节能给人带来良好的印象，良好的人际关系，而良好的人际关系又能带来良好的信誉，信任，甚至带有意外的经济效益；</p>
<p>子绝四：毋意、毋必、毋固、毋我。我们要怀圣人之心做平常之事，不能只顾自己的利益需求，忽视他人的存在。</p>
<h2 id="12-2-情商：一项综合软技能"><a href="#12-2-情商：一项综合软技能" class="headerlink" title="12.2 情商：一项综合软技能"></a>12.2 情商：一项综合软技能</h2><p>白岩松：“生命中有一种很奇妙的逻辑，如果你真的过好了每一天，明天还会不错。”</p>
<p>高情商创造大气场，能够无形中感染他人。</p>
<p>“我不是为老板打工，也不是为自己赚钱，我在为自己的梦想打工，我要让自己工作产生的价值远远超过自己的薪水。”；“要想取得成功，必须要做核心人物，这样才能吸引，感染别人，自己也能最终受益。”</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">上善若水。水善利万物而不争，处众人之所恶，</span><br><span class="line">故几于道。</span><br><span class="line">居善地，心善渊</span><br><span class="line">与善任，言善信</span><br><span class="line">政善治，事善能</span><br><span class="line">动善时</span><br><span class="line">夫唯不争，故无忧。</span><br></pre></td></tr></table></figure>
<p>在道家学说里，水为至善至柔，水性绵绵密密，微则无声，巨则汹涌，与人无争，却又容纳万物，人生之道，莫过于此。</p>

      

      
    </div>
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color3">随笔</a>
        		</li>
      		
		</ul>
	</div>

      

      
        <p class="article-more-link">
          <a class="article-more-a" href="/2021/07/31/%E6%83%85%E5%95%86%E4%B8%8E%E6%99%BA%E6%85%A7%E4%BA%BA%E7%94%9F/">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>

<aside class="wrap-side-operation">
    <div class="mod-side-operation">
        
        <div class="jump-container" id="js-jump-container" style="display:none;">
            <a href="javascript:void(0)" class="mod-side-operation__jump-to-top">
                <i class="icon-font icon-back"></i>
            </a>
            <div id="js-jump-plan-container" class="jump-plan-container" style="top: -11px;">
                <i class="icon-font icon-plane jump-plane"></i>
            </div>
        </div>
        
        
    </div>
</aside>




  
    <article id="post-Spring框架" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/07/31/Spring%E6%A1%86%E6%9E%B6/">Spring框架</a>
    </h1>
  

        
        <a href="/2021/07/31/Spring%E6%A1%86%E6%9E%B6/" class="archive-article-date">
  	<time datetime="2021-07-31T11:46:35.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2021-07-31</time>
</a>
        
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="SpringAll开源教程"><a href="#SpringAll开源教程" class="headerlink" title="SpringAll开源教程"></a>SpringAll开源教程</h1><p>github开源教程：<a target="_blank" rel="noopener" href="https://github.com/wuyouzhuguli/SpringAll">https://github.com/wuyouzhuguli/SpringAll</a></p>
<h2 id="Spring-Boot"><a href="#Spring-Boot" class="headerlink" title="Spring Boot"></a>Spring Boot</h2><h3 id="开启Spring-Boot"><a href="#开启Spring-Boot" class="headerlink" title="开启Spring Boot"></a>开启Spring Boot</h3><p>在<a target="_blank" rel="noopener" href="https://start.spring.io/页面可以填写一个表格，来生成maven文件包，然后下载，在eclipse中选择import">https://start.spring.io/页面可以填写一个表格，来生成maven文件包，然后下载，在eclipse中选择import</a> maven项目时将该包添加到maven项目中。这个一个简单的spring boot helloworld程序。</p>
<p><img src="Spring框架/image-20210801183208332.png" alt="image-20210801183208332"></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// DemoApplication.java</span></span><br><span class="line">package com.springboot.demo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.Banner;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line">@RestController</span><br><span class="line">@SpringBootApplication</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DemoApplication</span> &#123;</span></span><br><span class="line"></span><br><span class="line">    @<span class="built_in">RequestMapping</span>(<span class="string">&quot;/&quot;</span>)</span><br><span class="line">    <span class="function">String <span class="title">index</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;hello spring boot&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/*public static void main(String[] args) &#123;</span></span><br><span class="line"><span class="comment">        SpringApplication.run(DemoApplication.class, args);</span></span><br><span class="line"><span class="comment">    &#125;*/</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    	SpringApplication app = <span class="keyword">new</span> <span class="built_in">SpringApplication</span>(DemoApplication.class);</span><br><span class="line">    	app.<span class="built_in">setBannerMode</span>(Banner.Mode.OFF);</span><br><span class="line">    	app.<span class="built_in">run</span>(args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Spring-Boot基础配置"><a href="#Spring-Boot基础配置" class="headerlink" title="Spring Boot基础配置"></a>Spring Boot基础配置</h3><h4 id="全局配置文件"><a href="#全局配置文件" class="headerlink" title="全局配置文件"></a>全局配置文件</h4><p>在src/main/resources目录下，Spring Boot提供了一个名为application.properties的全局配置文件，可对一些默认配置的配置值进行修改。</p>
<h5 id="自定义属性值"><a href="#自定义属性值" class="headerlink" title="自定义属性值"></a>自定义属性值</h5><p><img src="Spring框架/image-20210801230001623.png" alt="image-20210801230001623"></p>
<p>Spring Boot允许我们在application.properties下自定义一些属性，比如：</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mrbird.blog.<span class="attribute">name</span>=mrbird&#x27;s blog</span><br><span class="line">mrbird.blog.<span class="attribute">title</span>=Spring Boot</span><br></pre></td></tr></table></figure>
<p>定义一个<strong>BlogProperties Bean</strong>，通过<code>@Value(&quot;$&#123;属性名&#125;&quot;)</code>来加载配置文件中的属性值：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.springboot.demo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BlogProperties</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">this</span>.name;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getTitle</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">this</span>.title;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;mrbird.blog.name&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;mrbird.blog.title&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String title;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>编写IndexController，注入该Bean：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.springboot.demo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">IndexController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> BlogProperties blogProperties;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/&quot;)</span></span><br><span class="line">    <span class="function">String <span class="title">index</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> blogProperties.getName()+<span class="string">&quot;——&quot;</span>+blogProperties.getTitle();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>@Autowired标注会帮助我们的变量与配置文件中的内容进行自动匹配。</p>
<p>修改DemoApplication.java： </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.springboot.demo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.Banner;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DemoApplication</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/*public static void main(String[] args) &#123;</span></span><br><span class="line"><span class="comment">        SpringApplication.run(DemoApplication.class, args);</span></span><br><span class="line"><span class="comment">    &#125;*/</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    	SpringApplication app = <span class="keyword">new</span> SpringApplication(DemoApplication.class);</span><br><span class="line">    	<span class="comment">//app.setBannerMode(Banner.Mode.OFF);</span></span><br><span class="line">    	app.run(args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<p>在属性非常多的情况下，可以这样</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// BlogProperties.java</span></span><br><span class="line"><span class="keyword">package</span> com.springboot.demo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.ConfigurationProperties;</span><br><span class="line"></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix=&quot;mrbird.blog&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BlogProperties</span> </span>&#123;</span><br><span class="line">	<span class="comment">// get, set略</span></span><br><span class="line">	<span class="keyword">private</span> String name;</span><br><span class="line">	<span class="keyword">private</span> String title;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>通过注解<code>@ConfigurationProperties(prefix=&quot;mrbird.blog&quot;)</code>指明了属性的通用前缀，通用前缀加属性名和配置文件的属性名一一对应。</p>
<p>除此之外还需在<strong>Spring Boot入口类</strong>加上注解<code>@EnableConfigurationProperties(&#123;ConfigBean.class&#125;)</code>来启用该配置：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.springboot.demo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.Banner;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.EnableConfigurationProperties;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties(&#123;BlogProperties.class&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DemoApplication</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/*public static void main(String[] args) &#123;</span></span><br><span class="line"><span class="comment">        SpringApplication.run(DemoApplication.class, args);</span></span><br><span class="line"><span class="comment">    &#125;*/</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    	SpringApplication app = <span class="keyword">new</span> SpringApplication(DemoApplication.class);</span><br><span class="line">    	<span class="comment">//app.setBannerMode(Banner.Mode.OFF);</span></span><br><span class="line">    	app.run(args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="属性间的引用"><a href="#属性间的引用" class="headerlink" title="属性间的引用"></a>属性间的引用</h5><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mrbird.blog.<span class="attribute">name</span>=mrbird&#x27;s blog</span><br><span class="line">mrbird.blog.<span class="attribute">title</span>=Spring Boot</span><br><span class="line">mrbird.blog.<span class="attribute">wholeTitle</span>=<span class="variable">$&#123;mrbird.blog.name&#125;</span>--$&#123;mrbird.blog.title&#125;</span><br></pre></td></tr></table></figure>
<h4 id="自定义配置文件"><a href="#自定义配置文件" class="headerlink" title="自定义配置文件"></a>自定义配置文件</h4><p>可以在<code>/src/main/resources</code>目录下新建一个自定义配置文件<code>test.properties</code></p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">test.name</span>=zhou</span><br><span class="line"><span class="attr">test.age</span>=<span class="number">22</span></span><br></pre></td></tr></table></figure>
<p>定义一个对应该配置文件的Bean:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.springboot.demo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.ConfigurationProperties;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.PropertySource;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix=&quot;test&quot;)</span></span><br><span class="line"><span class="meta">@PropertySource(&quot;classpath:test.properties&quot;)</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestConfigBean</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getAge</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.age;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">    	<span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAge</span><span class="params">(<span class="keyword">int</span> age)</span> </span>&#123;</span><br><span class="line">    	<span class="keyword">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在入口类中使用注解<code>@EnableConfigurationProperties(&#123;TestConfigBean.class&#125;)</code>；同样地，也要改一下<code>IndexController.java</code>文件；<code>TestConfigBean.java</code>文件中没有import相应的包，eclipse会有提示应该import什么包。</p>
<h4 id="通过命令行设置属性值"><a href="#通过命令行设置属性值" class="headerlink" title="通过命令行设置属性值"></a>通过命令行设置属性值</h4><p>运行Spring Boot jar文件时，可以使用命令<code>java -jar xxx.jar --server.port=8081</code>来改变端口的值。这条命令等价于我们手动到application.properties中修改（如果没有这条属性的话就添加）server.port属性的值为8081。</p>
<h3 id="Spring-Boot中使用Mybatis"><a href="#Spring-Boot中使用Mybatis" class="headerlink" title="Spring Boot中使用Mybatis"></a>Spring Boot中使用Mybatis</h3><p>引入<code>mybatis-spring-boot-starter</code>和数据库连接驱动（这里使用关系型数据库Oracle 11g）</p>
<h4 id="mybatis-spring-boot-starter"><a href="#mybatis-spring-boot-starter" class="headerlink" title="mybatis-spring-boot-starter"></a>mybatis-spring-boot-starter</h4><p>在pom中引入</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>注意：version不能写<code>2.2</code>，否则会报：<code>missing artifact</code></p>
<p>不同版本的Spring Boot和MyBatis版本对应不一样，具体可查看官方文档：<a target="_blank" rel="noopener" href="http://www.mybatis.org/spring-boot-starter/mybatis-spring-boot-autoconfigure/。">http://www.mybatis.org/spring-boot-starter/mybatis-spring-boot-autoconfigure/。</a></p>
<p>通过点击<code>Dependency Hierarchy</code>来查看依赖关系：</p>
<img src="/2021/07/31/Spring%E6%A1%86%E6%9E%B6/image-20210803194816092.png" class="">
<p><img src="Spring框架/image-20210803194816092.png" alt="image-20210803194816092"></p>
<h4 id="引入ojdbc6"><a href="#引入ojdbc6" class="headerlink" title="引入ojdbc6"></a>引入ojdbc6</h4><p>我们需要使用mvn命令将ojdbc6.jar依赖安装到本地maven仓库，然后才可以在pom中配置。</p>
<p>ojdbc6.jar的直接下载地址：<a target="_blank" rel="noopener" href="https://files.cnblogs.com/files/luohaonan/ojdbc6.zip">https://files.cnblogs.com/files/luohaonan/ojdbc6.zip</a></p>
<p>解压到D盘根目录中后，执行：</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn install:install-file <span class="attribute">-Dfile</span>=D:/ojdbc6.jar <span class="attribute">-DgroupId</span>=com.oracle <span class="attribute">-DartifactId</span>=ojdbc6 <span class="attribute">-Dversion</span>=6.0 <span class="attribute">-Dpackaging</span>=jar <span class="attribute">-DgeneratePom</span>=<span class="literal">true</span></span><br></pre></td></tr></table></figure>
<p>输出为：</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">[INFO] Scanning <span class="keyword">for</span> projects...</span><br><span class="line">Downloading from central: https:<span class="regexp">//</span>repo.maven.apache.org<span class="regexp">/maven2/</span>org<span class="regexp">/apache/m</span>aven<span class="regexp">/plugins/m</span>aven-clean-plugin<span class="regexp">/2.5/m</span>aven-clean-plugin-<span class="number">2.5</span>.pom</span><br><span class="line">Downloaded from central: https:<span class="regexp">//</span>repo.maven.apache.org<span class="regexp">/maven2/</span>org<span class="regexp">/apache/m</span>aven<span class="regexp">/plugins/m</span>aven-clean-plugin<span class="regexp">/2.5/m</span>aven-clean-plugin-<span class="number">2.5</span>.pom (<span class="number">3.9</span> kB at <span class="number">2.2</span> kB/s)</span><br><span class="line">Downloading from central: https:<span class="regexp">//</span>repo.maven.apache.org<span class="regexp">/maven2/</span>org<span class="regexp">/apache/m</span>aven<span class="regexp">/plugins/m</span>aven-plugins<span class="regexp">/22/m</span>aven-plugins-<span class="number">22</span>.pom</span><br><span class="line">Downloaded from central: https:<span class="regexp">//</span>repo.maven.apache.org<span class="regexp">/maven2/</span>org<span class="regexp">/apache/m</span>aven<span class="regexp">/plugins/m</span>aven-plugins<span class="regexp">/22/m</span>aven-plugins-<span class="number">22</span>.pom (<span class="number">13</span> kB at <span class="number">26</span> kB/s)</span><br><span class="line">Downloading from central: https:<span class="regexp">//</span>repo.maven.apache.org<span class="regexp">/maven2/</span>org<span class="regexp">/apache/m</span>aven<span class="regexp">/plugins/m</span>aven-install-plugin<span class="regexp">/2.4/m</span>aven-install-plugin-<span class="number">2.4</span>.pom</span><br><span class="line">Downloaded from central: https:<span class="regexp">//</span>repo.maven.apache.org<span class="regexp">/maven2/</span>org<span class="regexp">/apache/m</span>aven<span class="regexp">/plugins/m</span>aven-install-plugin<span class="regexp">/2.4/m</span>aven-install-plugin-<span class="number">2.4</span>.pom (<span class="number">6.4</span> kB at <span class="number">13</span> kB/s)</span><br><span class="line">[INFO]</span><br><span class="line">[INFO] ------------------&lt; org.apache.maven:standalone-pom &gt;-------------------</span><br><span class="line">[INFO] Building Maven Stub Project (No POM) <span class="number">1</span></span><br><span class="line">[INFO] --------------------------------[ pom ]---------------------------------</span><br><span class="line">[INFO]</span><br><span class="line">[INFO] --- maven-install-plugin:<span class="number">2.4</span>:install-file (default-cli) @ standalone-pom ---</span><br><span class="line">Downloading from central: https:<span class="regexp">//</span>repo.maven.apache.org<span class="regexp">/maven2/</span>org<span class="regexp">/codehaus/</span>plexus<span class="regexp">/plexus-utils/</span><span class="number">3.0</span>.<span class="number">5</span>/plexus-utils-<span class="number">3.0</span>.<span class="number">5</span>.pom</span><br><span class="line">Downloaded from central: https:<span class="regexp">//</span>repo.maven.apache.org<span class="regexp">/maven2/</span>org<span class="regexp">/codehaus/</span>plexus<span class="regexp">/plexus-utils/</span><span class="number">3.0</span>.<span class="number">5</span><span class="regexp">/plexus-utils-3.0.5.pom (2.5 kB at 5.2 kB/</span>s)</span><br><span class="line">Downloading from central: https:<span class="regexp">//</span>repo.maven.apache.org<span class="regexp">/maven2/</span>org<span class="regexp">/codehaus/</span>plexus<span class="regexp">/plexus/</span><span class="number">3.1</span>/plexus-<span class="number">3.1</span>.pom</span><br><span class="line">Downloaded from central: https:<span class="regexp">//</span>repo.maven.apache.org<span class="regexp">/maven2/</span>org<span class="regexp">/codehaus/</span>plexus<span class="regexp">/plexus/</span><span class="number">3.1</span><span class="regexp">/plexus-3.1.pom (19 kB at 37 kB/</span>s)</span><br><span class="line">Downloading from central: https:<span class="regexp">//</span>repo.maven.apache.org<span class="regexp">/maven2/</span>org<span class="regexp">/codehaus/</span>plexus<span class="regexp">/plexus-digest/</span><span class="number">1.0</span>/plexus-digest-<span class="number">1.0</span>.pom</span><br><span class="line">Downloaded from central: https:<span class="regexp">//</span>repo.maven.apache.org<span class="regexp">/maven2/</span>org<span class="regexp">/codehaus/</span>plexus<span class="regexp">/plexus-digest/</span><span class="number">1.0</span><span class="regexp">/plexus-digest-1.0.pom (1.1 kB at 2.3 kB/</span>s)</span><br><span class="line">Downloading from central: https:<span class="regexp">//</span>repo.maven.apache.org<span class="regexp">/maven2/</span>org<span class="regexp">/codehaus/</span>plexus<span class="regexp">/plexus-components/</span><span class="number">1.1</span>.<span class="number">7</span>/plexus-components-<span class="number">1.1</span>.<span class="number">7</span>.pom</span><br><span class="line">Downloaded from central: https:<span class="regexp">//</span>repo.maven.apache.org<span class="regexp">/maven2/</span>org<span class="regexp">/codehaus/</span>plexus<span class="regexp">/plexus-components/</span><span class="number">1.1</span>.<span class="number">7</span><span class="regexp">/plexus-components-1.1.7.pom (5.0 kB at 4.6 kB/</span>s)</span><br><span class="line">Downloading from central: https:<span class="regexp">//</span>repo.maven.apache.org<span class="regexp">/maven2/</span>org<span class="regexp">/codehaus/</span>plexus<span class="regexp">/plexus/</span><span class="number">1.0</span>.<span class="number">8</span>/plexus-<span class="number">1.0</span>.<span class="number">8</span>.pom</span><br><span class="line">Downloaded from central: https:<span class="regexp">//</span>repo.maven.apache.org<span class="regexp">/maven2/</span>org<span class="regexp">/codehaus/</span>plexus<span class="regexp">/plexus/</span><span class="number">1.0</span>.<span class="number">8</span><span class="regexp">/plexus-1.0.8.pom (7.2 kB at 15 kB/</span>s)</span><br><span class="line">Downloading from central: https:<span class="regexp">//</span>repo.maven.apache.org<span class="regexp">/maven2/</span>org<span class="regexp">/codehaus/</span>plexus<span class="regexp">/plexus-container-default/</span><span class="number">1.0</span>-alpha-<span class="number">8</span>/plexus-container-default-<span class="number">1.0</span>-alpha-<span class="number">8</span>.pom</span><br><span class="line">Downloaded from central: https:<span class="regexp">//</span>repo.maven.apache.org<span class="regexp">/maven2/</span>org<span class="regexp">/codehaus/</span>plexus<span class="regexp">/plexus-container-default/</span><span class="number">1.0</span>-alpha-<span class="number">8</span><span class="regexp">/plexus-container-default-1.0-alpha-8.pom (7.3 kB at 15 kB/</span>s)</span><br><span class="line">Downloading from central: https:<span class="regexp">//</span>repo.maven.apache.org<span class="regexp">/maven2/</span>classworlds<span class="regexp">/classworlds/</span><span class="number">1.1</span>-alpha-<span class="number">2</span>/classworlds-<span class="number">1.1</span>-alpha-<span class="number">2</span>.jar</span><br><span class="line">Downloading from central: https:<span class="regexp">//</span>repo.maven.apache.org<span class="regexp">/maven2/</span>org<span class="regexp">/codehaus/</span>plexus<span class="regexp">/plexus-digest/</span><span class="number">1.0</span>/plexus-digest-<span class="number">1.0</span>.jar</span><br><span class="line">Downloading from central: https:<span class="regexp">//</span>repo.maven.apache.org<span class="regexp">/maven2/</span>org<span class="regexp">/codehaus/</span>plexus<span class="regexp">/plexus-utils/</span><span class="number">3.0</span>.<span class="number">5</span>/plexus-utils-<span class="number">3.0</span>.<span class="number">5</span>.jar</span><br><span class="line">Downloaded from central: https:<span class="regexp">//</span>repo.maven.apache.org<span class="regexp">/maven2/</span>classworlds<span class="regexp">/classworlds/</span><span class="number">1.1</span>-alpha-<span class="number">2</span><span class="regexp">/classworlds-1.1-alpha-2.jar (38 kB at 66 kB/</span>s)</span><br><span class="line">Downloaded from central: https:<span class="regexp">//</span>repo.maven.apache.org<span class="regexp">/maven2/</span>org<span class="regexp">/codehaus/</span>plexus<span class="regexp">/plexus-digest/</span><span class="number">1.0</span><span class="regexp">/plexus-digest-1.0.jar (12 kB at 12 kB/</span>s)</span><br><span class="line">Downloaded from central: https:<span class="regexp">//</span>repo.maven.apache.org<span class="regexp">/maven2/</span>org<span class="regexp">/codehaus/</span>plexus<span class="regexp">/plexus-utils/</span><span class="number">3.0</span>.<span class="number">5</span><span class="regexp">/plexus-utils-3.0.5.jar (230 kB at 152 kB/</span>s)</span><br><span class="line">[INFO] Installing D:\ojdbc6.jar to C:\Users\zhou2\.m2\repository\com\oracle\ojdbc6\<span class="number">6.0</span>\ojdbc6-<span class="number">6.0</span>.jar</span><br><span class="line">[INFO] Installing C:\Users\zhou2\AppData\Local\Temp\mvninstall6943467979654797617.pom to C:\Users\zhou2\.m2\repository\com\oracle\ojdbc6\<span class="number">6.0</span>\ojdbc6-<span class="number">6.0</span>.pom</span><br><span class="line">[INFO] ------------------------------------------------------------------------</span><br><span class="line">[INFO] BUILD SUCCESS</span><br><span class="line">[INFO] ------------------------------------------------------------------------</span><br><span class="line">[INFO] Total time:  <span class="number">10.649</span> s</span><br><span class="line">[INFO] Finished at: <span class="number">2021</span>-<span class="number">08</span>-<span class="number">03</span>T20:<span class="number">16</span>:<span class="number">12</span>+<span class="number">08</span>:<span class="number">00</span></span><br><span class="line">[INFO] ------------------------------------------------------------------------</span><br></pre></td></tr></table></figure>
<p>接着在pom中引入:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.oracle<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>ojdbc6<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>6.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="Druid数据源"><a href="#Druid数据源" class="headerlink" title="Druid数据源"></a>Druid数据源</h4><p>Druid是一个关系型数据库连接池，是阿里巴巴的一个开源项目，地址：<a target="_blank" rel="noopener" href="https://github.com/alibaba/druid。Druid不但提供连接池的功能，还提供监控功能，可以实时查看数据库连接池和SQL查询的工作情况。">https://github.com/alibaba/druid。Druid不但提供连接池的功能，还提供监控功能，可以实时查看数据库连接池和SQL查询的工作情况。</a></p>
<p>加入pom依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="引入mysql驱动"><a href="#引入mysql驱动" class="headerlink" title="引入mysql驱动"></a>引入mysql驱动</h4><p>加入pom依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>8.0.26<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="代码架构"><a href="#代码架构" class="headerlink" title="代码架构"></a>代码架构</h4><img src="/2021/07/31/Spring%E6%A1%86%E6%9E%B6/image-20210810202601126.png" class="">
<p><img src="Spring框架/image-20210810202601126.png" alt="image-20210810202601126"></p>
<p>application.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.springboot;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Application</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		SpringApplication.run(Application.class, args);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>TestController.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.springboot.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.springboot.bean.Student;</span><br><span class="line"><span class="keyword">import</span> com.springboot.service.StudentService;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestController</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> StudentService studentService;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@RequestMapping(value=&quot;/querystudent&quot;, method=RequestMethod.GET)</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Student <span class="title">queryStudentBySno</span><span class="params">(String sno)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">this</span>.studentService.queryStudentBySno(sno);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Student.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.springboot.bean;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Student</span> <span class="keyword">implements</span> <span class="title">Serializable</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = -<span class="number">339516038496531943L</span>;</span><br><span class="line">    <span class="keyword">private</span> String sno;</span><br><span class="line">    <span class="keyword">private</span> String sname;</span><br><span class="line">    <span class="keyword">private</span> String ssex;</span><br><span class="line">    <span class="comment">// get,set略</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getSno</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> sno;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSno</span><span class="params">(String sno)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.sno = sno;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getSname</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> sname;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSname</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.sname = name;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getSsex</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> ssex;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSsex</span><span class="params">(String sex)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.ssex = sex;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>StudentMapper.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.springboot.mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.springboot.bean.Student;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">StudentMapper</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Insert(&quot;insert into student(sno,sname,ssex) values(#&#123;sno&#125;,#&#123;sname&#125;,#&#123;ssex&#125;)&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">add</span><span class="params">(Student student)</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Update(&quot;update student set sname=#&#123;sname&#125;,ssex=#&#123;ssex&#125; where sno=#&#123;sno&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">update</span><span class="params">(Student student)</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Delete(&quot;delete from student where sno=#&#123;sno&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">deleteBysno</span><span class="params">(String sno)</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Select(&quot;select * from student where sno=#&#123;sno&#125;&quot;)</span></span><br><span class="line">    <span class="meta">@Results(id = &quot;student&quot;,value= &#123;</span></span><br><span class="line"><span class="meta">        @Result(property = &quot;sno&quot;, column = &quot;sno&quot;, javaType = String.class),</span></span><br><span class="line"><span class="meta">        @Result(property = &quot;sname&quot;, column = &quot;sname&quot;, javaType = String.class),</span></span><br><span class="line"><span class="meta">        @Result(property = &quot;ssex&quot;, column = &quot;ssex&quot;, javaType = String.class)</span></span><br><span class="line"><span class="meta">    &#125;)</span></span><br><span class="line">    <span class="function">Student <span class="title">queryStudentBySno</span><span class="params">(String sno)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>StudentService.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.springboot.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.springboot.bean.Student;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">StudentService</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">int</span> <span class="title">add</span><span class="params">(Student student)</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">int</span> <span class="title">update</span><span class="params">(Student student)</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">int</span> <span class="title">deleteBySno</span><span class="params">(String sno)</span></span>;</span><br><span class="line">	<span class="function">Student <span class="title">queryStudentBySno</span><span class="params">(String sno)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>StudentServiceImp.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.springboot.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.springboot.bean.Student;</span><br><span class="line"><span class="keyword">import</span> com.springboot.mapper.StudentMapper;</span><br><span class="line"><span class="keyword">import</span> com.springboot.service.StudentService;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service(&quot;studentService&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StudentServiceImp</span> <span class="keyword">implements</span> <span class="title">StudentService</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> StudentMapper studentMapper;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">add</span><span class="params">(Student student)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.studentMapper.add(student);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">update</span><span class="params">(Student student)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.studentMapper.update(student);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">deleteBySno</span><span class="params">(String sno)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.studentMapper.deleteBysno(sno);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Student <span class="title">queryStudentBySno</span><span class="params">(String sno)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.studentMapper.queryStudentBySno(sno);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;	</span><br></pre></td></tr></table></figure>
<p>在test数据库中写如下SQL</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> student(</span><br><span class="line">    sno <span class="type">varchar</span>(<span class="number">100</span>) <span class="keyword">PRIMARY</span> KEY,</span><br><span class="line">    sname <span class="type">varchar</span>(<span class="number">100</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    ssex <span class="type">varchar</span>(<span class="number">100</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> student <span class="keyword">VALUES</span> (<span class="string">&#x27;001&#x27;</span>, <span class="string">&#x27;KangKang&#x27;</span>, <span class="string">&#x27;M &#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> student <span class="keyword">VALUES</span> (<span class="string">&#x27;002&#x27;</span>, <span class="string">&#x27;Mike&#x27;</span>, <span class="string">&#x27;M &#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> student <span class="keyword">VALUES</span> (<span class="string">&#x27;003&#x27;</span>, <span class="string">&#x27;Jane&#x27;</span>, <span class="string">&#x27;F &#x27;</span>);  </span><br></pre></td></tr></table></figure>
<p><strong>application.yml</strong></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">servlet:</span></span><br><span class="line">    <span class="attr">context-path:</span> <span class="string">/web</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">druid:</span></span><br><span class="line">      <span class="comment"># 数据库访问配置, 使用druid数据源</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">com.alibaba.druid.pool.DruidDataSource</span></span><br><span class="line">      <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">      <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/test?useUnicode=true&amp;characterEncoding=UTF-8</span></span><br><span class="line">      <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">      <span class="attr">password:</span> <span class="string">zhou19981209</span></span><br><span class="line">      <span class="attr">initial-size:</span> <span class="number">5</span></span><br><span class="line">      <span class="attr">min-idle:</span> <span class="number">5</span></span><br><span class="line">      <span class="attr">max-active:</span> <span class="number">20</span></span><br><span class="line">      <span class="attr">max-wait:</span> <span class="number">5000</span></span><br><span class="line">      <span class="comment"># 状态监控</span></span><br><span class="line">      <span class="attr">filter:</span></span><br><span class="line">        <span class="attr">stat:</span></span><br><span class="line">          <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">          <span class="attr">db-type:</span> <span class="string">mysql</span></span><br><span class="line">          <span class="attr">log-slow-sql:</span> <span class="literal">true</span></span><br><span class="line">          <span class="attr">slow-sql-millis:</span> <span class="number">2000</span></span><br><span class="line">      <span class="comment"># 监控过滤器</span></span><br><span class="line">      <span class="attr">web-stat-filter:</span></span><br><span class="line">        <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">        <span class="attr">exclusions:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">&quot;*.js&quot;</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">&quot;*.gif&quot;</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">&quot;*.jpg&quot;</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">&quot;*.png&quot;</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">&quot;*.css&quot;</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">&quot;*.ico&quot;</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">&quot;/druid/*&quot;</span></span><br><span class="line">      <span class="comment"># druid 监控页面</span></span><br><span class="line">      <span class="attr">stat-view-servlet:</span></span><br><span class="line">        <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">        <span class="attr">url-pattern:</span> <span class="string">/druid/*</span></span><br><span class="line">        <span class="attr">reset-enable:</span> <span class="literal">false</span></span><br><span class="line">        <span class="attr">login-username:</span> <span class="string">root</span></span><br><span class="line">        <span class="attr">login-password:</span> <span class="string">root</span></span><br></pre></td></tr></table></figure>
<p>参考 <a target="_blank" rel="noopener" href="https://github.com/alibaba/druid/tree/master/druid-spring-boot-starter#%E5%A6%82%E4%BD%95%E9%85%8D%E7%BD%AE-filter">https://github.com/alibaba/druid/tree/master/druid-spring-boot-starter#%E5%A6%82%E4%BD%95%E9%85%8D%E7%BD%AE-filter</a></p>
<ol>
<li>mysql驱动，所以<code>spring.datasource.druid.driver-class-name</code>是<code>com.mysql.cj.jdbc.Driver</code>；</li>
<li>mysql要启动在3306端口，并创建test数据库，<code>spring.datasource.druid.url</code>是<code>jdbc:mysql://localhost:3306/test</code></li>
<li>通过<code>server.servlet.context-path</code>改变服务器网址的根路径，比如我这里改成了<code>/web</code>。</li>
</ol>
<h4 id="运行"><a href="#运行" class="headerlink" title="运行"></a>运行</h4><p><strong>运行<code>http://localhost:8080/web/querystudent?sno=001</code></strong></p>
<img src="/2021/07/31/Spring%E6%A1%86%E6%9E%B6/image-20210810203547441.png" class="">
<p><img src="Spring框架/image-20210810203547441.png" alt="image-20210810203547441"></p>
<p>这里也出现过白页，是因为这个网址是访问<code>public Student queryStudentBySno(String sno)</code>函数的，但是在定义<code>Student</code>类的时候没有设置set和get。</p>
<p><strong>运行<code>http://localhost:8080/web/druid</code></strong></p>
<img src="/2021/07/31/Spring%E6%A1%86%E6%9E%B6/image-20210810203650441.png" class="">
<p><img src="Spring框架/image-20210810203650441.png" alt="image-20210810203650441"></p>
<p>刚开始运行这里出现白页，是因为<code>application.yml</code>中context-path的配置搞错了，它的键是<code>server.servlet.context-path</code>而不是<code>server.context-path</code>。</p>
<h1 id="引用"><a href="#引用" class="headerlink" title="引用"></a>引用</h1><p>Spring官网：<a target="_blank" rel="noopener" href="https://spring.io/">https://spring.io/</a></p>
<p>Spring Initializer: <a target="_blank" rel="noopener" href="https://start.spring.io/">https://start.spring.io/</a></p>
<p>github开源教程：<a target="_blank" rel="noopener" href="https://github.com/wuyouzhuguli/SpringAll">https://github.com/wuyouzhuguli/SpringAll</a></p>
<p>不同版本的Spring Boot和MyBatis版本对应不一样，具体可查看官方文档：<a target="_blank" rel="noopener" href="http://www.mybatis.org/spring-boot-starter/mybatis-spring-boot-autoconfigure/">http://www.mybatis.org/spring-boot-starter/mybatis-spring-boot-autoconfigure/</a></p>
<p>Druid: <a target="_blank" rel="noopener" href="https://github.com/alibaba/druid">https://github.com/alibaba/druid</a></p>

      

      
    </div>
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color3">后端</a>
        		</li>
      		
		</ul>
	</div>

      

      
        <p class="article-more-link">
          <a class="article-more-a" href="/2021/07/31/Spring%E6%A1%86%E6%9E%B6/">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>

<aside class="wrap-side-operation">
    <div class="mod-side-operation">
        
        <div class="jump-container" id="js-jump-container" style="display:none;">
            <a href="javascript:void(0)" class="mod-side-operation__jump-to-top">
                <i class="icon-font icon-back"></i>
            </a>
            <div id="js-jump-plan-container" class="jump-plan-container" style="top: -11px;">
                <i class="icon-font icon-plane jump-plane"></i>
            </div>
        </div>
        
        
    </div>
</aside>




  
    <article id="post-postgreSQL的编译和测试" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/07/30/postgreSQL%E7%9A%84%E7%BC%96%E8%AF%91%E5%92%8C%E6%B5%8B%E8%AF%95/">postgreSQL的编译和测试</a>
    </h1>
  

        
        <a href="/2021/07/30/postgreSQL%E7%9A%84%E7%BC%96%E8%AF%91%E5%92%8C%E6%B5%8B%E8%AF%95/" class="archive-article-date">
  	<time datetime="2021-07-30T11:03:22.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2021-07-30</time>
</a>
        
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>在centos 7虚拟机环境下使用eclipse编译和测试postgresql-13.3</p>
<h1 id="yum"><a href="#yum" class="headerlink" title="yum"></a>yum</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">yum clean all <span class="comment"># 清除缓存目录下的软件包及旧的header</span></span><br><span class="line"></span><br><span class="line">yum list pkg1 <span class="comment"># 查看pkg1是否安装</span></span><br><span class="line"></span><br><span class="line">yum install -y pkg1 <span class="comment"># 安装pkg1</span></span><br></pre></td></tr></table></figure>
<h1 id="依赖安装"><a href="#依赖安装" class="headerlink" title="依赖安装"></a>依赖安装</h1><p>根据postgresql-13.3源码根目录下的<code>INSTALL</code>文件的描述，必须安装下述软件：</p>
<figure class="highlight vbnet"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">-   GNU make version <span class="number">3.80</span> <span class="built_in">or</span> newer <span class="built_in">is</span> required; other make programs <span class="built_in">or</span></span><br><span class="line">    older GNU make versions will *<span class="built_in">not</span>* work. (GNU make <span class="built_in">is</span> sometimes</span><br><span class="line">    installed under the name <span class="string">&quot;gmake&quot;</span>.) <span class="keyword">To</span> test <span class="keyword">for</span> GNU make enter:</span><br><span class="line"></span><br><span class="line">        make --version</span><br><span class="line"></span><br><span class="line">-   You need an ISO/<span class="keyword">ANSI</span> C compiler (at least C99-compliant). Recent</span><br><span class="line">    versions <span class="keyword">of</span> GCC are recommended, but PostgreSQL <span class="built_in">is</span> known <span class="keyword">to</span> build</span><br><span class="line">    <span class="keyword">using</span> a wide variety <span class="keyword">of</span> compilers <span class="keyword">from</span> different vendors.</span><br><span class="line"></span><br><span class="line">-   tar <span class="built_in">is</span> required <span class="keyword">to</span> unpack the source distribution, <span class="keyword">in</span> addition <span class="keyword">to</span></span><br><span class="line">    either gzip <span class="built_in">or</span> bzip2.</span><br><span class="line"></span><br><span class="line">-   The GNU Readline library <span class="built_in">is</span> used <span class="keyword">by</span> <span class="keyword">default</span>. It allows psql (the</span><br><span class="line">    PostgreSQL command line SQL interpreter) <span class="keyword">to</span> remember <span class="keyword">each</span> command</span><br><span class="line">    you type, <span class="built_in">and</span> allows you <span class="keyword">to</span> use arrow keys <span class="keyword">to</span> recall <span class="built_in">and</span> edit</span><br><span class="line">    previous commands. This <span class="built_in">is</span> very helpful <span class="built_in">and</span> <span class="built_in">is</span> strongly recommended.</span><br><span class="line">    <span class="keyword">If</span> you don<span class="comment">&#x27;t want to use it then you must specify the</span></span><br><span class="line">    <span class="string">&quot;--without-readline&quot;</span> <span class="keyword">option</span> <span class="keyword">to</span> <span class="string">&quot;configure&quot;</span>. <span class="keyword">As</span> an alternative, you</span><br><span class="line">    can often use the BSD-licensed <span class="string">&quot;libedit&quot;</span> library, originally</span><br><span class="line">    developed <span class="keyword">on</span> NetBSD. The <span class="string">&quot;libedit&quot;</span> library <span class="built_in">is</span> GNU</span><br><span class="line">    Readline-compatible <span class="built_in">and</span> <span class="built_in">is</span> used <span class="keyword">if</span> <span class="string">&quot;libreadline&quot;</span> <span class="built_in">is</span> <span class="built_in">not</span> found, <span class="built_in">or</span> <span class="keyword">if</span></span><br><span class="line">    <span class="string">&quot;--with-libedit-preferred&quot;</span> <span class="built_in">is</span> used <span class="keyword">as</span> an <span class="keyword">option</span> <span class="keyword">to</span> <span class="string">&quot;configure&quot;</span>. <span class="keyword">If</span></span><br><span class="line">    you are <span class="keyword">using</span> a package-based Linux distribution, be aware that you</span><br><span class="line">    need both the readline <span class="built_in">and</span> readline-devel packages, <span class="keyword">if</span> those are</span><br><span class="line">    separate <span class="keyword">in</span> your distribution.</span><br><span class="line"></span><br><span class="line">-   The zlib compression library <span class="built_in">is</span> used <span class="keyword">by</span> <span class="keyword">default</span>. <span class="keyword">If</span> you don<span class="comment">&#x27;t want</span></span><br><span class="line">    <span class="keyword">to</span> use it <span class="keyword">then</span> you must specify the <span class="string">&quot;--without-zlib&quot;</span> <span class="keyword">option</span> <span class="keyword">to</span></span><br><span class="line">    <span class="string">&quot;configure&quot;</span>. <span class="keyword">Using</span> this <span class="keyword">option</span> disables support <span class="keyword">for</span> compressed</span><br><span class="line">    archives <span class="keyword">in</span> pg_dump <span class="built_in">and</span> pg_restore.</span><br></pre></td></tr></table></figure>
<p><strong>GNU make version 3.80</strong></p>
<p>我的centos 7中默认安装了GNU make version 3.82</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># make --version</span></span><br><span class="line">GNU Make 3.82</span><br></pre></td></tr></table></figure>
<p><strong>Recent versions of GCC</strong></p>
<p>centos 7的gcc版本是</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># gcc -v</span></span><br><span class="line">gcc version 4.8.5 20150623 (Red Hat 4.8.5-11) (GCC) </span><br></pre></td></tr></table></figure>
<p>因此，不需要再安装了。</p>
<p><strong>tar, gzip, bzip2</strong></p>
<p>已经安装好了</p>
<p><strong>readline</strong></p>
<p>已经安装好了</p>
<p><strong>zlib</strong></p>
<p>已经安装好了</p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">If you are building <span class="built_in">from</span> <span class="keyword">a</span> Git tree instead <span class="keyword">of</span> <span class="keyword">using</span> <span class="keyword">a</span> released source</span><br><span class="line">package, <span class="keyword">or</span> <span class="keyword">if</span> you want <span class="built_in">to</span> <span class="built_in">do</span> server development, you also need <span class="keyword">the</span></span><br><span class="line">following packages:</span><br><span class="line"></span><br><span class="line">-   Flex <span class="keyword">and</span> Bison are needed <span class="built_in">to</span> build <span class="built_in">from</span> <span class="keyword">a</span> Git checkout, <span class="keyword">or</span> <span class="keyword">if</span> you</span><br><span class="line">    changed <span class="keyword">the</span> actual scanner <span class="keyword">and</span> parser definition <span class="built_in">files</span>. If you need</span><br><span class="line">    them, be sure <span class="built_in">to</span> <span class="built_in">get</span> Flex <span class="number">2.5</span><span class="number">.31</span> <span class="keyword">or</span> later <span class="keyword">and</span> Bison <span class="number">1.875</span> <span class="keyword">or</span> later.</span><br><span class="line">    Other lex <span class="keyword">and</span> yacc programs cannot be used.</span><br><span class="line"></span><br><span class="line">-   Perl <span class="number">5.8</span><span class="number">.3</span> <span class="keyword">or</span> later is needed <span class="built_in">to</span> build <span class="built_in">from</span> <span class="keyword">a</span> Git checkout, <span class="keyword">or</span> <span class="keyword">if</span></span><br><span class="line">    you changed <span class="keyword">the</span> input <span class="built_in">files</span> <span class="keyword">for</span> <span class="keyword">any</span> <span class="keyword">of</span> <span class="keyword">the</span> build steps that use Perl</span><br><span class="line">    scripts. If building <span class="keyword">on</span> <span class="title">Windows</span> <span class="title">you</span> <span class="title">will</span> <span class="title">need</span> <span class="title">Perl</span> <span class="title">in</span> <span class="title">any</span> <span class="title">case</span>. <span class="title">Perl</span></span><br><span class="line">    is also required <span class="built_in">to</span> run some test suites.</span><br></pre></td></tr></table></figure>
<p><strong>Flex</strong></p>
<p><strong>Bison</strong></p>
<h1 id="eclipse-helios安装"><a href="#eclipse-helios安装" class="headerlink" title="eclipse helios安装"></a>eclipse helios安装</h1><p><a target="_blank" rel="noopener" href="http://www.eclipse.org/downloads/packages/release/helios/sr2/eclipse-ide-cc-developers">http://www.eclipse.org/downloads/packages/release/helios/sr2/eclipse-ide-cc-developers</a> 这是下载安装包的网址。</p>
<h1 id="configure"><a href="#configure" class="headerlink" title="configure"></a>configure</h1><p>【2】【3】先创建安装目录，我在$HOME/Desktop文件里创建了postgres/13.3文件夹用于安装。</p>
<p>在解压的postgresql源码目录下执行命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./configure --prefix=<span class="variable">$HOME</span>/Desktop/postgres/13.3 --enable-depend --enable-cassert --enable-debug</span><br></pre></td></tr></table></figure>
<p>其中—prefix指定PostgreSQL要安装的目录 （这个目录可以任意指定，但是建议使用绝对路径，这样在后续开发过程中不会出现因路径问题而产生的一系列莫名其妙的问题） —enable-depend、 —enable-cassert及 —enable-debug对于开发来说是必须的，尤其是 —enable-debug如果要调试和开发PostgreSQL源码必须进行指定。</p>
<p><strong>如果要调试方便，需要在configure后修改编译选项</strong></p>
<p>找到<code>src/Makefile.global</code>文件，然后修改下述代码：</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CFLAGS = -Wall -Wmissing-prototypes -Wpointer-arith -Wdeclaration-<span class="keyword">after</span>-<span class="keyword">statement</span> -Werror=vla -Wendif-labels -Wmissing-<span class="keyword">format</span>-<span class="keyword">attribute</span> -Wformat-<span class="keyword">security</span> -fno-<span class="keyword">strict</span>-aliasing -fwrapv -fexcess-<span class="type">precision</span>=standard -g -O2</span><br></pre></td></tr></table></figure>
<p>将<code>-O2</code>选项去掉，它是编译器优化选项，如果打开了，代码的执行顺序会变化，使得使用gdb追踪代码比较困难，gdb调试的时候打印变量值时会出现<code>&lt;value optimized out&gt;</code>。</p>
<h1 id="编译"><a href="#编译" class="headerlink" title="编译"></a>编译</h1><h2 id="eclipse下编译"><a href="#eclipse下编译" class="headerlink" title="eclipse下编译"></a>eclipse下编译</h2><p>首先，在helios eclipse中的<code>File-&gt;import</code>中选择<code>C/C++-&gt;Import Existing Code</code>，然后填写如下表格。</p>
<img src="/2021/07/30/postgreSQL%E7%9A%84%E7%BC%96%E8%AF%91%E5%92%8C%E6%B5%8B%E8%AF%95/image-20210730224054266.png" class="">
<p><img src="postgreSQL的编译和测试/image-20210730224054266.png" alt="image-20210730224054266"></p>
<p>点击NEXT，然后将“Existing Code Location”指向<strong>已经configure的</strong>postgreSQL源码的目录，具体见下面。然后等待编译完成。</p>
<img src="/2021/07/30/postgreSQL%E7%9A%84%E7%BC%96%E8%AF%91%E5%92%8C%E6%B5%8B%E8%AF%95/image-20210730225458552.png" class="">
<p><img src="postgreSQL的编译和测试/image-20210730225458552.png" alt="image-20210730225458552"></p>
<p>最后在console中出现这个代码表示make成功。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">All of PostgreSQL successfully made. Ready to install.</span><br></pre></td></tr></table></figure>
<h2 id="linux命令行编译"><a href="#linux命令行编译" class="headerlink" title="linux命令行编译"></a>linux命令行编译</h2><p>在postgresql源码根目录下执行：</p>
<figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">make</span></span><br></pre></td></tr></table></figure>
<h1 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h1><h2 id="eclipse下安装"><a href="#eclipse下安装" class="headerlink" title="eclipse下安装"></a>eclipse下安装</h2><img src="/2021/07/30/postgreSQL%E7%9A%84%E7%BC%96%E8%AF%91%E5%92%8C%E6%B5%8B%E8%AF%95/image-20210730230530689.png" class="">
<p><img src="postgreSQL的编译和测试/image-20210730230530689.png" alt="image-20210730230530689"></p>
<p>右击右边的<code>Make Target</code>下面的<code>postgresql-13.3</code>，然后点击<code>New</code>，出现一个窗口，按照下述方式填写。</p>
<img src="/2021/07/30/postgreSQL%E7%9A%84%E7%BC%96%E8%AF%91%E5%92%8C%E6%B5%8B%E8%AF%95/image-20210730230728013.png" class="">
<p><img src="postgreSQL的编译和测试/image-20210730230728013.png" alt="image-20210730230728013"></p>
<p>点击<code>OK</code>，就会在<code>Make Target</code>下出现绿色的<code>install</code>选项，双击<code>install</code>进行安装。在console中出现下面的文字，表示安装成功。</p>
<figure class="highlight erlang"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PostgreSQL installation complete.</span><br></pre></td></tr></table></figure>
<h2 id="命令行安装"><a href="#命令行安装" class="headerlink" title="命令行安装"></a>命令行安装</h2><p>在postgresql根目录下执行命令：</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make <span class="keyword">install</span></span><br></pre></td></tr></table></figure>
<h1 id="初始化"><a href="#初始化" class="headerlink" title="初始化"></a>初始化</h1><p>在<code>$HOME//Desktop/postgres/13.3</code>的bash中运行下述代码：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$HOME</span>/Desktop/postgres/13.3/bin:<span class="variable">$PATH</span></span><br><span class="line"><span class="built_in">export</span> PGDATA=DemoDir</span><br><span class="line">initdb</span><br></pre></td></tr></table></figure>
<p>注意，不能在root下执行上述代码，在普通用户中执行。</p>
<p>注意：上述环境变量的配置是暂时的，我在关机重启后就不能使用postgres的命令了；如果要永远改变，需要将变量放在<code>~/.bash_profile</code>文件中。</p>
<hr>
<p>如果不想在环境变量中指定<code>PGDATA</code>，可以在initdb参数中指定。当然initdb可以指定很多参数：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">initdb <span class="variable">$HOME</span>/Documents/postgresql-13.3/DemoDir -X /mnt/pmem0/pg_wal</span><br><span class="line"><span class="comment"># -X选项指定了PG日志存储的目录，如果不指定-X,则默认在/data/pg_wal中</span></span><br></pre></td></tr></table></figure>
<h1 id="启动和关闭"><a href="#启动和关闭" class="headerlink" title="启动和关闭"></a>启动和关闭</h1><p>启动：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">pg_ctl -D /home/zhouhuahui/postgresql-13.3/data -l logfile start </span><br><span class="line"><span class="comment"># 如果在环境变量中设置了PGDATA，则不用加-D选项</span></span><br><span class="line"><span class="comment"># 默认在5432端口启动</span></span><br><span class="line"><span class="comment"># 若要换到其他端口，可以在postgresql.conf文件中修改port，比如port=5435</span></span><br></pre></td></tr></table></figure>
<p>关闭：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pg_ctl stop -m smart</span><br><span class="line"><span class="comment"># 以smart方式关闭数据库服务器</span></span><br></pre></td></tr></table></figure>
<h1 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h1><p>查看我们创建的数据库</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">psql -l -p 5432 <span class="comment"># 如果不加-p选项，默认在5432端口启动服务器</span></span><br></pre></td></tr></table></figure>
<p>创建数据库</p>
<figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">createdb mydb</span> </span><br></pre></td></tr></table></figure>
<p>登录到数据库</p>
<figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">psql mydb</span></span><br></pre></td></tr></table></figure>
<hr>
<p>首先运行数据库，然后使用下述命令查看进程</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ps x</span><br></pre></td></tr></table></figure>
<p>然后选择postgres程序的pid，比如是7426，使用gdb进行调试</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gdb</span><br><span class="line">attach 7426</span><br></pre></td></tr></table></figure>
<p>这个时候可能会出现<code>Missing seperate debuginfos</code>的错误，参考<code>问题/调试错误</code>解决。</p>
<h2 id="pgbench"><a href="#pgbench" class="headerlink" title="pgbench"></a>pgbench</h2><p>参考《pgbench(postgresql压力测试工具)》：<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_35651267/article/details/87969328">https://blog.csdn.net/qq_35651267/article/details/87969328</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">createdb pgbench -p 5435</span><br><span class="line">pgbench -i pgbench -p 5435</span><br><span class="line">pgbench -c 32 -j 8 -T 120 -p 5435 pgbench</span><br></pre></td></tr></table></figure>
<p>nvm: 1620，1592</p>
<p>disk: 1193, 1207</p>
<h1 id="取消安装"><a href="#取消安装" class="headerlink" title="取消安装"></a>取消安装</h1><p>在项目根目录下执行：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">make uninstall</span><br><span class="line">make clean</span><br><span class="line">make distclean</span><br></pre></td></tr></table></figure>
<h1 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h1><h2 id="yum命令错误"><a href="#yum命令错误" class="headerlink" title="yum命令错误"></a>yum命令错误</h2><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Repodata <span class="keyword">is</span> <span class="keyword">over</span> <span class="number">2</span> weeks old. Install yum-cron? Or <span class="built_in">run</span>: yum makecache fast</span><br></pre></td></tr></table></figure>
<p>直接运行下述命令</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum clean all</span><br></pre></td></tr></table></figure>
<h2 id="configure错误"><a href="#configure错误" class="headerlink" title="configure错误"></a>configure错误</h2><p>configure时出现:</p>
<figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">configure: <span class="built_in">error</span>: <span class="built_in">readline</span> library <span class="keyword">not</span> found</span><br><span class="line">If you have <span class="built_in">readline</span> already installed, see config.<span class="built_in">log</span> <span class="keyword">for</span> details on the</span><br><span class="line">failure.  It <span class="built_in">is</span> possible the compiler isn&#x27;t looking <span class="keyword">in</span> the proper <span class="built_in">directory</span>.</span><br><span class="line">Use --without-<span class="built_in">readline</span> to disable <span class="built_in">readline</span> support.</span><br></pre></td></tr></table></figure>
<p>但是我已经安装了<code>readline</code>。根据博客的经验，【1】可能时缺少<code>readline-devel</code>，因此把它安装了试试。然后再测试，又出现<code>zlib</code>未安装的提示，因此安装了<code>zlib-devel</code>，这次成功了。</p>
<h2 id="用户错误"><a href="#用户错误" class="headerlink" title="用户错误"></a>用户错误</h2><p>当我要<code>initdb</code>时，发现postgres要求用户不是root，因此我切换到普通用户，然后将<code>/root/Desktop</code>目录下的<code>eclipse</code>安装目录，<code>eclipse workspace</code>目录以及<code>postgres</code>目录拷贝到<code>/home/zhouhuahui/Desktop</code>下。但是却发现，这些拷贝的文件夹都有锁。</p>
<img src="/2021/07/30/postgreSQL%E7%9A%84%E7%BC%96%E8%AF%91%E5%92%8C%E6%B5%8B%E8%AF%95/image-20210730235559744.png" class="">
<p><img src="postgreSQL的编译和测试/image-20210730235559744.png" alt="image-20210730235559744"></p>
<p>通过<code>chown</code>命令可以给指定用户开锁。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">su</span><br><span class="line">chown zhouhuahui <span class="string">&quot;eclipse workspace&quot;</span> -R</span><br><span class="line">chown zhouhuahui <span class="string">&quot;eclipse&quot;</span> -R</span><br><span class="line">chown zhouhuahui <span class="string">&quot;postgres&quot;</span> -R</span><br></pre></td></tr></table></figure>
<h2 id="调试错误"><a href="#调试错误" class="headerlink" title="调试错误"></a>调试错误</h2><p>当使用<code>gdb attach 7426</code>命令对postgres进程进行调试时，出现：<code>Missing seperate debuginfos: use debuginfo-install....</code>的错误，这个可能是确收glib导致的。</p>
<p>首先，进入root用户：<code>su</code></p>
<p>然后，修改<code>/etc/yum.repos.d/CentOS-Debuginfo.repo</code>文件：设置<code>enable=1</code>。</p>
<p>接着，<code>yum install glibc</code></p>
<p>最后：<code>debuginfo-install glibc</code></p>
<h1 id="引用"><a href="#引用" class="headerlink" title="引用"></a>引用</h1><p>【1】<a target="_blank" rel="noopener" href="https://www.cnblogs.com/shuaixf/archive/2011/11/29/2268292.html">https://www.cnblogs.com/shuaixf/archive/2011/11/29/2268292.html</a></p>
<p>【2】<a target="_blank" rel="noopener" href="https://blog.csdn.net/anzelin_ruc/article/details/8539411">https://blog.csdn.net/anzelin_ruc/article/details/8539411</a></p>
<p>【3】Postgres8源码分析_彭智勇</p>

      

      
    </div>
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color1">工具和环境</a>
        		</li>
      		
		</ul>
	</div>

      

      
        <p class="article-more-link">
          <a class="article-more-a" href="/2021/07/30/postgreSQL%E7%9A%84%E7%BC%96%E8%AF%91%E5%92%8C%E6%B5%8B%E8%AF%95/">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>

<aside class="wrap-side-operation">
    <div class="mod-side-operation">
        
        <div class="jump-container" id="js-jump-container" style="display:none;">
            <a href="javascript:void(0)" class="mod-side-operation__jump-to-top">
                <i class="icon-font icon-back"></i>
            </a>
            <div id="js-jump-plan-container" class="jump-plan-container" style="top: -11px;">
                <i class="icon-font icon-plane jump-plane"></i>
            </div>
        </div>
        
        
    </div>
</aside>




  
    <article id="post-java语言" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/07/30/java%E8%AF%AD%E8%A8%80/">java语言</a>
    </h1>
  

        
        <a href="/2021/07/30/java%E8%AF%AD%E8%A8%80/" class="archive-article-date">
  	<time datetime="2021-07-30T08:04:43.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2021-07-30</time>
</a>
        
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="注解"><a href="#注解" class="headerlink" title="注解"></a>注解</h1><h2 id="一个例子"><a href="#一个例子" class="headerlink" title="一个例子"></a>一个例子</h2><img src="/2021/07/30/java%E8%AF%AD%E8%A8%80/image-20210730175717158.png" class="">
<p><img src="java语言/image-20210730175717158.png" alt="image-20210730175717158"></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// UseCase.java</span></span><br><span class="line">package test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.*;</span><br><span class="line"></span><br><span class="line">@<span class="built_in">Target</span>(ElementType.METHOD)</span><br><span class="line">@<span class="built_in">Retention</span>(RetentionPolicy.RUNTIME)</span><br><span class="line"><span class="keyword">public</span> @interface UseCase &#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">id</span><span class="params">()</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">description</span><span class="params">()</span> <span class="keyword">default</span> &quot;no description&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// PasswordUtils.java</span></span><br><span class="line">package test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PasswordUtils</span> &#123;</span></span><br><span class="line">	@<span class="built_in">UseCase</span>(id=<span class="number">47</span>, description=</span><br><span class="line">			<span class="string">&quot;Password must contain at least one numeric&quot;</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> boolean <span class="title">validatePassword</span><span class="params">(String password)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> (password.<span class="built_in">matches</span>(<span class="string">&quot;\\w*\\d\\w*&quot;</span>));</span><br><span class="line">	&#125;</span><br><span class="line">	@<span class="built_in">UseCase</span>(id=<span class="number">48</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">encryptPassword</span><span class="params">(String password)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">StringBuilder</span>(password).<span class="built_in">reverse</span>().<span class="built_in">toString</span>();</span><br><span class="line">	&#125;</span><br><span class="line">	@<span class="built_in">UseCase</span>(id=<span class="number">49</span>, description=</span><br><span class="line">			<span class="string">&quot;New password can not equal previously used ones&quot;</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> boolean <span class="title">checkForNewPassword</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">			List&lt;String&gt; prevPasswords, String password)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> !prevPasswords.<span class="built_in">contains</span>(password);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// UseCaseTracker.java</span></span><br><span class="line">package test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.*;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 注解处理器</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UseCaseTracker</span> &#123;</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">trackUseCases</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">			List&lt;Integer&gt; useCases, Class&lt;?&gt; cl)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">for</span>(Method m : cl.<span class="built_in">getDeclaredMethods</span>()) &#123;</span><br><span class="line">			UseCase uc = m.<span class="built_in">getAnnotation</span>(UseCase.class);</span><br><span class="line">			<span class="keyword">if</span>(uc != null) &#123;</span><br><span class="line">				System.out.<span class="built_in">println</span>(<span class="string">&quot;Found use case: &quot;</span> + uc.<span class="built_in">id</span>() +</span><br><span class="line">						<span class="string">&quot; &quot;</span> + uc.<span class="built_in">description</span>());</span><br><span class="line">				useCases.<span class="built_in">remove</span>(<span class="keyword">new</span> <span class="built_in">Integer</span>(uc.<span class="built_in">id</span>()));</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i : useCases) &#123;</span><br><span class="line">			System.out.<span class="built_in">println</span>(<span class="string">&quot;Warning: missing use case-&quot;</span> + i);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		List&lt;Integer&gt; useCases = <span class="keyword">new</span> ArrayList&lt;Integer&gt;();</span><br><span class="line">		Collections.<span class="built_in">addAll</span>(useCases, <span class="number">47</span>, <span class="number">48</span>, <span class="number">49</span>, <span class="number">50</span>);</span><br><span class="line">        <span class="comment">// PasswordUtils类中实现了很多用例，但是不知道有没有覆盖useCases中的全部</span></span><br><span class="line">        <span class="comment">// 由于每个函数都通过注解@UseCase标注使用了什么用例，</span></span><br><span class="line">        <span class="comment">// 因此通过trackUseCases函数来分析PasswordUtils类中哪些用例没有实现</span></span><br><span class="line">		<span class="built_in">trackUseCases</span>(useCases, PasswordUtils.class);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果不使用<strong>注解处理器</strong>，编写和使用注解不会比注释更有用。</p>
<h2 id="编写注解处理器"><a href="#编写注解处理器" class="headerlink" title="编写注解处理器"></a>编写注解处理器</h2><p>为一个bean添加很多自定义注解，然后编写注解处理器，处理这些注解。（据我所知，一个bean是不是一个数据库表的定义啊）</p>
<img src="/2021/07/30/java%E8%AF%AD%E8%A8%80/image-20210811150404345.png" class="">
<p><img src="java语言/image-20210811150404345.png" alt="image-20210811150404345"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// DBTable.java</span></span><br><span class="line"><span class="keyword">package</span> annotations.database;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.*;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Target(ElementType.TYPE)</span> <span class="comment">// applies to classes only</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> DBTable &#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">name</span><span class="params">()</span> <span class="keyword">default</span> &quot;&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Constraints.java</span></span><br><span class="line"><span class="keyword">package</span> annotations.database;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.*;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Target(ElementType.FIELD)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Constraints &#123;</span><br><span class="line">	<span class="function"><span class="keyword">boolean</span> <span class="title">primaryKey</span><span class="params">()</span> <span class="keyword">default</span> <span class="keyword">false</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">boolean</span> <span class="title">allowNull</span><span class="params">()</span> <span class="keyword">default</span> <span class="keyword">true</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">boolean</span> <span class="title">unique</span><span class="params">()</span> <span class="keyword">default</span> <span class="keyword">false</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// SQLString.java</span></span><br><span class="line"><span class="keyword">package</span> annotations.database;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.*;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Target(ElementType.FIELD)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> SQLString &#123;</span><br><span class="line">	<span class="function"><span class="keyword">int</span> <span class="title">value</span><span class="params">()</span> <span class="keyword">default</span> 0</span>;</span><br><span class="line">	<span class="function">String <span class="title">name</span><span class="params">()</span> <span class="keyword">default</span> &quot;&quot;</span>;</span><br><span class="line">	<span class="function">Constraints <span class="title">constraints</span><span class="params">()</span> <span class="keyword">default</span> @Constraints</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// SQLInteger.java</span></span><br><span class="line"><span class="keyword">package</span> annotations.database;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.*;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Target(ElementType.FIELD)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> SQLInteger &#123;</span><br><span class="line">	<span class="function">String <span class="title">name</span><span class="params">()</span> <span class="keyword">default</span> &quot;&quot;</span>;</span><br><span class="line">	<span class="function">Constraints <span class="title">constraints</span><span class="params">()</span> <span class="keyword">default</span> @Constraints</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Member.java</span></span><br><span class="line"><span class="keyword">package</span> annotations.database;</span><br><span class="line"></span><br><span class="line"><span class="meta">@DBTable(name = &quot;MEMBER&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Member</span> </span>&#123;</span><br><span class="line">	<span class="meta">@SQLString(30)</span> String firstName; <span class="comment">// 默认给value属性设置值，而且必须是value属性</span></span><br><span class="line">	<span class="meta">@SQLString(50)</span> String lastName;</span><br><span class="line">	<span class="meta">@SQLInteger</span> Integer age;</span><br><span class="line">	<span class="meta">@SQLString(value=30,</span></span><br><span class="line"><span class="meta">			constraints=@Constraints(primaryKey=true))</span></span><br><span class="line">	String handle;</span><br><span class="line">	<span class="keyword">static</span> <span class="keyword">int</span> memberCount;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getHandle</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">this</span>.handle;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getFirstName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">this</span>.firstName;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getLastName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">this</span>.lastName;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">this</span>.handle;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Integer <span class="title">getAge</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">this</span>.age;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// TableCreate.java</span></span><br><span class="line"><span class="comment">// 注解解释器</span></span><br><span class="line"><span class="keyword">package</span> annotations.database;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.*;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TableCreator</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">static</span> String <span class="title">getConstraints</span><span class="params">(Constraints con)</span> </span>&#123;</span><br><span class="line">		String constraints = <span class="string">&quot;&quot;</span>;</span><br><span class="line">		<span class="keyword">if</span>(!con.allowNull()) &#123;</span><br><span class="line">			constraints += <span class="string">&quot;NOT NULL&quot;</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(con.primaryKey()) &#123;</span><br><span class="line">			constraints += <span class="string">&quot; PRIMARY KEY&quot;</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(con.unique()) &#123;</span><br><span class="line">			constraints += <span class="string">&quot; UNIQUE&quot;</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> constraints;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(args.length &lt; <span class="number">1</span>) &#123;</span><br><span class="line">			System.out.println(<span class="string">&quot;arguments: annotated classes&quot;</span>);</span><br><span class="line">			System.exit(<span class="number">0</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">for</span>(String className : args) &#123;</span><br><span class="line">			Class&lt;?&gt; cl = Class.forName(className);</span><br><span class="line">			DBTable dbTable = cl.getAnnotation(DBTable.class);</span><br><span class="line">			<span class="keyword">if</span>(dbTable == <span class="keyword">null</span>) &#123;</span><br><span class="line">				System.out.println(</span><br><span class="line">						<span class="string">&quot;No DBTable annotations in class &quot;</span> + className);</span><br><span class="line">				<span class="keyword">continue</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			String tableName = dbTable.name();</span><br><span class="line">			<span class="keyword">if</span>(tableName.length() &lt; <span class="number">1</span>) &#123;</span><br><span class="line">				tableName = cl.getName().toUpperCase();</span><br><span class="line">			&#125;</span><br><span class="line">			List&lt;String&gt; columnDefs = <span class="keyword">new</span> ArrayList&lt;String&gt;();</span><br><span class="line">			<span class="keyword">for</span>(Field field : cl.getDeclaredFields()) &#123;</span><br><span class="line">				String columnName = <span class="keyword">null</span>;</span><br><span class="line">				Annotation[] anns = field.getDeclaredAnnotations();</span><br><span class="line">				<span class="keyword">if</span>(anns.length &lt; <span class="number">1</span>)</span><br><span class="line">					<span class="keyword">continue</span>;</span><br><span class="line">				<span class="keyword">if</span>(anns[<span class="number">0</span>] <span class="keyword">instanceof</span> SQLInteger) &#123;</span><br><span class="line">					SQLInteger sInt = (SQLInteger)anns[<span class="number">0</span>];</span><br><span class="line">					<span class="keyword">if</span>(sInt.name().length() &lt; <span class="number">1</span>)</span><br><span class="line">						columnName = field.getName().toUpperCase();</span><br><span class="line">					<span class="keyword">else</span></span><br><span class="line">						columnName = sInt.name();</span><br><span class="line">					columnDefs.add(columnName + <span class="string">&quot; INT&quot;</span> + </span><br><span class="line">						getConstraints(sInt.constraints()));</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">if</span>(anns[<span class="number">0</span>] <span class="keyword">instanceof</span> SQLString) &#123;</span><br><span class="line">					SQLString sString = (SQLString)anns[<span class="number">0</span>];</span><br><span class="line">					<span class="keyword">if</span>(sString.name().length() &lt; <span class="number">1</span>)</span><br><span class="line">						columnName = field.getName().toUpperCase();</span><br><span class="line">					<span class="keyword">else</span></span><br><span class="line">						columnName = sString.name();</span><br><span class="line">					columnDefs.add(columnName + <span class="string">&quot; VARCHAR(&quot;</span> + </span><br><span class="line">						sString.value() + <span class="string">&quot;)&quot;</span> +</span><br><span class="line">						getConstraints(sString.constraints()));</span><br><span class="line">				&#125;	</span><br><span class="line">			&#125;</span><br><span class="line">			StringBuilder createCommand = <span class="keyword">new</span> StringBuilder(</span><br><span class="line">					<span class="string">&quot;CREATE TABLE &quot;</span> + tableName + <span class="string">&quot;(&quot;</span>);</span><br><span class="line">			<span class="keyword">for</span>(String columnDef : columnDefs)</span><br><span class="line">				createCommand.append(<span class="string">&quot;\n    &quot;</span> + columnDef + <span class="string">&quot;,&quot;</span>);</span><br><span class="line">			String tableCreate = createCommand.substring(</span><br><span class="line">					<span class="number">0</span>, createCommand.length()-<span class="number">1</span>) + <span class="string">&quot;);&quot;</span>;</span><br><span class="line">			System.out.println(<span class="string">&quot;Table Creation SQL for &quot;</span> + </span><br><span class="line">					className + <span class="string">&quot; is: \n&quot;</span> + tableCreate);	</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输入参数：<code>annotations.database.Member</code></p>
<p>输出：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Table</span> Creation <span class="keyword">SQL</span> <span class="keyword">for</span> annotations.database.Member <span class="keyword">is</span>: </span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="keyword">MEMBER</span>(</span><br><span class="line">    FIRSTNAME <span class="type">VARCHAR</span>(<span class="number">30</span>),</span><br><span class="line">    LASTNAME <span class="type">VARCHAR</span>(<span class="number">50</span>),</span><br><span class="line">    AGE <span class="type">INT</span>,</span><br><span class="line">    HANDLE <span class="type">VARCHAR</span>(<span class="number">30</span>) <span class="keyword">PRIMARY</span> KEY);</span><br></pre></td></tr></table></figure>
<h1 id="引用"><a href="#引用" class="headerlink" title="引用"></a>引用</h1><p>官方文档：<a target="_blank" rel="noopener" href="https://docs.oracle.com/en/java/javase/16/">https://docs.oracle.com/en/java/javase/16/</a></p>
<p>jdk源码：<a target="_blank" rel="noopener" href="https://github.com/openjdk/jdk">https://github.com/openjdk/jdk</a> 也可以在官方文档中找到</p>

      

      
    </div>
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color5">编程语言</a>
        		</li>
      		
		</ul>
	</div>

      

      
        <p class="article-more-link">
          <a class="article-more-a" href="/2021/07/30/java%E8%AF%AD%E8%A8%80/">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>

<aside class="wrap-side-operation">
    <div class="mod-side-operation">
        
        <div class="jump-container" id="js-jump-container" style="display:none;">
            <a href="javascript:void(0)" class="mod-side-operation__jump-to-top">
                <i class="icon-font icon-back"></i>
            </a>
            <div id="js-jump-plan-container" class="jump-plan-container" style="top: -11px;">
                <i class="icon-font icon-plane jump-plane"></i>
            </div>
        </div>
        
        
    </div>
</aside>




  
    <article id="post-Source-Insight-4-0的安装和使用" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/07/22/Source-Insight-4-0%E7%9A%84%E5%AE%89%E8%A3%85%E5%92%8C%E4%BD%BF%E7%94%A8/">Source Insight 4.0的安装和使用</a>
    </h1>
  

        
        <a href="/2021/07/22/Source-Insight-4-0%E7%9A%84%E5%AE%89%E8%A3%85%E5%92%8C%E4%BD%BF%E7%94%A8/" class="archive-article-date">
  	<time datetime="2021-07-23T05:44:04.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2021-07-22</time>
</a>
        
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h1><p>Source Insight 4.0安装包和破解文件都在如下地址，有需要的自行下载。</p>
<p>链接: <a target="_blank" rel="noopener" href="https://pan.baidu.com/s/18_piaLJbKFwCJ54JEWdtEw">https://pan.baidu.com/s/18_piaLJbKFwCJ54JEWdtEw</a></p>
<p>提取码: b8xu </p>
<ol>
<li><p>这里面有安装程序，安装完成后，直接将解压好的Source Insight 4.0程序复制到安装目录路径下，替换掉对应的程序。</p>
</li>
<li><p>打开Source Insight 4.0程序，如果之前没有安装过则会没有相应的破解，就会弹出相应的对话框，选择第三个选项添加解压后si4.pediy.lic文件，下一步即可破解！如果之前有破解过，这一步即可省略！</p>
<img src="/2021/07/22/Source-Insight-4-0%E7%9A%84%E5%AE%89%E8%A3%85%E5%92%8C%E4%BD%BF%E7%94%A8/1145504-20170413231115861-1570132634.png" class="">
<p><img src="Source-Insight-4-0的安装和使用/1145504-20170413231115861-1570132634.png" alt="img"></p>
</li>
<li><p>如果之前有安装过Source Insight，需要删除所有的配置文件。</p>
<p>清除注册表信息：</p>
<p> “win ”+ R  或者  “开始” -&gt; “运行”，输入“regedit”，回车；<br>  第一种方法：：在弹出的注册表管理器中，选择“编辑”-&gt; “查找”-&gt;“source insight”；将该项下面的source insight 需要清除的对应版本项目选中，右键“删除“。</p>
<p>删除全局配置信息：</p>
<p>在此电脑/文档中，找到Source Insight，然后删除整个文件夹。</p>
</li>
</ol>
<h1 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h1><h2 id="关联窗口"><a href="#关联窗口" class="headerlink" title="关联窗口"></a>关联窗口</h2><img src="/2021/07/22/Source-Insight-4-0%E7%9A%84%E5%AE%89%E8%A3%85%E5%92%8C%E4%BD%BF%E7%94%A8/image-20210723135142181.png" class="">
<p><img src="Source-Insight-4-0的安装和使用/image-20210723135142181.png" alt="image-20210723135142181"></p>
<p>如上图中红色标注，点击可以打开关联窗口。这个窗口是非常实用的，可以查看有哪些文件当中的函数调用了当前选择的函数。</p>
<h1 id="引用"><a href="#引用" class="headerlink" title="引用"></a>引用</h1><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/andy-songwei/p/9965714.html">https://www.cnblogs.com/andy-songwei/p/9965714.html</a></p>

      

      
    </div>
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color1">工具和环境</a>
        		</li>
      		
		</ul>
	</div>

      

      
        <p class="article-more-link">
          <a class="article-more-a" href="/2021/07/22/Source-Insight-4-0%E7%9A%84%E5%AE%89%E8%A3%85%E5%92%8C%E4%BD%BF%E7%94%A8/">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>

<aside class="wrap-side-operation">
    <div class="mod-side-operation">
        
        <div class="jump-container" id="js-jump-container" style="display:none;">
            <a href="javascript:void(0)" class="mod-side-operation__jump-to-top">
                <i class="icon-font icon-back"></i>
            </a>
            <div id="js-jump-plan-container" class="jump-plan-container" style="top: -11px;">
                <i class="icon-font icon-plane jump-plane"></i>
            </div>
        </div>
        
        
    </div>
</aside>




  
    <article id="post-Postgresdb源码解读" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/07/19/Postgresdb%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB/">Postgresdb源码解读</a>
    </h1>
  

        
        <a href="/2021/07/19/Postgresdb%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB/" class="archive-article-date">
  	<time datetime="2021-07-20T02:39:05.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2021-07-19</time>
</a>
        
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="目录结构"><a href="#目录结构" class="headerlink" title="目录结构"></a>目录结构</h1><ul>
<li>aclocal.m4：config 用的文件的一部分</li>
<li>config/：config 用的文件的目录</li>
<li>config.log：</li>
<li>configure：configure 文件</li>
<li>configure.in：configure 文件的雏形</li>
<li>contrib/：contribution 程序</li>
<li>COPYRIGHT：版权信息</li>
<li>doc/：文档目录</li>
<li>GUNMakefile：第一级目录的 Makefile</li>
<li>GUNMakefile.in：Makefile 的雏形</li>
<li>HISTORY：修改历史</li>
<li>INSTALL：安装方法简要说明</li>
<li>Makefile：Makefile模版</li>
<li>README：简单说明</li>
<li>src/：源代码目录</li>
</ul>
<p><strong>src/的源码目录</strong>：</p>
<ul>
<li>backend/：后端的源码目录</li>
<li>include/：头文件，backend等的代码的头文件包含在include里面。其组织虽然与backend的目录结构类似，但是并非完全相同，基本上来说下一级的子目录不再设下一级目录。</li>
<li>common/：通用库代码</li>
<li>bin/：psql 等 UNIX命令工具的代码</li>
<li>pl/：存储过程语言的代码</li>
<li>port/：平台移植相关的代码</li>
<li>template/：平台相关的设置值</li>
<li>test/：各种测试脚本</li>
<li>timezone/：时区相关代码</li>
<li>tools/：各自开发工具和文档</li>
<li>tutorial/：教程</li>
<li>fe_utils/：通用工具</li>
<li>interfaces/：前端相关的库的代码</li>
<li>Makefile：Makefile</li>
<li>Makefile.global：make 的设定值（从configure生成的）</li>
<li>Makefile.global.in：Configure使用的Makefile.global的雏形</li>
<li>Makefile.shlib：共享库用的Makefile</li>
<li>nls-global.mk：信息目录用的Makefile文件的规则</li>
<li>DEVELOPERS：面向开发人员的注释</li>
</ul>
<p><strong>src/backend/</strong>源码目录：</p>
<ul>
<li>access/：各种存储访问方法(在各个子目录下) common(共同函数)、gin (Generalized Inverted Index通用逆向索引)、gist (Generalized Search Tree通用索引)、 hash (哈希索引)、heap (heap的访问方法)、index (通用索引函数)、 nbtree (Btree函数)、transam (事务处理)</li>
<li>bootstrap/：数据库的初始化处理(initdb的时候)</li>
<li>catalog/：系统目录，系统表操作</li>
<li>commands/：SELECT/INSERT/UPDATE/DELETE以为的SQL文的处理</li>
<li>common.mk：</li>
<li>executor/：执行器(访问的执行)</li>
<li>foreign/：FDW(Foreign Data Wrapper)处理</li>
<li>lib/：共同函数</li>
<li>libpq/：C/C++库函数，处理与客户端间的通信，几乎所有的模块都依赖它。</li>
<li>main/：主程序模块，负责将控制权转到Postmaster进程或Postgres进程。</li>
<li>Makefile: makefile</li>
<li>nodes/：构文树节点相关的处理函数</li>
<li>optimizer/：优化器</li>
<li>parser/：SQL构文解析器</li>
<li>po/: 语言文件配置</li>
<li>port/：平台相关的代码</li>
<li>postmaster/：postmaster的主函数 (常驻postgres)</li>
<li>regex/：正则处理</li>
<li>replication/：streaming replication</li>
<li>rewrite/：规则及视图相关的重写处理</li>
<li>snowball/：全文检索相关（语干处理）</li>
<li>storage/: 共享内存、磁盘上的存储、缓存等全部一次/二次记录管理(以下的目录)、buffer/(缓存管理)、 file/(文件)、freespace/(Fee Space Map管理)、 ipc/(进程间通信)、large_object /(大对象的访问函数)、 lmgr/(锁管理)、page/(页面访问相关函数)、 smgr/(存储管理器)</li>
<li>tcop/：postgres (数据库引擎的进程)的主要部分，它调用Parse，Optimizer，Executor和Commands</li>
<li>tsearch/：全文检索</li>
<li>utils/ 各种模块(以下目录) adt/(嵌入的数据类型)、cache/(缓存管理)、 error/(错误处理)、fmgr/(函数管理)、hash/(hash函数)、 init/(数据库初始化、postgres的初期处理)、 mb/(多字节文字处理)、misc/(其他)、mmgr/(内存的管理函数)、 resowner/(查询处理中的数据(buffer pin及表锁)的管理)、sort/(排序处理)、time/(事务的 MVCC 管理)</li>
</ul>
<p>在/src/bin下面还有一些有用的模块：</p>
<ul>
<li>psql：数据库交互工作</li>
<li>initdb：初始化数据库集簇</li>
</ul>
<h1 id="Postgres架构"><a href="#Postgres架构" class="headerlink" title="Postgres架构"></a>Postgres架构</h1><p>PostgreSQL数据库是一种极好可以运行在各种平台上的免费的开放源码的<strong>对象关系数据库</strong>，它是一种以关系数据库和SQL为基础，扩展了抽象数据类型，从而具备面向对象特性的数据库。</p>
<img src="/2021/07/19/Postgresdb%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB/image-20210723161925428.png" class="">
<p><img src="Postgresdb源码解读/image-20210723161925428.png" alt="image-20210723161925428"></p>
<p>PostgreSQL由连接管理系统（系统控制器），编译执行系统，存储管理系统，事务系统，系统表五大部分组成。</p>
<p>连接管理系统接受外部操作对系统的请求，对操作请求进行预处理和分发，起系统逻辑控制作用；</p>
<p>编译执行系统由查询编译器，查询执行器组成，完成操作请求在数据库中的分析处理和转化工作，最终实现物理存储介质中数据的操作；</p>
<p>存储管理系统由索引管理器，内存管理器，外存管理器组成，负责存储和管理物理数据，提供对编译查询系统的支持；</p>
<p>事务系统由事务管理器，日志管理器，并发控制，锁管理器组成，日志管理器和事务管理器完成对操作请求的事务一致性支持，锁管理器和并发控制提供对并发访问数据的一致性支持；</p>
<p>系统表是PostgreSQL数据库的<strong>元信息管理中心</strong>，包括数据库对象信息和数据库管理控制信息。系统表管理元数据信息，将PostgreSQL数据库的各个模块有机地连接在一起，形成一个高效的数据管理系统。</p>
<hr>
<p>系统表是PostgreSQL数据库存放结构元数据的地方，他在PostgreSQL中表现为存放有系统信息的普通表或者视图（用户可以删除，重建）。</p>
<p>系统表保存了数据库的所有元数据，所以系统运行时对系统表的访问是非常频繁的。为了提高系统性能，在内存中建立了共享的系统表，使用Hash表提高查询效率。</p>
<p>主要系统表功能</p>
<p>1 pg_namespace 存储命名空间</p>
<p>2 pg_tablespace 存储表空间信息</p>
<p>3 pg_database 存储当前数据集簇中数据库的信息。</p>
<p>4 pg_class 存储表及与表类似结构的数据库对象信息，包含，索引，序列，视图，复合数据类型，TOAST表等。</p>
<p>5 pg_type 存储数据类型信息。</p>
<p>6 pg_attribute 存储表的属性信息。</p>
<p>7 pg_index 存储索引的具体信息。</p>
<hr>
<p>PostgreSQL数据库系统的主要功能都集中于Main模块中的main函数，在初始化数据集簇，启动数据库服务器时，都将从这里开始执行。Main模块主要的工作时确定当前的操作系统平台，并据此做一些平台相关的环境变量设置和初始化，然后通过对命令行参数的判断，将控制转到相应的模块中去。下图是main函数的调用流程。<br><img src="/2021/07/19/Postgresdb%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB/102035387252554.png" class=""></p>
<p><img src="Postgresdb源码解读/102035387252554.png" alt="img"></p>
<p>PostgreSQL守护进程Postmaster为用户连接请求分配后台(background)Postgres服务进程，还将启动相关的后端(backend)服务进程：SysLogger(系统日志进程)，PgStat(统计数据收集进程)等。</p>
<p>下图为PG 8.0中各个文件夹（模块）之间的调用关系：</p>
<img src="/2021/07/19/Postgresdb%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB/image-20210723160449366.png" class="">
<p><img src="Postgresdb源码解读/image-20210723160449366.png" alt="image-20210723160449366"></p>
<p>下图是PostgreSQL的后台流程图：</p>
<img src="/2021/07/19/Postgresdb%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB/102045321475481.gif" class="">
<p><img src="Postgresdb源码解读/102045321475481.gif" alt="img"></p>
<p>用户调用接口库（ODBC, libpq）把用户请求通过网络发送给Postmaster。</p>
<hr>
<p>PostgreSQL的物理架构非常简单，它由共享内存、一系列后台进程和数据文件组成。 (如下图)</p>
<img src="/2021/07/19/Postgresdb%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB/54f21979bf63cdb48f38312b368c2bca2cb.jpg" class="">
<p><img src="Postgresdb源码解读/54f21979bf63cdb48f38312b368c2bca2cb.jpg" alt="img"></p>
<img src="/2021/07/19/Postgresdb%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB/20180603122143123.jpg" class="">
<p><img src="Postgresdb源码解读/20180603122143123.jpg" alt="img"></p>
<hr>
<h2 id="Memory-Architecture"><a href="#Memory-Architecture" class="headerlink" title="Memory Architecture"></a>Memory Architecture</h2><p>【1】中有很好的图</p>
<img src="/2021/07/19/Postgresdb%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB/fig-2-02.png" class="">
<p><img src="Postgresdb源码解读/fig-2-02.png" alt="Fig. 2.2. Memory architecture in PostgreSQL."></p>
<p>共享内存是服务器服务器为数据库缓存和事务日志缓存预留的内存缓存空间。其中最重要的组成部分是Shared Buffer和WAL Buffer。</p>
<h3 id="Shared-Buffer"><a href="#Shared-Buffer" class="headerlink" title="Shared Buffer"></a>Shared Buffer</h3><p>Shared Buffer的目的是减少磁盘IO。为了达到这个目的，必须满足以下规则：</p>
<ul>
<li>当需要快速访问非常大的缓存时（10G、100G等）</li>
<li>如果有很多用户同时使用缓存，需要将内容尽量缩小</li>
<li>频繁访问的磁盘块必须长期放在缓存中</li>
</ul>
<h3 id="WAL-Buffer"><a href="#WAL-Buffer" class="headerlink" title="WAL Buffer"></a>WAL Buffer</h3><p>WAL Buffer是用来临时存储数据库变化的缓存区域。存储在WAL Buffer(Write-ahead logging)中的内容会根据提前定义好的时间点参数要求写入到磁盘的WAL文件中。在备份和恢复的场景下，WAL Buffer和WAL文件是极其重要的。</p>
<h3 id="Clog"><a href="#Clog" class="headerlink" title="Clog"></a>Clog</h3><p>【1】Commit Log(CLOG) keeps the states of all transactions (e.g., in_progress,committed,aborted) for Concurrency Control (CC) mechanism.</p>
<h2 id="Postgres进程类型"><a href="#Postgres进程类型" class="headerlink" title="Postgres进程类型"></a>Postgres进程类型</h2><p>在【1】官网上有很重要的一句话：A collection of multiple processes cooperatively managing one database cluster is usually referred to as a ‘PostgreSQL server’</p>
<img src="/2021/07/19/Postgresdb%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB/fig-2-01.png" class="">
<p><img src="Postgresdb源码解读/fig-2-01.png" alt="Fig. 2.1. An example of the process architecture in PostgreSQL."></p>
<ul>
<li>A <strong>postgres server process</strong> is a parent of all processes related to a database cluster management.</li>
<li>Each <strong>backend process</strong> handles all queries and statements issued by a connected client.</li>
<li>Various <strong>background processes</strong> perform processes of each feature (e.g., VACUUM and CHECKPOINT processes) for database management.</li>
<li>In the <strong>replication associated processes</strong>, they perform the streaming replication. The details are described in <a target="_blank" rel="noopener" href="https://www.interdb.jp/pg/pgsql11.html">Chapter 11</a>.</li>
<li>In the <strong>background worker process</strong> supported from version 9.3, it can perform any processing implemented by users. As not going into detail here, refer to the <a target="_blank" rel="noopener" href="http://www.postgresql.org/docs/current/static/bgworker.html">official document</a>.</li>
</ul>
<hr>
<p>PostgreSQL有四种进程类型</p>
<ol>
<li>Postmaster (Daemon) Process（主后台驻留进程）</li>
<li>Background Process（后台进程）</li>
<li>Backend Process（后端进程）</li>
<li>Client Process（客户端进程）</li>
</ol>
<h3 id="Postmaster-Process"><a href="#Postmaster-Process" class="headerlink" title="Postmaster Process"></a>Postmaster Process</h3><p>主后台驻留进程是PostgreSQL启动时第一个启动的进程。启动时，他会执行恢复、初始化共享内存。正常服役期间，当有客户端发起链接请求时，它还负责创建后端进程。用户可以通过postmaster，postgres或者pg_ctl命令启动Postmaster。</p>
<p>管理后端的常驻进程，也称为’postmaster’。其默认监听UNIXDomain Socket和TCP/IP（Windows等，一部分的平台只监听tcp/ip）的5432端口，等待来自前端的的连接处理。监听的端口号可以在PostgreSQL的设置文件<code>postgresql.conf</code>里面可以改。</p>
<p>一旦有前端连接过来，Postmaster会根据连接的起始消息对客户端的身份进行验证。验证通过后，postgres会通过fork生成子进程。没有Fork的windows平台的话，则利用createProcess()生成新的进程。这种情形的话，和fork不同的是，父进程的数据不会被继承过来，所以需要利用共享内存把父进程的数据继承过来。</p>
<p>如果通过pstree命令查看进程之间的关系，你会发现Postmaster进程是其他所有进程的父进程。</p>
<img src="/2021/07/19/Postgresdb%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB/e541c9cd90337cb52b4fecb71044f2cd9c0.jpg" class="">
<p><img src="Postgresdb源码解读/e541c9cd90337cb52b4fecb71044f2cd9c0.jpg" alt="img"></p>
<p>Postmaster除了接收客户的消息，还有如下功能：</p>
<ol>
<li>管理整个系统范围的操作，例如中断操作，并指派一个合适的子进程区处理它们；</li>
<li>在起始时建立共享内存和信号库；</li>
</ol>
<p>在<code>/src/backend/postmaster</code>文件夹下，包含下列文件：</p>
<ol>
<li>postmaster进程源文件 postmaster.c</li>
<li>统计数据收集进程的源文件 pqstat.c</li>
<li>预写式日志归档进程的源文件 pgarch.c</li>
<li>后台写进程的源文件 bgwrite.c</li>
<li>系统日志进程的源文件 syslogger.c</li>
<li>系统自动清理进程的源文件 autovacuum.c</li>
</ol>
<h4 id="初始化内存上下文"><a href="#初始化内存上下文" class="headerlink" title="初始化内存上下文"></a>初始化内存上下文</h4><p>调用<code>MemoryContextInt()</code>函数创建<code>TopMemoryContext</code>和<code>ErrorContext</code>，然后调用<code>AllocSetContextCreate()</code>函数以<code>TopMemoryContext</code>为根结点创建<code>PostmasterContext</code>，最后将全局指针<code>CurrentMemoryContext</code>指向<code>PostmasterContext</code>。</p>
<h4 id="配置GUC参数"><a href="#配置GUC参数" class="headerlink" title="配置GUC参数"></a>配置GUC参数</h4><p>在初始化内存环境之后，需要配置Postmaster运行时所需的各种参数。</p>
<p><strong>由GucContext定义的参数的六种类型</strong></p>
<ol>
<li>PGC_INTERNAL: 参数只能内部进程定义</li>
<li>PGC_POSTMASTER：参数只能在Postmaster通过读取配置文件和用户命令行来进行配置</li>
<li>PGC_SIGHUP: 参数只能在postmaster启动时配置，或者改变了数据文件并发送信号SIGHUP通知Postmaster或Postgres的时候进行配置</li>
<li>PGC_BACKEND： 参数只能在启动时读配置文件设置，或由客户端进行连接请求时设置。已经启动的后台进程将忽略此类参数的改变</li>
<li>PGC_USERSET: 可以在任何时候配置</li>
<li>PGC_SUSET: 参数只能在启动时配置或由超级用户通过SQL语言（SET命令）进行设置</li>
</ol>
<p><strong>描述参数来源</strong></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">enum</span>&#123;</span></span><br><span class="line">    PGC_S_DEFAULT, <span class="comment">// 参数设为默认值</span></span><br><span class="line">    PGC_S_ENV_VAR, <span class="comment">// 参数通过环境变量得到</span></span><br><span class="line">    PGC_S_FILE, <span class="comment">// 都配置文件得到</span></span><br><span class="line">    PGC_S_ARGV,  <span class="comment">// 从POSTMASTER命令行得到</span></span><br><span class="line">	PGC_S_DATABASE, <span class="comment">// 数据库安装时指定</span></span><br><span class="line">    PGC_S_USER, <span class="comment">// 用户指定</span></span><br><span class="line">    PGC_S_CLIENT, <span class="comment">// 通过客户端连接请求传送过来的数据包指定</span></span><br><span class="line">    PGC_S_OVERRIDE,</span><br><span class="line">    PGC_S_INTERACTIVE, <span class="comment">// 仅仅作为交互式来源和非交互式来源之间的分隔</span></span><br><span class="line">    PGC_S_TEST, <span class="comment">// 仅用于测试</span></span><br><span class="line">    PGC_S_SESSION <span class="comment">// 通过测试命令设置</span></span><br><span class="line">&#125;GucSource; <span class="comment">// 参数来源，按照优先级递增的顺序排列</span></span><br></pre></td></tr></table></figure>
<p>每一种数据类型的GUC参数都由共性部分和特性部分组成。共性部分由<code>config_generic</code>结构体定义；参数类型config_type是个enum类型，有五种：PGC_BOOL, PGC_INT, PGC_REAL, PGC_STRING和PGC_ENUM。</p>
<p>postmaster配置参数的基本操作是：</p>
<ol>
<li>初始化GUC参数。涉及到<code>build_guc_variables()</code>，<code>initializeGUCOptions()</code>，系统调用<code>getenv()</code>，<code>SetConfigOption()</code></li>
<li>配置GUC参数。postmaster解析命令行并进行配置，设计<code>getopt()</code>和<code>SetConfigOption()</code></li>
<li>读取配置文件。配置文件中的参数不能覆盖之前通过命令行设置的参数。涉及到<code>SelectConfigFiles()</code></li>
</ol>
<h4 id="创建监听套接字"><a href="#创建监听套接字" class="headerlink" title="创建监听套接字"></a>创建监听套接字</h4><p>主要数据结构：</p>
<ol>
<li>ListenAddresses</li>
<li>ListenSocket[MAXLISTEN]</li>
<li>struct addrinfo：<code>getaddrinfo()</code>函数返回与协议无关的套接字时需要关心的信息，如IP，端口等。</li>
</ol>
<p>使用<code>SplitIdentifierString()</code>解析<code>ListenAddress</code>；调用<code>StreamServerPort()</code>在服务器地址上创建监听套接口，并将套接字描述符保存在<code>ListenSocket[]</code>中；之后会依次调用<code>Socket()</code>，<code>bind()</code>, <code>listen()</code>系统函数；之后<code>reset_shared()</code>创建用于进程间通信的共享内存和信号量；在这之后装载用户认证文件<code>pg_hba.conf</code>和<code>pg_ident.conf</code>，初始化<code>BackendList</code>后台进程双向链表。</p>
<p><strong>注册信号处理函数</strong></p>
<p>信号由一个进程发送给另外一个进程。Postmaster定义了三个信号集：<code>BlockSig</code>, <code>UnBlockSig</code>, <code>AuthBlockSig</code>。<code>PG_SETMASK()</code>用于屏蔽所有信号，在设置信号处理函数时使用；<code>pqsignal()</code>注册某个信号的处理函数。</p>
<h4 id="辅助进程启动"><a href="#辅助进程启动" class="headerlink" title="辅助进程启动"></a>辅助进程启动</h4><p>这里面提到<strong>非阻塞IO模式</strong></p>
<p>选项标志变量<code>autovacuum_start_daemon</code>根据GUC配置进行设置，值为真表示autovacuum启动；<code>track_counts</code>是一个GUC选项，标志PgStat是否会进行统计信息的收集。</p>
<h4 id="装载客户端认证文件"><a href="#装载客户端认证文件" class="headerlink" title="装载客户端认证文件"></a>装载客户端认证文件</h4><p>其中，<code>pg_hba.conf</code>是基于主机认证的配置文件；<code>pg_ident.conf</code>是基于身份认证的配置文件。</p>
<h4 id="循环等待客户端连接"><a href="#循环等待客户端连接" class="headerlink" title="循环等待客户端连接"></a>循环等待客户端连接</h4><p>服务进程是<code>Postgres</code>；客户端进程可以是<code>psql</code>进程。</p>
<p>流程是：</p>
<ol>
<li>Postmaster调用<code>ServerLoop()</code>来循环等待客户端的连接请求；</li>
<li>其中，调用<code>initMasks()</code>来初始化Postmaster所关心的读文件描述符集；</li>
<li>接下来，进入死循环当中，调用<code>select</code>系统函数等待客户端提出连接请求；</li>
<li>调用<code>select()</code>系统函数正常返回后，说明<code>ListenSocket[]</code>中有监听套接字有用户连接请求，接着调用<code>ConnCreate()</code>在<code>CurrentContextMemory</code>内存上下文中创建<code>struct Port</code>结构体；</li>
<li>调用<code>BackendStartup()</code>启动后台进程接替Postmaster与用户进行连接，这时Postmaster关闭与用户的连接，释放Port结构体；</li>
<li>调用<code>BackendStartup()</code>根据Port结构体来启动一个Postgres进程：首先调用<code>PostmasterRandom()</code>为即将创建的子进程生成一个随机数，并分配一个<code>struct Backend</code>结构</li>
<li>Postgres进程调用<code>BackendInitialize()</code>获取用户端的相关信息，填写port结构体，调用<code>ClientAuthentication()</code>进行用户认证，调用<code>BackendRun()</code>来设置postgres运行时的命令行参数，调用<code>PostgresMain()</code>进入到Postgres的执行入口。</li>
<li>父进程将随机数和子进程pid填入Backend结构中，在把Backend加入到<code>BackendList</code>链表中，进行管理。</li>
</ol>
<h3 id="Backend-Process"><a href="#Backend-Process" class="headerlink" title="Backend Process"></a>Backend Process</h3><p>【1】中有很重要的一段化：If many clients such as WEB applications frequently repeat the connection and disconnection with a PostgreSQL server, it increases both costs of establishing connections and of creating backend processes because PostgreSQL has not implemented a <strong>native connection pooling feature</strong>. Such circumstance has a negative effect on the performance of database server. To deal with such a case, a <strong>pooling middleware</strong> (either <a target="_blank" rel="noopener" href="https://pgbouncer.github.io/">pgbouncer</a> or <a target="_blank" rel="noopener" href="http://www.pgpool.net/mediawiki/index.php/Main_Page">pgpool-II</a>) is usually used.</p>
<h3 id="Background-Process"><a href="#Background-Process" class="headerlink" title="Background Process"></a>Background Process</h3><p>PostgreSQL操作需要的后台进程列表如下：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>进程</th>
<th>作用</th>
</tr>
</thead>
<tbody>
<tr>
<td>logger</td>
<td>将错误信息写到log日志中</td>
</tr>
<tr>
<td>checkpointer</td>
<td>当检查点出现时，将脏内存块写到数据文件</td>
</tr>
<tr>
<td>writer</td>
<td>周期性的将脏内存块写入文件</td>
</tr>
<tr>
<td>wal writer</td>
<td>将WAL缓存写入WAL文件</td>
</tr>
<tr>
<td>Autovacuum launcher</td>
<td>当自动vacuum被启用时，用来派生autovacuum工作进程。autovacuum进程的作用是在需要时自动对膨胀表执行vacuum操作。</td>
</tr>
<tr>
<td>archiver</td>
<td>在归档模式下时，复制WAL文件到特定的路径下。</td>
</tr>
<tr>
<td>stats collector</td>
<td>用来收集数据库统计信息，例如会话执行信息统计（使用pg_stat_activity视图）和表使用信息统计（pg_stat_all_tables视图）</td>
</tr>
</tbody>
</table>
</div>
<h4 id="Background-Writer-process"><a href="#Background-Writer-process" class="headerlink" title="Background Writer process"></a>Background Writer process</h4><ol>
<li>Writer process在适当的时间点把共享内存上的缓存写往磁盘。通过这个进程，可以防止在检查点的时候(checkpoint),大量的往磁盘写而导致性能恶化，使得服务器可以保持比较稳定的性能。Background writer起来以后就一直常驻内存，但是并非一直在工作，它会在工作一段时间后进行休眠，休眠的时间间隔通过<code>postgresql.conf</code>里面的参数<code>bgwriter_delay</code>设置，默认是200微秒。</li>
<li>这个进程的另外一个重要的功能是定期执行检查点(checkpoint)。检查点的时候，会把共享内存上的缓存内容往数据库文件写，使得内存和文件的状态一致。通过这样，可以在系统崩溃的时候可以缩短从WAL恢复的时间，另外也可以防止WAL无限的增长。 可以通过<code>postgresql.conf</code>的<code>checkpoint_segments</code>、<code>checkpoint_timeout</code>指定执行检查点的时间间隔。</li>
</ol>
<p>Writer进程是把共享内存中的脏页写到磁盘上的进程。它的作用有两个：一是定期把脏数据从内存缓冲区刷出到磁盘中，减少查询时的阻塞；二是PG在定期作检查点时需要把所有脏页写出到磁盘，通过BgWriter预先写出一些脏页，可以减少设置检查点（CheckPoint，数据库恢复技术的一种）时要进行的IO操作，使系统的IO负载趋向平稳。BgWriter是PostgreSQL8.0以后新加的特性，它的机制可以通过<code>postgresql.conf</code>文件中以”bgwriter_”开头配置参数来控制。</p>
<img src="/2021/07/19/Postgresdb%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB/image-20210803102927069.png" class="">
<p><img src="Postgresdb源码解读/image-20210803102927069.png" alt="image-20210803102927069"></p>
<p>有关<code>BgWriter</code>的参数在<code>postgres.conf</code>中定义了一些：<code>bgwriter_delay</code>，<code>bgwriter_lru_maxpages</code>，<code>bgwriter_lru_multiplier</code>。在BgWriter中每隔<code>bgwriter_delay</code>时间可能不会写脏页（一般写脏页），因为检查到需要创建检查点，这时就不要写脏页了，处理“创建检查点”的工作，详情在后面。</p>
<ol>
<li>变量初始化：定义局部变量，完成部分全局变量的赋值操作。（<strong>什么是全局变量，是所有进程共享的变量吗？</strong>）</li>
<li>注册信号处理函数：在信号处理函数中设置一些位：比如<code>got_SIGHUP</code>, <code>checkpoint_requested</code>, <code>shutdown_requested</code>。这些位在后面的“处理信号分支”中要处理。</li>
<li>运行环境初始化：通过<code>ResourceOwnerCreate()</code>创建一个名为<code>Background Writer</code>的资源跟踪器，然后为<code>BgWriter</code>创建运行上下文，并切换到它。</li>
<li>注册异常处理：结合系统调用<code>setjmp()</code>和<code>longjmp()</code>完成异常处理.</li>
<li>处理写磁盘请求：调用<code>AbsorbFsyncRequest()</code>，处理<code>fsync</code>请求队列，将请求发送到<strong>本地的SMGR</strong>。</li>
<li>处理信号分支：每次循环都要检测信号标志变量进行相应处理。比如，<code>got_SIGHUP</code>为true表示重新读取配置文件。</li>
<li>创建检查点。如果没有<strong>创建检查点请求或者创建检查点时间间隔未到</strong>，就调用<code>BgBufferSync()</code>写脏页。否则执行创建检查点操作，分为三个阶段：检查点类型设置，执行检查点创建操作，检查检查点是否创建成功。（<strong>两种检查点类型：do_checkpoint, do_restartpoint有什么区别</strong>）。下面是检查点创建流程：</li>
</ol>
<img src="/2021/07/19/Postgresdb%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB/image-20210803104935505.png" class="">
<p><img src="Postgresdb源码解读/image-20210803104935505.png" alt="image-20210803104935505"></p>
<p>在执行创建检查点阶段，将根据<code>do_restartpoint</code>状态创建检查点或者重启点。在检查点创建后直接设置<code>ckpt_performed</code>为true；而在重启点中将<strong>根据创建检查点成功与否标志设置<code>ckpt_performed</code></strong>。</p>
<h4 id="WAL-writer-process"><a href="#WAL-writer-process" class="headerlink" title="WAL writer process"></a>WAL writer process</h4><p>WAL writer process把共享内存上的WAL缓存在适当的时间点往磁盘写，通过这样，<strong>可以减轻后端进程在写自己的WAL缓存时的压力，提高性能</strong>。另外，<code>非同步提交</code>设为true的时候，可以保证在一定的时间间隔内，把WAL缓存上的内容写入WAL日志文件。</p>
<p>预写式日志WAL（Write Ahead Log，也称为Xlog）的中心思想是对数据文件的修改必须是只能发生在这些修改已经记录到日志之后，也就是先写日志后写数据（日志先行）。使用这种机制可以避免数据频繁的写入磁盘，可以减少磁盘I/O。数据库在宕机重启后可以运用这些WAL日志来恢复数据库。<code>postgresql.conf</code>文件中与WalWriter进程相关的参数如下：</p>
<ol>
<li>wal_level：控制wal存储的级别。wal_level决定有多少信息被写入到WAL中。 默认值是最小的（minimal），其中只写入从崩溃或立即关机中恢复的所需信息。replica 增加 wal 归档信息 同时包括 只读服务器需要的信息。（9.6 中新增，将之前版本的 archive 和 hot_standby 合并）</li>
<li>logical:  主要用于logical decoding 场景</li>
<li>fsync：该参数直接控制日志是否先写入磁盘。默认值是ON（先写入），表示更新数据写入磁盘时系统必须等待WAL的写入完成。可以配置该参数为OFF，表示更新数据写入磁盘完全不用等待WAL的写入完成。</li>
<li><strong>synchronous_commit</strong>：参数配置是否等待WAL完成后才返回给用户事务的状态信息。默认值是ON，表明必须等待WAL完成后才返回事务状态信息；配置成OFF能够更快地反馈回事务状态，也就是异步提交。（<strong>所以到底是同步提交还是异步提交好呢</strong>）</li>
<li>wal_sync_method：WAL写入磁盘的控制方式，默认值是fsync，可选用值包括open_datasync、fdatasync、fsync_writethrough、fsync、open_sync。open_datasync和open_sync分别表示在打开WAL文件时使用O_DSYNC和O_SYNC标志；fdatasync和fsync分别表示在每次提交时调用fdatasync和fsync函数进行数据写入，两个函数都是把操作系统的磁盘缓存写回磁盘，但前者只写入文件的数据部分，而后者还会同步更新文件的属性；fsync_writethrough表示在每次提交并写回磁盘会保证操作系统磁盘缓存和内存中的内容一致。</li>
<li>full_page_writes：表明是否将整个page写入WAL。</li>
<li>wal_buffers：用于存放WAL数据的内存空间大小，系统默认值是64K，该参数还受wal_writer_delay、commit_delay两个参数的影响。</li>
<li>wal_writer_delay：WalWriter进程的写间隔时间，默认值是200毫秒，如果时间过长可能造成WAL缓冲区的内存不足；时间过短将会引起WAL的不断写入，增加磁盘I/O负担。</li>
<li>commit_delay：表示一个已经提交的数据在WAL缓冲区中存放的时间，默认值是0毫秒，表示不用延迟；设置为非0值时事务执行commit后不会立即写入WAL中，而仍存放在WAL缓冲区中，等待WalWriter进程周期性地写入磁盘。</li>
<li>commit_siblings：表示当一个事务发出提交请求时，如果数据库中正在执行的事务数量大于commit_siblings值，则该事务将等待一段时间（commit_delay的值）；否则该事务则直接写入WAL。系统默认值是5，该参数还决定了commit_delay的有效性。</li>
<li>wal_writer_flush_after：当脏数据超过阈值时，会被刷出到磁盘。</li>
</ol>
<p>使用WAL的好处是</p>
<ol>
<li>显著地减少了写磁盘地次数，<strong>因为在日志提交的时候只需要把日志文件刷新到磁盘，而不是事务修改的所有数据文件</strong>；</li>
<li>在多用户环境里，许多事务的提交可以用日志文件的一次<code>fsync</code>来完成；</li>
<li>而且日志文件是顺序写的，因此同步日志的开销远比同步数据块的开销小。</li>
<li>它避免了其他服务进程在事务提交时需要同步地写入预写式日志到磁盘，也使得事务提交记录不是在提交时同步地写入磁盘，而是在一个已知的预先设置的时间异步地写入。</li>
</ol>
<hr>
<ul>
<li>WAL日志存放在数据库集簇（$PGDATA/）下的<code>pg_xlog</code>（现在是<code>pg_wal</code>）目录中，它存储很多段文件，每个不超过16MB。</li>
<li>xlog.h文件中描述了日志记录头格式。</li>
</ul>
<p>一个段文件的名字由24个十六进制的字符组成，分为三个部分：<strong>时间线</strong>，日志文件标号，日志文件的段标号。</p>
<p>默认的WAL缓冲区大小是8个8KB，即64KB。</p>
<h4 id="Archive-process"><a href="#Archive-process" class="headerlink" title="Archive process"></a>Archive process</h4><p>Archive process把WAL日志转移到归档日志里。如果保存了基础备份以及归档日志，即使实在磁盘完全损坏的时候，也可以回复数据库到最新的状态。</p>
<p>类似于Oracle数据库的ARCH归档进程，不同的是ARCH是吧redo log进行归档，PgArch是把WAL日志进行归档。再深入点，WAL日志会被循环使用，也就是说，过去的WAL日志会被新产生的日志覆盖，PgArch进程就是为了在覆盖前把WAL日志备份出来。归档日志的作用是为了数据库能够使用全量备份和备份后产生的归档日志，从而让数据库回到过去的任一时间点。</p>
<p>PgArch进程通过postgresql.conf文件中的如下参数进行</p>
<h4 id="stats-collector-process"><a href="#stats-collector-process" class="headerlink" title="stats collector process"></a>stats collector process</h4><p>统计信息的收集进程。收集好统计表的访问次数，磁盘的访问次数等信息。收集到的信息除了能被autovaccum利用，还可以给其他数据库管理员作为数据库管理的参考信息。</p>
<p>PgStat进程是PostgreSQL数据库的统计信息收集器，用来收集数据库运行期间的统计信息，如表的增删改次数，数据块的个数，索引的变化等等。收集统计信息主要是为了让优化器做出正确的判断，选择最佳的执行计划。postgresql.conf文件中与PgStat进程相关的参数。</p>
<h4 id="logger-process-Syslogger"><a href="#logger-process-Syslogger" class="headerlink" title="logger process(Syslogger)"></a>logger process(Syslogger)</h4><p>把postgresql的活动状态写到日志信息文件（并非事务日志），在指定的时间间隔里面，对日志文件进行rotate.</p>
<p>需要在<code>Postgres.conf</code>中<code>logging_collection</code>设置为<code>on</code>，此时主进程才会启动<code>Syslogger</code>辅助进程。</p>
<h4 id="AutoVacuum-launcher"><a href="#AutoVacuum-launcher" class="headerlink" title="AutoVacuum launcher"></a>AutoVacuum launcher</h4><p>autovacuum launcher process是依赖于postmaster间接autovacuum进程。而其自身是不直接启动autovacuum进程的。通过这样可以提高系统的可靠性。</p>
<p>在PG数据库中，对数据进行UPDATE或者DELETE操作后，数据库不会立即删除旧版本的数据，而是标记为删除状态。这是因为<strong>PG数据库具有多版本的机制</strong>，如果这些旧版本的数据正在被另外的事务打开，那么暂时保留他们是很有必要的。当事务提交后，旧版本的数据已经没有价值了，数据库需要清理垃圾数据腾出空间，而清理工作就是AutoVacuum进程进行的。<code>postgresql.conf</code>文件中与AutoVacuum进程相关的参数有：</p>
<ol>
<li>autovacuum: 是否启动系统自动清理功能，默认是on</li>
<li>autovacuum_max_workers: 设置系统自动清理工作进程(AutoVacuum Process)的最大数量</li>
<li>autovacuum_naptime: 设置两次系统自动清理操作之间的间隔</li>
<li>autovacuum_vacuum_threshold和autovacuum_analyze_threshold: 设置当表上被更新的元组的数量超过这些阈值时分别需要执行vacuum和analyze</li>
<li>autovacuum_freeze_max_age: 设置需要<strong>强制对数据库进行清理的XID上限值</strong></li>
</ol>
<h4 id="AutoVacuum"><a href="#AutoVacuum" class="headerlink" title="AutoVacuum"></a>AutoVacuum</h4><p>autovacuum worker process进程实际执行vacuum的任务。有时候会同时启动多个vacuum进程。</p>
<h4 id="checkpoint"><a href="#checkpoint" class="headerlink" title="checkpoint"></a>checkpoint</h4><p>检查点是系统设置的事务序列点，设置检查点保证<strong>检查点前的日志信息刷到磁盘</strong>中。postgresql.conf文件中与之相关的参数有：m </p>
<h3 id="Backend-Process（Postgres进程）"><a href="#Backend-Process（Postgres进程）" class="headerlink" title="Backend Process（Postgres进程）"></a>Backend Process（Postgres进程）</h3><p>最大后台链接数通过max_connections参数设定，默认值为100。后端进程用于处理前端用户请求并返回结果。查询运行时需要一些内存结构，就是所谓的本地内存（local memory）。本地内存涉及的主要参数有：</p>
<ol>
<li>work_mem：用于排序、位图索引、哈希链接和合并链接操作。默认值为4MB。</li>
<li>maintenance_work_mem：用于vacuum和创建索引操作。默认值为64MB。</li>
<li>temp_buffers：用于临时表。默认值为8MB。</li>
</ol>
<p>源码位于<code>src/backend/tcop</code>文件夹下：</p>
<ol>
<li>postgres.c: Postgres的入口文件，负责管理查询的整体流程</li>
<li>pquery.c 执行一个分析好的查询命令</li>
<li>utility.c：对于非查询命令进行处理的</li>
<li>dest.c：处理Postgres和远端客户的一些消息通信操作，并负责返回命令的执行结果。</li>
</ol>
<h1 id="数据库结构"><a href="#数据库结构" class="headerlink" title="数据库结构"></a>数据库结构</h1><p>想要理解PostgreSQL的数据库结构，需要先了解一些重要的概念。</p>
<p>数据库相关概念：</p>
<ol>
<li>PostgreSQL由一系列数据库组成。一套PostgreSQL程序称之为一个数据库群集。</li>
<li>当initdb()命令执行后，template0 , template1 , 和postgres数据库被创建。</li>
<li>template0和template1数据库是创建用户数据库时使用的模版数据库，他们包含系统元数据表。</li>
<li>initdb刚完成后，template0和template1数据库中的表是一样的。但是template1数据库可以根据用户需要创建对象。</li>
<li>用户数据库是通过克隆template1数据库来创建的；</li>
</ol>
<p>表空间相关概念：</p>
<ol>
<li>initdb后马上创建pg_default和pg_global表空间。</li>
<li>建表时如果没有指定特定的表空间，表默认被存在pg_default表空间中。</li>
<li>用于管理整个数据库集群的表默认被存储在pg_global表空间中。</li>
<li>pg_default表空间的物理位置为$PGDATA/base目录。</li>
<li>pg_global表空间的物理位置为$PGDATA/global目录。</li>
<li>一个表空间可以被多个数据库同时使用。此时，每一个数据库都会在表空间路径下创建一个新的子路径。</li>
<li>创建一个用户表空间会在$PGDATA\pg_tblspc目录下面创建一个软连接，连接到表空间指定的目录位置。</li>
</ol>
<p>表相关概念：</p>
<ol>
<li>每个表有三个数据文件。</li>
<li>一个文件用于存储数据，文件名是表的OID。</li>
<li>一个文件用于管理表的空闲空间，文件名是OID_fsm。</li>
<li>一个文件用于管理表的块是否可见，文件名是OID_vm。</li>
<li>索引没有_vm文件，只有OID和OID_fsm两个文件</li>
</ol>
<p><strong>其他需要注意的地方</strong></p>
<p>表和索引创建时文件名是OID，此时的OID和pg_class.relfilenode的值是一样的。不管怎样，当我们执行重写操作时（truncate，cluster，vacuum full，reindex等），被修改对象的relfilenode值也会被修改，文件名也会随着reffilenode值一起改变。我们可以通过pg_relation_filepath(‘<object_name>‘)视图很容易的检查文件位置和名称。</p>
<h2 id="数据库集簇的逻辑结构"><a href="#数据库集簇的逻辑结构" class="headerlink" title="数据库集簇的逻辑结构"></a>数据库集簇的逻辑结构</h2><p>参考：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/feishujun/p/PostgreSQLSourceAnalysis_intro01.html">https://www.cnblogs.com/feishujun/p/PostgreSQLSourceAnalysis_intro01.html</a></p>
<p>Postgresql的所有数据都存储在数据目录里面，这个数据目录通常会用<strong>环境变量PGDATA</strong>来引用。</p>
<p>PGDATA中除了表空间pg_default和pg_global的物理目录（PGDATA/base，PGDATA/global）还保存有数据库集簇的配置文件和其他子目录：</p>
<img src="/2021/07/19/Postgresdb%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB/image-20210802101817550.png" class="">
<p><img src="Postgresdb源码解读/image-20210802101817550.png" alt="image-20210802101817550"></p>
<h2 id="系统表"><a href="#系统表" class="headerlink" title="系统表"></a>系统表</h2><p>系统表存储各种<strong>数据库对象</strong>的元信息，数据库对象可以是数据库，表，元组，索引，表空间等。</p>
<p>系统表由SQL命令关联的系统表操作自动维护系统表信息，比如创建数据库语句会向<code>pg_database</code>系统表中插入一行，并且在磁盘上创建该数据库。</p>
<p>内存中建立了共享的系统表cache，使用Hash函数和Hash表来提高查询效率，因为系统运行时对系统表的访问是非常频繁的。</p>
<p>系统表定义文件和函数实现文件：</p>
<ul>
<li>在<code>/src/include/catalog</code>下有若干以<code>pg_xxx</code>开头的.h文件，定义了系统表，其中的<code>indexing.h</code>文件定义了所有的系统表<strong>索引</strong>，toasting.h定义了所有系统表的TOAST表。</li>
<li>实现文件在<code>/src/backend/catalog</code>目录下。</li>
</ul>
<p>系统表在initdb阶段完成创建。</p>
<h3 id="主要系统表功能"><a href="#主要系统表功能" class="headerlink" title="主要系统表功能"></a>主要系统表功能</h3><h4 id="pg-namespace"><a href="#pg-namespace" class="headerlink" title="pg_namespace"></a>pg_namespace</h4><p>pg_namespace表中只存储了每个命名空间的名字，所有者的OID以及对该命名空间的访问权限列表，也没有存储明明空间下的所有<strong>对象</strong>啊。</p>
<h4 id="pg-tablespace"><a href="#pg-tablespace" class="headerlink" title="pg_tablespace"></a>pg_tablespace</h4><p>整个集簇范围内共享的系统表，表空间。决定数据库对象的存放位置，比如把一个经常访问的索引访放在<code>/testDir</code>的表空间，并且一个很贵的SSD是挂载在<code>/testDir</code>目录的，那样的话，访问这个索引的性能就提高了。</p>
<h4 id="pg-database"><a href="#pg-database" class="headerlink" title="pg_database"></a>pg_database</h4><p>整个集簇范围内共享的系统表。</p>
<p>数据库是定义在某个表空间下的。</p>
<p>pg_database中有一个属性叫做<code>datfrozenxid</code>，类型是<code>TransactionId</code>，所有在这个事务ID之前的事务，都被替换为一个永久冻结的ID，该属性用来跟踪该数据库是否需要进行vacuum操作。</p>
<h4 id="pg-class"><a href="#pg-class" class="headerlink" title="pg_class"></a>pg_class</h4><p>存储表，索引，序列，视图，复合数据类型，TOAST表等数据库对象的元信息。</p>
<p>下面列出一些重要的属性的信息。</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>属性名</th>
<th>数据类型</th>
<th>注释</th>
</tr>
</thead>
<tbody>
<tr>
<td>relam</td>
<td>OID</td>
<td>对于索引对象，该字段显示索引方式的OID，如B-Tree，Hash等</td>
</tr>
<tr>
<td>relfilenode</td>
<td>OID</td>
<td>对象所在的磁盘文件名称</td>
</tr>
<tr>
<td>reltablespace</td>
<td>OID</td>
<td>对象所在的表空间</td>
</tr>
<tr>
<td>relpages</td>
<td>int4</td>
<td>对象的磁盘页面数，该属性被计划器使用</td>
</tr>
<tr>
<td>reltuples</td>
<td>float4</td>
<td>表中的元组数</td>
</tr>
<tr>
<td>reltoastrelid</td>
<td>OID</td>
<td>如果关联了TOAST，则表示TOAST表的OID</td>
</tr>
<tr>
<td>reltoastidxid</td>
<td>OID</td>
<td>可能存在的TOAST表的索引的OID</td>
</tr>
<tr>
<td>relhasindex</td>
<td>bool</td>
<td>该表是否有索引</td>
</tr>
<tr>
<td>relkind</td>
<td>char</td>
<td>数据库对象的类型，r表示表，I表示索引，S表示序列，v表示视图，c表示复合类型，t表示TOAST表</td>
</tr>
<tr>
<td>relnatts</td>
<td>int2</td>
<td>属性的数目，隐藏属性不包含</td>
</tr>
<tr>
<td>relfrozenxid</td>
<td>xid</td>
<td>所有在这个事务ID之前的事务，都被替换为一个永久冻结的ID，该属性用来跟踪该表是否需要进行vacuum操作。</td>
</tr>
</tbody>
</table>
</div>
<h4 id="pg-type"><a href="#pg-type" class="headerlink" title="pg_type"></a>pg_type</h4><p>该表中每一个元组表示一个数据类型。</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>属性名</th>
<th>数据类型</th>
<th>注释</th>
</tr>
</thead>
<tbody>
<tr>
<td>typstorage</td>
<td>char</td>
<td>记录变长类型的存储方式，主要用于TOAST技术，这个属性有四种取值：p,e,m,x。分别对应TOAST技术中的四种变长类型的存储策略</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
</tbody>
</table>
</div>
<h4 id="pg-attribute"><a href="#pg-attribute" class="headerlink" title="pg_attribute"></a>pg_attribute</h4><p>存储表的属性信息。数据库中表的每个属性在pg_attribute中都有一个元组</p>
<h4 id="pg-index"><a href="#pg-index" class="headerlink" title="pg_index"></a>pg_index</h4><h2 id="inidb"><a href="#inidb" class="headerlink" title="inidb"></a>inidb</h2><p>在安装好postgres后，将安装目录下的bin文件夹加入到环境变量中，这个目录中有很多独立的程序。初始化数据库集簇进行初始化，创建模板数据库和系统表，并向系统表中插入初始元组，在这之后，用户创建的各种数据库，表，视图，索引等数据库对象和其他操作，都是在模板数据库和系统表的基础上进行。</p>
<h3 id="postgres-bki"><a href="#postgres-bki" class="headerlink" title="postgres.bki"></a>postgres.bki</h3><p>在源代码编译时，genbki.sh脚本（<code>/src/backend/catalog</code>目录下的）读取<code>/src/include/catalog</code>目录下的<code>.h</code>结尾的系统表定义文件创建postgres.bki，并且放在安装树的share子目录下（安装树是不同于PGDATA的另一个目录，编译后的INSTALL阶段会创建该目录）。</p>
<p>在initdb阶段，postgres.bki脚本会被执行，通常是create或insert一些系统关键表。</p>
<h3 id="initdb流程"><a href="#initdb流程" class="headerlink" title="initdb流程"></a>initdb流程</h3><img src="/2021/07/19/Postgresdb%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB/image-20210802110208403.png" class="">
<p><img src="Postgresdb源码解读/image-20210802110208403.png" alt="image-20210802110208403"></p>
<h1 id="存储管理"><a href="#存储管理" class="headerlink" title="存储管理"></a>存储管理</h1><img src="/2021/07/19/Postgresdb%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB/image-20210812100520993.png" class="">
<p><img src="Postgresdb源码解读/image-20210812100520993.png" alt="image-20210812100520993"></p>
<h1 id="concurrency-control"><a href="#concurrency-control" class="headerlink" title="concurrency control"></a>concurrency control</h1><p>【2】PostgreSQL使用MVCC实现并发控制（Muti-Version Concurrency Control）。</p>
<p>When a transaction reads a data item, the system <strong>selects one of the versions</strong> to ensure isolation of the individual transaction。The main advantage of MVCC is that <strong>readers don’t block writers, and writers don’t block readers</strong>。PostgreSQL and some RDBMSs use a variation of MVCC called <strong>Snapshot Isolation (SI)</strong>.</p>
<h2 id="snapshot"><a href="#snapshot" class="headerlink" title="snapshot"></a>snapshot</h2><p>【2】 In the READ COMMITTED isolation level, the transaction obtains a snapshot whenever an SQL command is executed; otherwise (REPEATABLE READ or SERIALIZABLE), the transaction only gets a snapshot <strong>when the first SQL command is executed</strong>。</p>
<h1 id="Write-Ahead-Logging-WAL"><a href="#Write-Ahead-Logging-WAL" class="headerlink" title="Write Ahead Logging(WAL)"></a>Write Ahead Logging(WAL)</h1><p>执行下面的SQL语句</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> tbl <span class="keyword">VALUES</span> (<span class="string">&#x27;A&#x27;</span>);</span><br></pre></td></tr></table></figure>
<p>会触发<code>exec_simple_query()</code>函数，下面是这个函数的伪代码</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">exec_simple_query</span>() @postgres.<span class="built_in">c</span></span><br><span class="line"></span><br><span class="line">(<span class="number">1</span>) <span class="built_in">ExtendCLOG</span>() @clog.c                  <span class="comment">/* Write the state of this transaction</span></span><br><span class="line"><span class="comment">                                           * &quot;IN_PROGRESS&quot; to the CLOG.</span></span><br><span class="line"><span class="comment">                                           */</span></span><br><span class="line">(<span class="number">2</span>) <span class="built_in">heap_insert</span>()@heapam.c                <span class="comment">/* Insert a tuple, creates a XLOG record,</span></span><br><span class="line"><span class="comment">                                           * and invoke the function XLogInsert.</span></span><br><span class="line"><span class="comment">                                           */</span></span><br><span class="line">(<span class="number">3</span>)   <span class="built_in">XLogInsert</span>() @xlog.<span class="built_in">c</span> (<span class="number">9.5</span> <span class="keyword">or</span> later, xloginsert.c)</span><br><span class="line">                                          <span class="comment">/* Write the XLOG record of the inserted tuple</span></span><br><span class="line"><span class="comment">                                           *  to the WAL buffer, and update page&#x27;s pd_lsn.</span></span><br><span class="line"><span class="comment">                                           */</span></span><br><span class="line">(<span class="number">4</span>) <span class="built_in">finish_xact_command</span>() @postgres.c     <span class="comment">/* Invoke commit action.*/</span>   </span><br><span class="line">      <span class="built_in">XLogInsert</span>() @xlog.<span class="built_in">c</span>  (<span class="number">9.5</span> <span class="keyword">or</span> later, xloginsert.c)</span><br><span class="line">                                          <span class="comment">/* Write a XLOG record of this commit action </span></span><br><span class="line"><span class="comment">                                           * to the WAL buffer.</span></span><br><span class="line"><span class="comment">                                           */</span></span><br><span class="line">(<span class="number">5</span>)   <span class="built_in">XLogWrite</span>() @xlog.c                 <span class="comment">/* Write and flush all XLOG records on </span></span><br><span class="line"><span class="comment">                                           * the WAL buffer to WAL segment.</span></span><br><span class="line"><span class="comment">                                           */</span></span><br><span class="line">(<span class="number">6</span>) <span class="built_in">TransactionIdCommitTree</span>() @transam.c  <span class="comment">/* Change the state of this transaction </span></span><br><span class="line"><span class="comment">                                           * from &quot;IN_PROGRESS&quot; to &quot;COMMITTED&quot; on the CLOG.</span></span><br><span class="line"><span class="comment">                                           */</span></span><br></pre></td></tr></table></figure>
<h2 id="Page-oriented-Log"><a href="#Page-oriented-Log" class="headerlink" title="Page-oriented Log"></a>Page-oriented Log</h2><p>【3】在明白了XLOG的结构之后，我们就可以来解释什么叫做Page-oriented Log了。从XLOG的信息中，我们不难发现，XLOG描述了一条元组应该被写入到哪个页面的什么位置。从heap_insert的流程中，我们也不难发现，当一条元组写入数据页面后，我们就立即为这次写入操作生成一个XLOG，并写入log buffer。也就是说XLOG描述了页面中的数据变化，这就是Page-oriented Log。与之相对应的是逻辑日志（logic log），逻辑日志通常只是记录一条SQL语句，在redo时，会重新执行这条SQL语句。所以对于Page-oriented Log而言，在redo时元组总是写入到先前写入的那个页面，但对于逻辑日志，redo时的写入就很随意了。</p>
<p>对于Page-oriented Log又分为物理日志和物理逻辑日志两种。前面提到过，对于物理日志会记录元组插入页面中的物理位置（ItemIdData中lp_off的值），而对于物理逻辑日志，只记录元组插入页面中的逻辑位置（ItemIdData自身的偏移）。</p>
<p>对于物理日志而言，由于记录了元组的实际偏移，所以在redo时只用定位到实际位置，然后直接覆盖原有元组（不管元组有没有落盘），这种操作本身是具有幂等性的，不论执行多少次redo结果都一样。但这个方式有一个问题，就是一旦块做了整理（比如：vacuum操作）那么元组的物理位置会发生变化。为了保持精确的物理信息，整理也会产生大量物理日志，这非常影响性能。</p>
<p>所以PostgreSQL采用的是物理逻辑日志，所谓物理是指记录了元组实际插入的数据页，所谓逻辑具体写入到数据页中的什么位置是一个逻辑的值。这样在vacuum的时候只需要保持ItemIdData的位置不变，就没有任何影响。但是物理逻辑日志本身不具有幂等性，如果不加任何处理直接多次redo的话，就会写入多条数据。所以对于物理逻辑日志需要一种手段来判断该XLOG是否需要在对应页面中进行redo操作，这也就是所谓的LSN。这部分内容后面会由专门的文档进行说明。</p>
<h1 id="插入数据源码解读"><a href="#插入数据源码解读" class="headerlink" title="插入数据源码解读"></a>插入数据源码解读</h1><h2 id="heap-insert"><a href="#heap-insert" class="headerlink" title="heap_insert()"></a>heap_insert()</h2><p>在<code>src/backend/access/heap/heapam.c</code>文件中</p>
<p>输入：</p>
<ol>
<li>HeapTuple tup是用户要插入的原始数据，不包含tuple头部信息；</li>
</ol>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span> heap_prepare_insert()</span><br><span class="line">   Fill in tuple header fields and toast the tuple <span class="keyword">if</span> necessary.</span><br><span class="line"><span class="number">2.</span> buffer = RelationGetBufferForTuple()</span><br><span class="line">   Find buffer to insert this tuple into.  If the page is all visible,</span><br><span class="line">   this will also pin the requisite visibility <span class="keyword">map</span> page.</span><br><span class="line"><span class="number">3.</span> RelationPutHeapTuple()</span><br><span class="line">   将tup插入对应的共享缓冲区中</span><br><span class="line"><span class="number">4.</span> 标志buffer为脏页</span><br><span class="line">   <span class="comment">/*</span></span><br><span class="line"><span class="comment">    *下面是关于xlog的，更详细的信息在“WAL相关源码解读”中阅读</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line"><span class="number">5.</span> xl_heap_insert xlrec;</span><br><span class="line">   xl_heap_header xlhdr;</span><br><span class="line">   Page		page = BufferGetPage(buffer);</span><br><span class="line">   解析关于tup的信息到xlrec和xlhdr中，page是buffer对应的实际内存页</span><br><span class="line"><span class="number">6.</span> XLogRegisterData((char *) &amp;xlrec, SizeOfHeapInsert);</span><br><span class="line">   将xl_heap_insert数据插入到mainrdata链表中</span><br><span class="line"><span class="number">7.</span> XLogRegisterBuffer(<span class="number">0</span>, buffer, REGBUF_STANDARD | bufflags);</span><br><span class="line">   XLogRegisterBufData(<span class="number">0</span>, (char *) &amp;xlhdr, SizeOfHeapHeader);</span><br><span class="line">   XLogRegisterBufData(<span class="number">0</span>,</span><br><span class="line">					 (char *) heaptup-&gt;t_data + SizeofHeapTupleHeader,</span><br><span class="line">					 heaptup-&gt;t_len - SizeofHeapTupleHeader);</span><br><span class="line">   <span class="comment">/*</span></span><br><span class="line"><span class="comment">    * XLog分为很多部分：其中RelFileNode+BlockNumber, xl_heap_header, 元组具体数据,</span></span><br><span class="line"><span class="comment">                         xl_heap_insert已经加入到wal buffer中</span></span><br><span class="line"><span class="comment">                      XLogRecord, XLogRecordBlockHeader, mainrdata_len还没有</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>构建WAL记录准备（在heap_insert()中写好的）：参考【4】。构建后，内存中的XLogRecData链表是什么样：</p>
<p><img src="Postgresdb源码解读/1567945832709627.png" alt="1567945832709627"></p>
<h3 id="heap-prepare-insert"><a href="#heap-prepare-insert" class="headerlink" title="heap_prepare_insert()"></a>heap_prepare_insert()</h3><p>把原来的tup里面的数据补充完整，为了之后的元组插入做准备，比如：补充tup的头部信息和toast相关信息</p>
<p>参数：</p>
<ol>
<li>TransactionId xid 哪个事务要插入这个tuple</li>
<li>HeapTuple tup 要插入的tuple，但是只有原始数据，不包含关于头部信息</li>
<li>options 标志位，比如：指定是否是冻结型插入（虽然我还不知道什么是冻结型插入）</li>
<li>Relation relation 关于要插入的表的模式信息</li>
</ol>
<p>返回值：</p>
<ol>
<li>HeapTuple tup 返回一个准备好的tuple</li>
</ol>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span> 暂不支持并行操作;</span><br><span class="line"><span class="number">2.</span> 设置tup的t_data-&gt;t_infomask和t_data-&gt;t_infomask2属性;</span><br><span class="line"><span class="number">3.</span> <span class="built_in">HeapTupleHeaderSetXmin</span>(tup-&gt;t_data, xid)设置tup-&gt;t_data的的xmin属性</span><br><span class="line">    xmin就是哪个事务要插入这个tup;</span><br><span class="line"><span class="number">4.</span> <span class="keyword">if</span>(options &amp; HEAP_INSERT_FROZEN) 判断是否是冻结型插入，如果是就把</span><br><span class="line">    t_data-&gt;t_infomask的HEAP_XMIN_FROZEN位设置了;</span><br><span class="line"><span class="number">5.</span> <span class="built_in">RelationGetRelid</span>(relation) 得到要插入的表的Oid，然后设置tup;</span><br><span class="line"><span class="number">6.</span> toast操作，忽略;</span><br></pre></td></tr></table></figure>
<h3 id="RelationGetBufferForTuple"><a href="#RelationGetBufferForTuple" class="headerlink" title="RelationGetBufferForTuple()"></a>RelationGetBufferForTuple()</h3><p>在<code>src/backend/access/heap/hio.c</code>文件中。</p>
<p>输入：现在是不知道这个tuple应该插入表中的哪个block的，当然也不知道应该插入到共享缓存区中的哪个Buffer; </p>
<ol>
<li>Relation relation 要插入的表的模式信息</li>
<li>Size len 要插入表的长度</li>
<li>Buffer otherBuffer 见下面的解释</li>
<li>BulkInsertState bistate 和替换策略有关 </li>
<li>int options 选项：比如是否是冻结型插入，是否使用fsm等</li>
</ol>
<figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">otherBuffer</span>这个参数让人觉得困惑，原因是<span class="variable">PG</span>的机制使然</span><br><span class="line"></span><br><span class="line">  <span class="built_in">Update</span>时，不是原地更新，而是原数据保留（更新<span class="variable">xmax</span>），新数据插入</span><br><span class="line"></span><br><span class="line">  原数据<span class="operator">&amp;</span>新数据如果在不同<span class="built_in">Block</span>中，锁定<span class="built_in">Block</span>的时候可能会出现<span class="variable">Deadlock</span></span><br><span class="line"></span><br><span class="line">  举个例子：<span class="variable">Session</span> <span class="variable">A</span>更新表<span class="variable">T</span>的第一行，第一行在<span class="built_in">Block</span> <span class="number">0</span>中，新数据存储在<span class="built_in">Block</span> <span class="number">2</span>中</span><br><span class="line"></span><br><span class="line">​       <span class="variable">Session</span> <span class="variable">B</span>更新表<span class="variable">T</span>的第二行，第二行在<span class="built_in">Block</span> <span class="number">0</span>中，新数据存储在<span class="built_in">Block</span> <span class="number">2</span>中</span><br><span class="line"></span><br><span class="line">​       <span class="built_in">Block</span> <span class="number">0</span><span class="operator">/</span><span class="number">2</span>均要锁定才能完整实现<span class="built_in">Update</span>操作：</span><br><span class="line"></span><br><span class="line">​       如果<span class="variable">Session</span> <span class="variable">A</span>先锁定了<span class="built_in">Block</span> <span class="number">2</span>，<span class="variable">Session</span> <span class="variable">B</span>先锁定了<span class="built_in">Block</span> <span class="number">0</span>，</span><br><span class="line"></span><br><span class="line">​       然后<span class="variable">Session</span> <span class="variable">A</span>尝试锁定<span class="built_in">Block</span> <span class="number">0</span>，<span class="variable">Session</span> <span class="variable">B</span>尝试锁定<span class="built_in">Block</span> <span class="number">2</span>，这时候就会出现死锁</span><br><span class="line"></span><br><span class="line">​       为了避免这种情况，<span class="variable">PG</span>规定锁定时，同一个<span class="variable">Relation</span>，按<span class="built_in">Block</span>的编号顺序锁定，</span><br><span class="line"></span><br><span class="line">​       如需要锁定<span class="number">0</span>和<span class="number">2</span>，那必须先锁定<span class="built_in">Block</span> <span class="number">0</span>，再锁定<span class="number">2</span></span><br></pre></td></tr></table></figure>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Pinned <span class="keyword">buffers：means </span><span class="keyword">buffers </span>are currently <span class="keyword">being </span>used,it <span class="keyword">should </span>not <span class="keyword">be </span>flushed out.</span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// hio.h(src/include/access/hio.h)</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * state for bulk inserts --- private to heapam.c and hio.c</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * If current_buf isn&#x27;t InvalidBuffer, then we are holding an extra pin</span></span><br><span class="line"><span class="comment"> * on that buffer.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &quot;typedef struct BulkInsertStateData *BulkInsertState&quot; is in heapam.h</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">BulkInsertStateData</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">	BufferAccessStrategy strategy;	<span class="comment">/* our BULKWRITE strategy object */</span></span><br><span class="line">	Buffer		current_buf;	<span class="comment">/* current insertion target page */</span></span><br><span class="line">&#125; BulkInsertStateData;</span><br><span class="line"><span class="comment">// current_buf到底是干什么用的，为什么它会有pin?</span></span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span> 根据otherBuffer判断是不是单纯的insert,不能是update;</span><br><span class="line"><span class="number">2.</span> 计算的len是align之后的tuple长度，判断tuple是不是太大了以至于超过MaxHeapTupleSize;</span><br><span class="line"><span class="number">3.</span> Relation relation中保存了desired extra freespace,通过<span class="built_in">RelationGetTargetPageFreeSpace</span>()</span><br><span class="line">    来计算saveFreeSpace;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * We first try to put the tuple on the same page we last inserted a tuple</span></span><br><span class="line"><span class="comment">     * on, as cached in the BulkInsertState or relcache entry.  If that</span></span><br><span class="line"><span class="comment">     * doesn&#x27;t work, we ask the Free Space Map to locate a suitable page.</span></span><br><span class="line"><span class="comment">     * Since the FSM&#x27;s info might be out of date, we have to be prepared to</span></span><br><span class="line"><span class="comment">     * loop around and retry multiple times. (To insure this isn&#x27;t an infinite</span></span><br><span class="line"><span class="comment">     * loop, we must update the FSM with the correct amount of free space on</span></span><br><span class="line"><span class="comment">     * each page that proves not to be suitable.)  If the FSM has no record of</span></span><br><span class="line"><span class="comment">     * a page with enough free space, we give up and extend the relation.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * When use_fsm is false, we either put the tuple onto the existing target</span></span><br><span class="line"><span class="comment">     * page or extend the relation.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="number">4.</span> 按照上述方法找到targetBlock:要么是<span class="string">&quot;the same page we last inserted a tuple on&quot;</span></span><br><span class="line">    要么是从freespace中找到的一个合适的blockNumber，要么是表中的最后一个blockNumber</span><br><span class="line">    要么是InvalidBlockNumber;(这个时候还不知道block对应的缓冲区Buffer是什么)</span><br><span class="line">	targetBlock = <span class="built_in">GetPageWithFreeSpace</span>();</span><br><span class="line"><span class="number">5.</span> <span class="keyword">while</span> targetBlock!=InvalidBlockNumber;</span><br><span class="line"><span class="number">6.</span>		<span class="keyword">if</span> otherBuffer是InvalidBuffer;</span><br><span class="line">			使用 <span class="built_in">ReadBufferBI</span>()计算<span class="function">buffer</span></span><br><span class="line"><span class="function">    		<span class="title">PageIsAllVisible</span><span class="params">(BufferGetPage(buffer),visiblitymap_pin(targetBlock)</span></span></span><br><span class="line"><span class="params"><span class="function">            LockBuffer(buffer);</span></span></span><br><span class="line"><span class="params"><span class="function"><span class="number">7.</span>		<span class="keyword">else</span> <span class="keyword">if</span> otherBlock和targetBlcok相同;</span></span></span><br><span class="line"><span class="params"><span class="function">			说明两个元组操作动用的是同一个块</span></span></span><br><span class="line"><span class="params"><span class="function">    		targetBlock=otherBlock, buffer=otherBuffer</span></span></span><br><span class="line"><span class="params"><span class="function">    		PageIsAllVisible(BufferGetPage(buffer),visibilitymap_pin(targetBlock),</span></span></span><br><span class="line"><span class="params"><span class="function">            LockBuffer(buffer);</span></span></span><br><span class="line"><span class="params"><span class="function"><span class="number">8.</span> 		<span class="keyword">else</span> <span class="keyword">if</span> otherBlock &lt; targetBlock;</span></span></span><br><span class="line"><span class="params"><span class="function">			说明上次元组操作用的块号比较小，所以根据锁的规则, otherBuffer先上锁</span></span></span><br><span class="line"><span class="params"><span class="function">            buffer=ReadBuffer(relation,targetBlock) 根据块号找到对应的Buffer</span></span></span><br><span class="line"><span class="params"><span class="function">            PageIsAllVisible(BufferGetPage(buffer), visibilitymap_pin(targetBlock)</span></span></span><br><span class="line"><span class="params"><span class="function">            LockBuffer(otherBuffer)</span></span></span><br><span class="line"><span class="params"><span class="function">            LockBuffer(buffer);</span></span></span><br><span class="line"><span class="params"><span class="function"><span class="number">9.</span>		<span class="keyword">else</span>;</span></span></span><br><span class="line"><span class="params"><span class="function">			这个情况和<span class="number">8</span>相反，先给buffer上锁，再给otherBuffer上锁;</span></span></span><br><span class="line"><span class="params"><span class="function"><span class="number">10.</span> 	<span class="comment">/*</span></span></span></span><br><span class="line"><span class="comment"><span class="params"><span class="function">		 * 虽然buffer已经上锁了，但是这个buffer不一定是我们需要的，</span></span></span></span><br><span class="line"><span class="comment"><span class="params"><span class="function">		 * 如果buffer是来自于上一次操作的页，那么要判断剩余空间是否够;</span></span></span></span><br><span class="line"><span class="comment"><span class="params"><span class="function">		 * 如果buffer来自于fsm分析的来的，那么当时访问的fsm有可能不是最新的，所以还是要</span></span></span></span><br><span class="line"><span class="comment"><span class="params"><span class="function">		 * 判断buffer的剩余空间是否够</span></span></span></span><br><span class="line"><span class="comment"><span class="params"><span class="function">		 */</span>;</span></span></span><br><span class="line"><span class="params"><span class="function">        page = BufferGetPage(buffer);</span></span></span><br><span class="line"><span class="params"><span class="function"><span class="number">11.</span>		如果有必要，可能要初始化以下这个page PageInit(), MarkBufferDirty();</span></span></span><br><span class="line"><span class="params"><span class="function"><span class="number">12.</span>		如果page的剩余空间够用: RelationSetTargetBlock(), 返回buffer;</span></span></span><br><span class="line"><span class="params"><span class="function"><span class="number">13.</span> 	如果不够用，那么只能释放buffer和otherBuffer的lock和pin;</span></span></span><br><span class="line"><span class="params"><span class="function"><span class="number">14.</span>		Update FSM as to condition of <span class="keyword">this</span> page, <span class="keyword">and</span> ask <span class="keyword">for</span> another page</span></span></span><br><span class="line"><span class="params"><span class="function">		to <span class="keyword">try</span>;</span></span></span><br><span class="line"><span class="params"><span class="function">        targetBlock = RecordAndGetPageWithFreeSpace();</span></span></span><br><span class="line"><span class="params"><span class="function"></span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="comment">/*</span></span></span></span><br><span class="line"><span class="comment"><span class="params"><span class="function">     * 此时表的所有块没有一个满足条件，所以只能区扩展表了</span></span></span></span><br><span class="line"><span class="comment"><span class="params"><span class="function">     * 要扩展表，首先要给表上锁，防止此时有别的进程页给同样的表进行扩展</span></span></span></span><br><span class="line"><span class="comment"><span class="params"><span class="function">     */</span></span></span></span><br><span class="line"><span class="params"><span class="function"><span class="number">15.</span> LockRelationForExtension(); 在上锁之前，执行了ConditionalLockRelationForExtension(),</span></span></span><br><span class="line"><span class="params"><span class="function">    表示如果别的进程已经拿到锁了，就直接返回<span class="literal">false</span>,不要block,否则就拿锁,返回<span class="literal">true</span>;              </span></span></span><br><span class="line"><span class="params"><span class="function"><span class="number">16.</span> 在等到锁的过程中，别的进程可能已经给表扩展了, 所以要再次检查fsm;</span></span></span><br><span class="line"><span class="params"><span class="function">    GetPageWithFreeSpace();</span></span></span><br><span class="line"><span class="params"><span class="function">    如果找到了合适的块号，就释放表的锁，返回<span class="number">5</span></span></span></span><br><span class="line"><span class="params"><span class="function">    否则，就给表进行扩展, RelationAddExtraBlocks();</span></span></span><br><span class="line"><span class="params"><span class="function"><span class="number">17.</span> buffer = ReadBufferBI(); targetBlcok参数是P_NEW,意味着读取一个新页</span></span></span><br><span class="line"><span class="params"><span class="function">    page = BufferGetPage(buffer);</span></span></span><br><span class="line"><span class="params"><span class="function"><span class="number">18.</span> 初始化这个page PageInit(), MarkBufferDirty();</span></span></span><br><span class="line"><span class="params"><span class="function"><span class="number">19.</span> </span></span></span><br><span class="line"><span class="params"><span class="function"></span></span></span><br><span class="line"><span class="params"><span class="function">                             </span></span></span><br><span class="line"><span class="params"><span class="function">                             </span></span></span><br></pre></td></tr></table></figure>
<h3 id="ReadBufferBI"><a href="#ReadBufferBI" class="headerlink" title="ReadBufferBI()"></a>ReadBufferBI()</h3><p>我们现在知道了blockNumber是什么了，所以可以根据这个来找到对应的Buffer，给这个Buffer增加refcount，并设置bistate的current_buf是这个Buffer。</p>
<p>输入：</p>
<ol>
<li>Relation relation</li>
<li>BlockNumber targetBlock</li>
<li>BulkInsertState bistate</li>
</ol>
<p>输出：</p>
<ol>
<li>Buffer</li>
</ol>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span> <span class="keyword">if</span> !bistate 如果不是bulk-insert;</span><br><span class="line"><span class="number">2.</span> <span class="keyword">if</span> targetBlock就是bistate-&gt;current_buf对应的blockNumber;</span><br><span class="line"><span class="number">3.</span> 		增加current_buf的refcount, 返回current_buf;</span><br><span class="line"><span class="number">4.</span> current_buf-&gt;refcount减<span class="number">1</span>，current_buf变为InvalidBuffer;</span><br><span class="line"><span class="number">5.</span> 此时，targetBlock可能是从fsm里面找到的合适的block，所以</span><br><span class="line">   读取对应的Buffer</span><br><span class="line">   buffer = <span class="built_in">ReadBufferExtended</span>();</span><br><span class="line"><span class="number">6.</span> 增加buffer-&gt;refcount, current_buf变为buffer, 返回buffer</span><br></pre></td></tr></table></figure>
<h1 id="WAL相关源码解读"><a href="#WAL相关源码解读" class="headerlink" title="WAL相关源码解读"></a>WAL相关源码解读</h1><p>参考 【3】</p>
<p>XLOG日志的写入其实有两个非常重要的步骤：</p>
<ul>
<li>将XLOG写入log buffer</li>
<li>将log buffer中的XLOG落盘</li>
</ul>
<h2 id="XLog组成"><a href="#XLog组成" class="headerlink" title="XLog组成"></a>XLog组成</h2><p>XLog的结构是由以下几个结构体定义的：（参考：【3】）</p>
<ol>
<li>struct XLogRecord：XLog的第一个部分，表示XLog头部。<br>其中，xl_tot_len记录了XLog的总长度；<br>xl_xid记录产生这个XLog的事务id；<br>xl_prev表示前一条日志的物理偏移（LSN）；<br>xl_rmid表示资源管理器号，表示当前正在做的是什么操作，当后面恢复的时候就可以调用相应的函数来redo，比如对于insert操作，它的日志的xl_rmid就是RM_HEAP_ID，后面redo时就用heap_redo；</li>
<li>XLogRecordBlockHeader：XLog的第二个部分，称为块头部；</li>
<li>紧接着XLogRecordBlockHeader就是RelFileNode和BlockNumber；</li>
<li>xl_heap_header：XLog的第三个部分的第一部分，存储了heap_tuple的部分头部信息，比如t_infomask2，t_infomask，t_hoff；</li>
<li>元组具体数据：XLog的第三个部分的第二个部分；这部分数据和插入元组时写入buffer中的数据完全一样；</li>
<li>xl_heap_insert：XLog的第四个部分；存储了该元组在物理块中的偏移（是ItemIdData，也即ItemPointer，在页面中的偏移，例如，这个元组在页面中对应第2个ItemPointer，那么在xl_heap_insert中就存储2，而不是元组实体在页面中的偏移）；<strong>以这种方式记录的日志称为物理逻辑日志</strong>；如果记录的是元组实体的偏移，就称为物理日志；</li>
</ol>
<h2 id="XLogRegister相关函数"><a href="#XLogRegister相关函数" class="headerlink" title="XLogRegister相关函数"></a>XLogRegister相关函数</h2><p>XLog在磁盘页中的组织是连续的，比如XLogRecord，然后紧接着存储XLogRecordBlockHeader；但是，在XLog落盘之前，在内存中却不是这么存储的，在内存中是以链表的形式存储；XLogRecData链表链接了XLog的各个部分。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/include/access/xlog_internal.h</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * The functions in xloginsert.c construct a chain of XLogRecData structs</span></span><br><span class="line"><span class="comment"> * to represent the final WAL record.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">XLogRecData</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">XLogRecData</span> *<span class="title">next</span>;</span>	<span class="comment">/* next struct in chain, or NULL */</span></span><br><span class="line">	<span class="keyword">char</span>	   *data;			<span class="comment">/* start of rmgr data to include */</span></span><br><span class="line">	uint32		len;			<span class="comment">/* length of rmgr data to include */</span></span><br><span class="line">&#125; XLogRecData;</span><br></pre></td></tr></table></figure>
<h3 id="XLogRegisterData"><a href="#XLogRegisterData" class="headerlink" title="XLogRegisterData()"></a>XLogRegisterData()</h3><p>把xl_heap_insert类型的xlrec追加到”main chunk”中</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">xl_heap_insert</span>&#123;</span></span><br><span class="line">    OffsetNumber offnum;</span><br><span class="line">    uint8 flags;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* src/backend/access/transam/xloginsert.c/XLogRegisterData()</span></span><br><span class="line"><span class="comment"> * input: </span></span><br><span class="line"><span class="comment"> *   1. char *data</span></span><br><span class="line"><span class="comment"> *   2. int len</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="number">1.</span> <span class="comment">// rdatas是保存XLogRecData类型数据的数组</span></span><br><span class="line">   <span class="comment">// num_rdatas是应该插入在rdatas中的下标</span></span><br><span class="line">   <span class="comment">// max_rdatas是最大的插入数量</span></span><br><span class="line">   rdata = &amp;rdatas[num_rdatas++]中</span><br><span class="line"><span class="number">2.</span> rdata中保存data</span><br><span class="line">   mainrdata_last-&gt;next = rdata</span><br><span class="line">   mainrdata_last = rdata</span><br><span class="line">   (以上三个操作可总结为将rdata插入到mainrdata链表中)</span><br></pre></td></tr></table></figure>
<p>有些注意点：</p>
<ol>
<li>rdatas：rdatas数组是为了防止频繁分配和释放空间带来的性能开销，在进程初始化时，又调用InitXLogInsert() 预先分配的一个数组（所以，rdatas可能是在local buffer中的）。在实际使用时，需要注册的数据个数，大于数组大小，则直接报错。</li>
<li>mainrdata链表：调用XLogRegisterData() 注册的数据，会被链接到mainrdata链表中。mainrdata_len表示mainrdata链表上所有数据的总长度。</li>
</ol>
<h3 id="XLogRegisterBuffer"><a href="#XLogRegisterBuffer" class="headerlink" title="XLogRegisterBuffer()"></a>XLogRegisterBuffer()</h3><p>我们不难发现在调用XLogRegisterBufData注册xl_heap_header和元组具体数据之前，先调用了XLogRegisterBuffer。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/backend/access/transam/xloginsert.c/XLogRegisterBuffer()</span></span><br><span class="line"><span class="number">1.</span> 从全局数组registered_buffers中获取一个registered_buffer对象regbuf</span><br><span class="line"><span class="number">2.</span> 将页面信息（relfilenode，forkNumber和blockNumber，以及标志位flags）写入regbuf中</span><br><span class="line"><span class="number">3.</span> regbuf-&gt;rdata_head和regbuf-&gt;rdata_tail初始化为同一个XLogRecData数据的指针，指向</span><br><span class="line">   一个链表的头和尾</span><br></pre></td></tr></table></figure>
<h3 id="XLogRegisterBufData"><a href="#XLogRegisterBufData" class="headerlink" title="XLogRegisterBufData()"></a>XLogRegisterBufData()</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/backend/access/transam/xloginsert.c/XLogRegisterBufData()</span></span><br><span class="line"><span class="number">1.</span> 从全局rdatas数组中获取一个XLogRecData对象的指针rdata</span><br><span class="line"><span class="number">2.</span> 把数据（比如xl_heap_header，元组具体数据）写入rdata中</span><br><span class="line"><span class="number">3.</span> 将rdata追加到regbuf链表中</span><br></pre></td></tr></table></figure>
<h2 id="XLogRecordAssemble"><a href="#XLogRecordAssemble" class="headerlink" title="XLogRecordAssemble()"></a>XLogRecordAssemble()</h2><p>将XLog的四个部分：XLog的header portion（包括XLogRecord，XLogRecordBlockHeader，RelFileNode, BlockNumber，mainrdata_len）；xl_heap_header；元组具体数据；xl_heap_insert 链接成链表，每个都存储在XLogRecData结构体中。</p>
<p>在调用XLogRecordAssemble()之前，其实已经调用了很多XLogRegister相关函数，已经将xl_heap_insert链接到mainradata_head链表中，把xl_heap_header，元组具体数据链接到regbuf-&gt;rdata_head中；</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/backend/access/transam.c/XLogRecordAssemble()</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// hdr_scratch是提前分配的空间，它尽可能地大，以包含最大的XLog header portion（XLog头部）</span></span><br><span class="line"><span class="number">1.</span> XLogRecData类型的hdr_rdt是上述链表的头结点, hdr_rdt-&gt;next指向hdr_scratch;</span><br><span class="line">   hdr_scratch指向XLog的header portion;</span><br><span class="line"><span class="number">2.</span> </span><br></pre></td></tr></table></figure>
<h2 id="XLogInsertRecord"><a href="#XLogInsertRecord" class="headerlink" title="XLogInsertRecord()"></a>XLogInsertRecord()</h2><p>要插入XLog buffer的数据都已经准备好了，保存在XLogRecData类型的hdr_rdt链表中，XLogInsertRecord()真正将链表中的数据写入到XLog buffer中。</p>
<p>输入：</p>
<ol>
<li>XLogRecData *rdata XLogRecData类型的hdr_rdt链表</li>
</ol>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/backend/access/transam/xlog.c</span></span><br><span class="line"><span class="number">1.</span> ReserveXLogInsertLocation()</span><br><span class="line">   向xlog buffer申请空间，为即将写入的XLOG预留空间。</span><br><span class="line"><span class="number">2.</span> CopyXLogRecordToWAL()</span><br><span class="line">   将rdata链表中的数据写入申请的xlog buffer空间。</span><br></pre></td></tr></table></figure>
<h1 id="引用"><a href="#引用" class="headerlink" title="引用"></a>引用</h1><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/eagle89/article/details/80390145">https://blog.csdn.net/eagle89/article/details/80390145</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/igoodful/p/11822247.html">https://www.cnblogs.com/igoodful/p/11822247.html</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/xzwspy/article/details/80555624">https://blog.csdn.net/xzwspy/article/details/80555624</a></p>
<p>什么是WAL：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/hzmark/p/wal.html">https://www.cnblogs.com/hzmark/p/wal.html</a></p>
<p>数据库集簇：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/feishujun/p/PostgreSQLSourceAnalysis_intro01.html">https://www.cnblogs.com/feishujun/p/PostgreSQLSourceAnalysis_intro01.html</a></p>
<p>【1】<a target="_blank" rel="noopener" href="https://www.interdb.jp/pg/pgsql02.html#_2.1">https://www.interdb.jp/pg/pgsql02.html#_2.1</a>.</p>
<p>【2】Concurrency Control <a target="_blank" rel="noopener" href="https://www.interdb.jp/pg/pgsql05.html">https://www.interdb.jp/pg/pgsql05.html</a></p>
<p>【3】PostgreSQL重启恢复—-XLOG 1.0：<a target="_blank" rel="noopener" href="https://blog.csdn.net/obvious__/article/details/119242661?ops_request_misc=&amp;request_id=&amp;biz_id=102&amp;utm_term=XLogRegistered&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduweb~default-1-119242661.first_rank_v2_pc_rank_v29&amp;spm=1018.2226.3001.4187">https://blog.csdn.net/obvious__/article/details/119242661?ops_request_misc=&amp;request_id=&amp;biz_id=102&amp;utm_term=XLogRegistered&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduweb~default-1-119242661.first_rank_v2_pc_rank_v29&amp;spm=1018.2226.3001.4187</a></p>
<p>【4】PostgreSQL WAL解析：构建WAL记录准备：<a target="_blank" rel="noopener" href="https://blog.51cto.com/yanzongshuai/2436618">https://blog.51cto.com/yanzongshuai/2436618</a></p>
<h1 id="网址"><a href="#网址" class="headerlink" title="网址"></a>网址</h1><p>官网：<a target="_blank" rel="noopener" href="https://www.postgresql.org/">https://www.postgresql.org/</a></p>
<p>文档：www.interdb.jp/pg/pgsql08.html</p>
<p><a target="_blank" rel="noopener" href="http://blog.itpub.net/6906/">http://blog.itpub.net/6906/</a></p>
<p>【读书】postgres数据库学习书籍列表+博客地址：<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_37611270/article/details/94443613?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522162702198016780269823482%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fall.%2522%257D&amp;request_id=162702198016780269823482&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_v2~rank_v29-18-94443613.pc_search_result_cache&amp;utm_term=postgres%E6%BA%90%E7%A0%81&amp;spm=1018.2226.3001.4187">https://blog.csdn.net/qq_37611270/article/details/94443613?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522162702198016780269823482%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fall.%2522%257D&amp;request_id=162702198016780269823482&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_v2~rank_v29-18-94443613.pc_search_result_cache&amp;utm_term=postgres%E6%BA%90%E7%A0%81&amp;spm=1018.2226.3001.4187</a></p>
<p>PostgreSql源码阅读笔记（思维导图）：<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_37517281/article/details/104401373?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522162702198016780269823482%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fall.%2522%257D&amp;request_id=162702198016780269823482&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_v2~rank_v29-5-104401373.pc_search_result_cache&amp;utm_term=postgres%E6%BA%90%E7%A0%81&amp;spm=1018.2226.3001.4187">https://blog.csdn.net/qq_37517281/article/details/104401373?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522162702198016780269823482%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fall.%2522%257D&amp;request_id=162702198016780269823482&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_v2~rank_v29-5-104401373.pc_search_result_cache&amp;utm_term=postgres%E6%BA%90%E7%A0%81&amp;spm=1018.2226.3001.4187</a></p>
<p>yzs大神似乎很会研究PostgreSQL <a target="_blank" rel="noopener" href="https://blog.51cto.com/yanzongshuai">https://blog.51cto.com/yanzongshuai</a></p>
<p>PostgreSQL WAL解析：构建WAL记录准备 <a target="_blank" rel="noopener" href="https://blog.51cto.com/yanzongshuai/2436618">https://blog.51cto.com/yanzongshuai/2436618</a></p>
<p>postgres预写式日志的内核实现详解-wal记录写入：<a target="_blank" rel="noopener" href="https://www.chinacion.cn/article/4871.html">https://www.chinacion.cn/article/4871.html</a></p>
<p>PostgreSQL重启恢复—-XLOG 2.0：<a target="_blank" rel="noopener" href="https://blog.csdn.net/obvious__/article/details/119242908?ops_request_misc=&amp;request_id=&amp;biz_id=102&amp;utm_term=XLogRegistered&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduweb~default-0-119242908.first_rank_v2_pc_rank_v29">https://blog.csdn.net/obvious__/article/details/119242908?ops_request_misc=&amp;request_id=&amp;biz_id=102&amp;utm_term=XLogRegistered&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduweb~default-0-119242908.first_rank_v2_pc_rank_v29</a></p>

      

      
    </div>
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color4">数据库</a>
        		</li>
      		
		</ul>
	</div>

      

      
        <p class="article-more-link">
          <a class="article-more-a" href="/2021/07/19/Postgresdb%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB/">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>

<aside class="wrap-side-operation">
    <div class="mod-side-operation">
        
        <div class="jump-container" id="js-jump-container" style="display:none;">
            <a href="javascript:void(0)" class="mod-side-operation__jump-to-top">
                <i class="icon-font icon-back"></i>
            </a>
            <div id="js-jump-plan-container" class="jump-plan-container" style="top: -11px;">
                <i class="icon-font icon-plane jump-plane"></i>
            </div>
        </div>
        
        
    </div>
</aside>




  
    <article id="post-数据结构基础" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/06/14/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%9F%BA%E7%A1%80/">数据结构基础</a>
    </h1>
  

        
        <a href="/2021/06/14/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%9F%BA%E7%A1%80/" class="archive-article-date">
  	<time datetime="2021-06-15T03:08:24.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2021-06-14</time>
</a>
        
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>e</p>
<h1 id="二叉树"><a href="#二叉树" class="headerlink" title="二叉树"></a>二叉树</h1><h2 id="二叉树的基本操作"><a href="#二叉树的基本操作" class="headerlink" title="二叉树的基本操作"></a>二叉树的基本操作</h2><p><strong>定义二叉树</strong></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Node</span>&#123;</span></span><br><span class="line">	<span class="keyword">int</span> data;</span><br><span class="line">    Node* lchild;</span><br><span class="line">    Node* rchild;</span><br><span class="line">    <span class="keyword">int</span> layer;</span><br><span class="line">    <span class="built_in">Node</span>(<span class="keyword">int</span> v)&#123;</span><br><span class="line">        data = v;</span><br><span class="line">        lchild = rchild = <span class="literal">nullptr</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>二叉树结点的插入</strong></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//基于二叉树的性质的插入方法</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(Node* &amp;root, <span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(root == <span class="literal">nullptr</span>)&#123;</span><br><span class="line">        root = <span class="keyword">new</span> <span class="built_in">Node</span>(x);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(由于二叉树的性质，应该插入在左子树)&#123;</span><br><span class="line">        <span class="built_in">insert</span>(root-&gt;lchild,x);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="built_in">insert</span>(root-&gt;rchild,x);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>二叉树的建立</strong></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Node* <span class="title">Create</span><span class="params">(<span class="keyword">int</span> data[],<span class="keyword">int</span> n)</span></span>&#123;</span><br><span class="line">    Node* root = <span class="literal">nullptr</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;n;++i)&#123;</span><br><span class="line">        <span class="built_in">insert</span>(root,data[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> root;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>先序遍历</strong></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//递归写法</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Preorder</span><span class="params">(Node* root)</span></span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(root == <span class="literal">nullptr</span>)</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,root-&gt;data); <span class="comment">//访问结点</span></span><br><span class="line">    <span class="built_in">preorder</span>(root-&gt;lchild);</span><br><span class="line">    <span class="built_in">preorder</span>(root-&gt;rchild);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>层序遍历</strong></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Layerorder</span><span class="params">(Node* root)</span></span>&#123;</span><br><span class="line">    queue&lt;Node*&gt; q;</span><br><span class="line">    root-&gt;layer = <span class="number">0</span>;</span><br><span class="line">    q.<span class="built_in">push</span>(root); <span class="comment">//初始化队列</span></span><br><span class="line">    <span class="keyword">while</span>(!q.<span class="built_in">empty</span>())&#123;</span><br><span class="line">        Node* now = q.<span class="built_in">front</span>();</span><br><span class="line">        q.<span class="built_in">pop</span>();</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>,now-&gt;data); <span class="comment">//访问元素</span></span><br><span class="line">        <span class="keyword">if</span>(now-&gt;lchild)&#123;</span><br><span class="line">            now-&gt;lchild-&gt;layer = now-&gt;layer+<span class="number">1</span>;</span><br><span class="line">            q.<span class="built_in">push</span>(now-&gt;lchild);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(now-&gt;rchild)&#123;</span><br><span class="line">            now-&gt;rchild-&gt;layer = now-&gt;layer+<span class="number">1</span>;</span><br><span class="line">            q.<span class="built_in">push</span>(now-&gt;rchild);</span><br><span class="line">        &#125; </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="二叉查找树"><a href="#二叉查找树" class="headerlink" title="二叉查找树"></a>二叉查找树</h2><p><strong>寻找root的后继结点</strong></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Node* <span class="title">Findnext</span><span class="params">(Node* root)</span></span>&#123;</span><br><span class="line">    <span class="keyword">while</span>(root-&gt;rchild != <span class="literal">nullptr</span>)</span><br><span class="line">        root = root-&gt;rchild;</span><br><span class="line">    <span class="keyword">return</span> root;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>寻找root的前驱节点</strong></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Node* <span class="title">Findpre</span><span class="params">(Node* root)</span></span>&#123;</span><br><span class="line">    <span class="keyword">while</span>(root-&gt;lchild != <span class="literal">nullptr</span>)</span><br><span class="line">        root = root-&gt;lchild;</span><br><span class="line">    <span class="keyword">return</span> root;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>删除以root为根的树中权值为x的结点</strong></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//通过一个一个地移动结点来删除结点</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">DeleteNode</span><span class="params">(Node* &amp;root,<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(root == <span class="literal">nullptr</span>)</span><br><span class="line">        <span class="keyword">return</span>; <span class="comment">//不存在权值为x地结点</span></span><br><span class="line">    <span class="keyword">if</span>(root-&gt;data == x)&#123;</span><br><span class="line">        <span class="comment">//找到了欲删除的结点</span></span><br><span class="line">        <span class="keyword">if</span>(root-&gt;lchild == <span class="literal">nullptr</span> &amp;&amp; root-&gt;rchild == <span class="literal">nullptr</span>)&#123;</span><br><span class="line">            <span class="keyword">delete</span> root;</span><br><span class="line">            root = <span class="literal">nullptr</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(root-&gt;lchildd != <span class="literal">nullptr</span>)&#123;</span><br><span class="line">            Node* pre = <span class="built_in">Findpre</span>(root-&gt;lchild); <span class="comment">//找root前驱</span></span><br><span class="line">            root-&gt;data = pre-&gt;data; <span class="comment">//用前驱覆盖root</span></span><br><span class="line">            <span class="built_in">DeleteNode</span>(root-&gt;lchild,pre-&gt;data);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            Node* next = <span class="built_in">Findnext</span>(root-&gt;rchild); <span class="comment">//找root后继</span></span><br><span class="line">            root-&gt;data = next-&gt;data;</span><br><span class="line">            <span class="built_in">DeleteNode</span>(root-&gt;rchild,next-&gt;data);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span>(root-&gt;data &gt; x)&#123;</span><br><span class="line">        <span class="built_in">DeleteNode</span>(root-&gt;lchild,x);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="built_in">DeleteNode</span>(root-&gt;rchild,x);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="AVL树"><a href="#AVL树" class="headerlink" title="AVL树"></a>AVL树</h2><p><strong>AVL树的结点</strong></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Node</span>&#123;</span></span><br><span class="line">    <span class="keyword">int</span> v, height; <span class="comment">//权值，高度</span></span><br><span class="line">    Node* lchild, *rchild;</span><br><span class="line">    <span class="built_in">Node</span>(<span class="keyword">int</span> vv)&#123;</span><br><span class="line">        v = vv;</span><br><span class="line">        height = <span class="number">1</span>;</span><br><span class="line">        lchild = rchild = <span class="literal">nullptr</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>得到树的高度</strong></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">getHeight</span><span class="params">(Node* root)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(root == <span class="literal">nullptr</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">return</span> root-&gt;height;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>得到树的平衡因子</strong></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">getBalanceFactor</span><span class="params">(Node* root)</span></span>&#123;</span><br><span class="line">	<span class="comment">//左子树的高度减去右子树的高度</span></span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">getHeight</span>(root-&gt;lchild)-<span class="built_in">getHeight</span>(root-&gt;rchild);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>更新树的高度</strong></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">updateHeight</span><span class="params">(Node* root)</span></span>&#123;</span><br><span class="line">    <span class="comment">//更新root的高度</span></span><br><span class="line">    root-&gt;height = <span class="built_in">max</span>(<span class="built_in">getHeight</span>(root-&gt;lchild),<span class="built_in">getHeight</span>(root-&gt;rchild))+<span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这个函数在后面的左旋，右旋和插入操作中要用到。</p>
<p><strong>AVL树的左旋右旋操作</strong></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">L</span><span class="params">(Node* &amp;root)</span></span>&#123;</span><br><span class="line">    Node* temp = root-&gt;rchild; <span class="comment">//temp是root的右子节点</span></span><br><span class="line">    root-&gt;rchild = temp-&gt;lchild; <span class="comment">//temp的左子节点变为root的右子节点</span></span><br><span class="line">    temp-&gt;lchild = root; <span class="comment">//root变为temp的左子结点</span></span><br><span class="line">    <span class="built_in">updateHeight</span>(root);</span><br><span class="line">    <span class="built_in">updateHeight</span>(temp);</span><br><span class="line">    root = temp;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">R</span><span class="params">(Node* &amp;root)</span></span>&#123;</span><br><span class="line">    Node* temp = root-&gt;lchild; <span class="comment">//temp是root的右子节点</span></span><br><span class="line">    root-&gt;lchild = temp-&gt;rchild; <span class="comment">//temp的左子节点变为root的右子节点</span></span><br><span class="line">    temp-&gt;rchild = root; <span class="comment">//root变为temp的左子结点</span></span><br><span class="line">    <span class="built_in">updateHeight</span>(root);</span><br><span class="line">    <span class="built_in">updateHeight</span>(temp);</span><br><span class="line">    root = temp;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>AVL树的插入操作</strong></p>
<p>只要把最靠近插入节点的失衡结点调整到正常，就好了。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(Node* &amp;root, <span class="keyword">int</span> v)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(root == <span class="literal">nullptr</span>)&#123;</span><br><span class="line">        root = <span class="keyword">new</span> <span class="built_in">Node</span>(v);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(v &lt; root-&gt;v)&#123; <span class="comment">//v比根节点的权值小</span></span><br><span class="line">        <span class="built_in">insert</span>(root-&gt;lchild,v);</span><br><span class="line">        <span class="built_in">updateHeight</span>(root);</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">getBalanceFactor</span>(root) == <span class="number">2</span>)&#123; <span class="comment">//插入结点后有子树失衡</span></span><br><span class="line">            <span class="keyword">if</span>(<span class="built_in">getBalanceFactor</span>(root-&gt;lchild)==<span class="number">1</span>)&#123; <span class="comment">//LL型</span></span><br><span class="line">                <span class="built_in">R</span>(root);</span><br><span class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="built_in">getBalanceFactor</span>(root-&gt;lchild)==<span class="number">-1</span>)&#123; <span class="comment">//LR型</span></span><br><span class="line">                <span class="built_in">L</span>(root-&gt;lchild);</span><br><span class="line">                <span class="built_in">R</span>(root);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123; <span class="comment">//v比根节点的权值大</span></span><br><span class="line">        <span class="built_in">insert</span>(root-&gt;rchild,v);</span><br><span class="line">        <span class="built_in">updateHeight</span>(root);</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">getBalanceFactor</span>(root) == <span class="number">-2</span>)&#123; <span class="comment">//插入结点后有子树失衡</span></span><br><span class="line">            <span class="keyword">if</span>(<span class="built_in">getBalanceFactor</span>(root-&gt;lchild)==<span class="number">-1</span>)&#123; <span class="comment">//RR型</span></span><br><span class="line">                <span class="built_in">L</span>(root);</span><br><span class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="built_in">getBalanceFactor</span>(root-&gt;lchild)==<span class="number">1</span>)&#123; <span class="comment">//RL型</span></span><br><span class="line">                <span class="built_in">R</span>(root-&gt;lchild);</span><br><span class="line">                <span class="built_in">L</span>(root);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>AVL树的删除操作</strong></p>
<p>AVL树删除节点的过程是，先找到该节点，然后进行删除。由于删除节点的位置不同，导致删除后节点进行移动的方式不同。删除节点的位置分为以下4类：</p>
<ol>
<li>删除叶子结点。操作：直接删除，然后依次向上调整为AVL树。这种情况下，可能会产生AVL树失衡</li>
<li>删除非叶子节点，该节点只有左孩子。操作：该节点的值替换为左孩子节点的值，然后删除左孩子节点。这种情况下不会产生AVL树失衡的。</li>
<li>删除非叶子节点，该节点只有右孩子。操作：该节点的值替换为右孩子节点的值，然后删除右孩子节点。这种情况下不会产生AVL树失衡的。</li>
<li>删除非叶子节点，该节点既有左孩子，又有右孩子。操作：该节点的值替换为该节点的前驱节点（或者后继节点），然后删除前驱节点（或者后继节点）。这种情况下不会产生AVL树失衡的。</li>
</ol>
<p>第一种情况：</p>
<p><img src="数据结构基础/20200418173233362.png" alt="img"></p>
<img src="/2021/06/14/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%9F%BA%E7%A1%80/20200418173233362.png" class="">
<p><img src="数据结构基础/20200418173550484.png" alt="img"></p>
<img src="/2021/06/14/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%9F%BA%E7%A1%80/20200418173550484.png" class="">
<p>第二种情况：</p>
<p><img src="数据结构基础/20200418174425322.png" alt="img"></p>
<img src="/2021/06/14/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%9F%BA%E7%A1%80/20200418174425322.png" class="">
<p>第三种情况：</p>
<p><img src="数据结构基础/2020041817570775.png" alt="img"></p>
<img src="/2021/06/14/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%9F%BA%E7%A1%80/2020041817570775.png" class="">
<p>第四种情况：</p>
<p><img src="数据结构基础/20200418180925175.png" alt="img"></p>
<img src="/2021/06/14/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%9F%BA%E7%A1%80/20200418180925175.png" class="">
<p><img src="数据结构基础/20200418181649249.png" alt="img"></p>
<img src="/2021/06/14/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%9F%BA%E7%A1%80/20200418181649249.png" class="">
<h2 id="堆"><a href="#堆" class="headerlink" title="堆"></a>堆</h2><p>为了方便计算子节点在数组中的位置，第一个元素的下标为1</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxn = <span class="number">100</span>;</span><br><span class="line"><span class="comment">//heap为堆，n为元素个数</span></span><br><span class="line"><span class="keyword">int</span> heap[maxn],n=<span class="number">10</span>;</span><br></pre></td></tr></table></figure>
<p><strong>向下调整</strong></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">downAdjust</span><span class="params">(<span class="keyword">int</span> low,<span class="keyword">int</span> high)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i= low, j = i*<span class="number">2</span>; <span class="comment">//i为欲调整结点，j为其左儿子结点</span></span><br><span class="line">    <span class="keyword">while</span>(j &lt;= high)&#123; <span class="comment">//假如存在孩子结点</span></span><br><span class="line">        <span class="keyword">if</span>(j+<span class="number">1</span> &lt;= high &amp;&amp; heap[j+<span class="number">1</span>]&gt;heap[j])&#123; <span class="comment">//如果右孩子存在</span></span><br><span class="line">            j = j+<span class="number">1</span>; <span class="comment">//j存放右孩子下标</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(heap[j] &gt; heap[i])&#123; <span class="comment">//如果孩子中最大的权值比欲调整结点大</span></span><br><span class="line">            <span class="built_in">swap</span>(heap[j],heap[i]);</span><br><span class="line">            i = j;</span><br><span class="line">            j = i*<span class="number">2</span>;</span><br><span class="line">		&#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">break</span>; <span class="comment">//孩子的权值均比欲调整结点小，算法结束</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>downAdjust算法用于创建堆</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">createHeap</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=n/<span class="number">2</span>;i&gt;=<span class="number">1</span>;i--)&#123;</span><br><span class="line">        <span class="built_in">downAdjust</span>(i,n);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>删除堆顶元素</strong></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">deleteTop</span><span class="params">()</span></span>&#123;</span><br><span class="line">    heap[<span class="number">1</span>] = heap[n--]; <span class="comment">//用最后一个元素覆盖堆顶元素，并让元素个数减1</span></span><br><span class="line">    <span class="built_in">downAdjust</span>(<span class="number">1</span>,n);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>向堆中添加一个元素</strong></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//low一般为1，high为欲调整结点的数组下标</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">upAdjust</span><span class="params">(<span class="keyword">int</span> low,<span class="keyword">int</span> high)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i = high, j = i/<span class="number">2</span>; <span class="comment">//i为欲调整结点，j为i的父亲</span></span><br><span class="line">    <span class="keyword">while</span>(j &gt;= low)&#123; <span class="comment">//父亲在[low,high]范围内</span></span><br><span class="line">        <span class="keyword">if</span>(heap[j] &lt; heap[i])&#123; <span class="comment">//父亲权值小于欲调整结点i的权值</span></span><br><span class="line">            <span class="built_in">swap</span>(heap[j],heap[i]);</span><br><span class="line">            i = j;</span><br><span class="line">            j = i/<span class="number">2</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">break</span>; <span class="comment">//父亲权值比欲调整结点的权值大，结束</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>堆排序</strong></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">heapSort</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">createHeap</span>(); <span class="comment">//建堆</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=n;i&gt;<span class="number">1</span>;i--)&#123;</span><br><span class="line">        <span class="built_in">swap</span>(heap[i],heap[<span class="number">1</span>]);</span><br><span class="line">        <span class="built_in">downAdjust</span>(<span class="number">1</span>,i<span class="number">-1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="哈夫曼树"><a href="#哈夫曼树" class="headerlink" title="哈夫曼树"></a>哈夫曼树</h2><p>如何得到最终的树的带权路径长度</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="comment">//小顶堆的优先队列</span></span><br><span class="line">priority_queue&lt;<span class="keyword">long</span> <span class="keyword">long</span>, vector&lt;<span class="keyword">long</span> <span class="keyword">long</span>&gt;, greater&lt;<span class="keyword">long</span> <span class="keyword">long</span>&gt;&gt; q;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="图"><a href="#图" class="headerlink" title="图"></a>图</h1><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Node</span>&#123;</span></span><br><span class="line">    <span class="keyword">int</span> v,w;</span><br><span class="line">    <span class="keyword">int</span> layer;</span><br><span class="line">    <span class="built_in">Node</span>(vv,ww)&#123;v=vv;w=ww&#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXV = <span class="number">1000</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> INF = <span class="number">10000000</span>;</span><br></pre></td></tr></table></figure>
<h2 id="邻接表表示法的BFS与DFS"><a href="#邻接表表示法的BFS与DFS" class="headerlink" title="邻接表表示法的BFS与DFS"></a>邻接表表示法的BFS与DFS</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">vector&lt;Node&gt; adj[MAXV];</span><br><span class="line"><span class="keyword">bool</span> vis[MAXV] = &#123;<span class="literal">false</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">DFS</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> depth)</span></span>&#123; <span class="comment">//u为当前访问结点的编号；depth为深度，初始为0</span></span><br><span class="line">    vis[u] = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;adj[u].<span class="built_in">size</span>();i++)&#123;</span><br><span class="line">        <span class="keyword">int</span> v = adj[u].<span class="built_in">at</span>(i);</span><br><span class="line">        <span class="keyword">if</span>(vis[v] == <span class="literal">false</span>)&#123;</span><br><span class="line">            <span class="built_in">DFS</span>(v,depth+<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">bool</span> inq[MAXV] = &#123;<span class="literal">false</span>&#125;;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">BFS</span><span class="params">(<span class="keyword">int</span> u)</span></span>&#123;</span><br><span class="line">    queue&lt;Node&gt; q;</span><br><span class="line">    Node* start;</span><br><span class="line">    start.v = u; <span class="comment">//起始结点编号</span></span><br><span class="line">    start.layer = <span class="number">0</span>; <span class="comment">//起始结点所在层数</span></span><br><span class="line">    q.<span class="built_in">push</span>(start); <span class="comment">//将起始结点压入队列</span></span><br><span class="line">    inq[start.v] = <span class="literal">true</span>; <span class="comment">//设为已加入队列</span></span><br><span class="line">    <span class="keyword">while</span>(!q.<span class="built_in">empty</span>())&#123;</span><br><span class="line">        Node topNode = q.<span class="built_in">front</span>();</span><br><span class="line">        q.<span class="built_in">pop</span>();</span><br><span class="line">        <span class="keyword">int</span> u = topNode.v;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;adj[u].<span class="built_in">size</span>();i++)&#123;</span><br><span class="line">            Node next = adj[u].<span class="built_in">at</span>(i);</span><br><span class="line">            next.layer = topNode.layer + <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span>(inq[next.v] == <span class="literal">false</span>)&#123;</span><br><span class="line">                q.<span class="built_in">push</span>(next); <span class="comment">//将next入队</span></span><br><span class="line">                inq[next.v] == <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="最短路径"><a href="#最短路径" class="headerlink" title="最短路径"></a>最短路径</h2><p><strong>dijkstra算法</strong></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXV;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> INF;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> d[MAXV]; <span class="comment">//记录到结点的最近距离</span></span><br><span class="line"><span class="keyword">int</span> vis[MAXV] = &#123;<span class="literal">false</span>&#125;;</span><br><span class="line"><span class="keyword">int</span> G[MAXV][MAXV] = &#123;INF&#125;;</span><br></pre></td></tr></table></figure>
<p>用pre数组保存路径，然后用DFS来遍历所有的路径，这种Dijkstra+DFS的做法可以适用于编程复杂的情况。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(d[u]+G[u][v] &lt; d[v])&#123;</span><br><span class="line">    d[v] = d[u] + G[u][v];</span><br><span class="line">    pre[v].<span class="built_in">clear</span>();</span><br><span class="line">    pre[v].<span class="built_in">push_back</span>(u);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(d[u]+G[u][v] == d[v])&#123;</span><br><span class="line">    pre[v].<span class="built_in">push_back</span>(u);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>此时pre数组可以产生一个递归树，所有叶子结点到根节点的路径确定了从起点到终点的所有最短路径</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> optValue; <span class="comment">//第二标尺最优值</span></span><br><span class="line">vector&lt;<span class="keyword">int</span>&gt; pre[MAXV]; <span class="comment">//前驱数组</span></span><br><span class="line">vector&lt;<span class="keyword">int</span>&gt; path,tempPath; <span class="comment">//最优路径，临时路径</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">DFS</span><span class="params">(<span class="keyword">int</span> v)</span></span>&#123; <span class="comment">//v为当前访问结点</span></span><br><span class="line">    <span class="keyword">if</span>(v == st)&#123; <span class="comment">//如果到达了叶子结点st（即路径的起点）</span></span><br><span class="line">        tempPath.<span class="built_in">push_back</span>(v); <span class="comment">//将st加入临时路径的最后面</span></span><br><span class="line">        <span class="keyword">int</span> value; <span class="comment">//存放临时路径tempPath的第二标尺值</span></span><br><span class="line">        计算路径上tempPath上的value值;</span><br><span class="line">        <span class="keyword">if</span>(value 优于 optValue)&#123;</span><br><span class="line">            optValue = value; <span class="comment">//更新第二标尺值与最优路径</span></span><br><span class="line">            path = tempPath;</span><br><span class="line">        &#125;</span><br><span class="line">        tempPath.<span class="built_in">pop_back</span>(); <span class="comment">//返回上一层时，将这一节点从pre中删除</span></span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//递归式</span></span><br><span class="line">    tempPath.<span class="built_in">push_back</span>(v); <span class="comment">//将当前访问结点加入临时路径的最后面</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;pre[v].<span class="built_in">size</span>();i++)&#123;</span><br><span class="line">        <span class="built_in">DFS</span>(pre[v][i]);</span><br><span class="line">    &#125;</span><br><span class="line">    tempPath.<span class="built_in">pop_back</span>(); <span class="comment">//返回上一层时，将这一节点从pre中删除</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>bellman-ford</strong></p>
<p>dijkstra只适用于正权图的情况，而bellman-ford可以适用于负权图。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//模板代码</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Node</span>&#123;</span></span><br><span class="line">    <span class="keyword">int</span> v,dis; <span class="comment">//v为邻接边的目标顶点，dis为邻接边的边权</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">vector&lt;Node&gt; Adj[MAXV]; <span class="comment">//邻接表</span></span><br><span class="line"><span class="keyword">int</span> n; <span class="comment">//定点数</span></span><br><span class="line"><span class="keyword">int</span> d[MAXV]; <span class="comment">//起点到达各顶点的最短路径长度</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">Bellman</span><span class="params">(<span class="keyword">int</span> s)</span></span>&#123; <span class="comment">//s为源点</span></span><br><span class="line">    <span class="comment">//初始化</span></span><br><span class="line">    <span class="built_in">fill</span>(d,d+MAXV,INF); <span class="comment">//将整个数组赋值为INF</span></span><br><span class="line">    d[s] = <span class="number">0</span>;  <span class="comment">//s到自身的距离为0</span></span><br><span class="line">    <span class="comment">//求解数组d</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;n<span class="number">-1</span>;i++)&#123; <span class="comment">//n-1次迭代可求解d</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> u=<span class="number">0</span>;u&lt;n;u++)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;Adj[u].<span class="built_in">size</span>();j++)&#123;</span><br><span class="line">                <span class="keyword">int</span> v = Adj[u][j].v; <span class="comment">//邻接边的顶点</span></span><br><span class="line">                <span class="keyword">int</span> dis = Adj[u][j].dis; <span class="comment">//邻接边的边权</span></span><br><span class="line">                <span class="keyword">if</span>(d[u]+dis &lt; d[v])&#123; <span class="comment">//以u为中介点可以使d[v]更小</span></span><br><span class="line">                    d[v] = d[u]+dis; <span class="comment">//更新</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//以下判断负环的代码</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> u=<span class="number">0</span>;u&lt;n;u++)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;Adj[u].<span class="built_in">size</span>();j++)&#123;</span><br><span class="line">            <span class="keyword">int</span> v = Adj[u][j].v; <span class="comment">//邻接边的顶点</span></span><br><span class="line">            <span class="keyword">int</span> dis = Adj[u][j].dis; <span class="comment">//邻接边的边权</span></span><br><span class="line">            <span class="keyword">if</span>(d[u]+dis &lt; d[v])&#123; <span class="comment">//以u为中介点可以使d[v]更小</span></span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>; <span class="comment">//有从源点可达的负环</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>; <span class="comment">//没有负环，数组d的所有值都已经最优</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>SPFA</strong></p>
<p>改进的bellman-ford算法，时间复杂度仅为O(ke)(在无可达负环的情况下)</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//伪代码</span></span><br><span class="line">queue&lt;<span class="keyword">int</span>&gt; Q;</span><br><span class="line">d[];</span><br><span class="line">源点s入队;</span><br><span class="line"><span class="keyword">while</span>(队列非空)&#123;</span><br><span class="line">    取出队首元素u;</span><br><span class="line">    <span class="keyword">for</span>(u的所有邻接边u-&gt;v)&#123;</span><br><span class="line">        <span class="keyword">if</span>(d[u]+dis&lt;d[v])&#123;</span><br><span class="line">            d[v] = d[u]+dis;</span><br><span class="line">            <span class="keyword">if</span>(v当前不在队列)&#123;</span><br><span class="line">                v入队;</span><br><span class="line">                <span class="keyword">if</span>(v的入队次数大于n<span class="number">-1</span>)&#123;</span><br><span class="line">                    说明有可达负环;<span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="欧拉路"><a href="#欧拉路" class="headerlink" title="欧拉路"></a>欧拉路</h2><p>如果一个无向图中有有n个结点，且度为偶数的结点数也为n，则该图含有欧拉回路；若有n个结点，且度为奇数的点的个数为2，则含有欧拉路；否则，不含有欧拉路</p>
<h1 id="数学运算"><a href="#数学运算" class="headerlink" title="数学运算"></a>数学运算</h1><h2 id="分数运算"><a href="#分数运算" class="headerlink" title="分数运算"></a>分数运算</h2><p><strong>最大公约数</strong></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//由离散数学：a与b的公约数与b与a%b的公约数相等</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">gcd</span><span class="params">(<span class="keyword">int</span> a,<span class="keyword">int</span> b)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(b==<span class="number">0</span>)<span class="keyword">return</span> a;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">return</span> <span class="built_in">gcd</span>(b,a%b);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>最小公倍数</strong></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">lcm</span><span class="params">(<span class="keyword">int</span> a,<span class="keyword">int</span> b)</span></span>&#123;</span><br><span class="line">    <span class="comment">//return a*b/gcd(a,b);</span></span><br><span class="line">    <span class="comment">//由于a*b有可能溢出，所以更好的写法是下面的</span></span><br><span class="line">	<span class="keyword">return</span> a/<span class="built_in">gcd</span>(a,b)*b;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="Hash"><a href="#Hash" class="headerlink" title="Hash"></a>Hash</h1><p>//平方探测法 quadratic probing</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> HashQuad_h</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> HashQuad_h</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">unsigned</span> <span class="keyword">int</span> Index;</span><br><span class="line"><span class="keyword">typedef</span> Index Position;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">HashTb1</span>;</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">HashTb1</span> *<span class="title">HashTable</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="function">HashTable <span class="title">Init</span><span class="params">(<span class="keyword">int</span> size)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">DestroyTable</span><span class="params">(HashTable H)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Insert</span><span class="params">(<span class="keyword">int</span> key, HashTable H)</span></span>;</span><br><span class="line"><span class="function">Position <span class="title">Find</span><span class="params">(<span class="keyword">int</span> key,HashTable H)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">Retrieve</span><span class="params">(Position P)</span></span>;</span><br><span class="line"><span class="function">HashTable <span class="title">ReTable</span><span class="params">(HashTable H)</span></span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">/* HashQuad_h */</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">KindOfEntry</span>&#123;</span></span><br><span class="line">    Legitimate,</span><br><span class="line">    Empty,</span><br><span class="line">    Deleted</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">HashEntry</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> value;</span><br><span class="line">    <span class="class"><span class="keyword">enum</span> <span class="title">KindOfEntry</span> <span class="title">Info</span>;</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">HashEntry</span> <span class="title">Cell</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*Cell *TheCells will be an array of </span></span><br><span class="line"><span class="comment"> HashEntry cells,allocated later</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">HashTb1</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> TableSize;</span><br><span class="line">    Cell *TheCells;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//利用 i*i = (i-1)*(i-1) + 2*i - 1</span></span><br><span class="line"><span class="number">1</span> <span class="function">Position <span class="title">Find</span><span class="params">(<span class="keyword">int</span> key,HashTable H)</span></span>&#123;</span><br><span class="line"> <span class="number">2</span>     Position cur;</span><br><span class="line"> <span class="number">3</span>     <span class="keyword">int</span> CollisionNum=<span class="number">0</span>;</span><br><span class="line"> <span class="number">4</span>     cur=<span class="built_in">Hash</span>(key,H-&gt;TableSize);</span><br><span class="line"> <span class="number">5</span>     <span class="keyword">while</span> (H-&gt;TheCells[cur].Info != Empty &amp;&amp;</span><br><span class="line"> <span class="number">6</span>            H-&gt;TheCells[cur].value!= key)</span><br><span class="line"> <span class="number">7</span>     &#123;</span><br><span class="line"> <span class="number">8</span>         cur+= (++CollisionNum&lt;&lt;<span class="number">1</span>) - <span class="number">1</span>;</span><br><span class="line"> <span class="number">9</span>         <span class="keyword">if</span> (cur&gt;=H-&gt;TableSize)</span><br><span class="line"><span class="number">10</span>             cur-=H-&gt;TableSize;</span><br><span class="line"><span class="number">11</span>     &#125;</span><br><span class="line"><span class="number">12</span>     <span class="keyword">return</span> cur;</span><br><span class="line"><span class="number">13</span> &#125;</span><br></pre></td></tr></table></figure>

      

      
    </div>
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color3">数据结构与算法</a>
        		</li>
      		
		</ul>
	</div>

      

      
        <p class="article-more-link">
          <a class="article-more-a" href="/2021/06/14/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%9F%BA%E7%A1%80/">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>

<aside class="wrap-side-operation">
    <div class="mod-side-operation">
        
        <div class="jump-container" id="js-jump-container" style="display:none;">
            <a href="javascript:void(0)" class="mod-side-operation__jump-to-top">
                <i class="icon-font icon-back"></i>
            </a>
            <div id="js-jump-plan-container" class="jump-plan-container" style="top: -11px;">
                <i class="icon-font icon-plane jump-plane"></i>
            </div>
        </div>
        
        
    </div>
</aside>




  
  
    <nav id="page-nav">
      <a class="extend prev" rel="prev" href="/page/3/">&amp;laquo; Prev</a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span><a class="page-number" href="/page/5/">5</a><a class="page-number" href="/page/6/">6</a><span class="space">&hellip;</span><a class="page-number" href="/page/10/">10</a><a class="extend next" rel="next" href="/page/5/">Next &amp;raquo;</a>
    </nav>
  


          </div>
        </div>
      </div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2021 fantasy
    	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
      	</div>
    </div>
  </div>
</footer>
    </div>
    <script>
	var yiliaConfig = {
		mathjax: true,
		isHome: true,
		isPost: false,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: true,
		toc_hide_index: true,
		root: "/",
		innerArchive: true,
		showTags: false
	}
</script>

<script>!function(t){function n(e){if(r[e])return r[e].exports;var i=r[e]={exports:{},id:e,loaded:!1};return t[e].call(i.exports,i,i.exports,n),i.loaded=!0,i.exports}var r={};n.m=t,n.c=r,n.p="./",n(0)}([function(t,n,r){r(195),t.exports=r(191)},function(t,n,r){var e=r(3),i=r(52),o=r(27),u=r(28),c=r(53),f="prototype",a=function(t,n,r){var s,l,h,v,p=t&a.F,d=t&a.G,y=t&a.S,g=t&a.P,b=t&a.B,m=d?e:y?e[n]||(e[n]={}):(e[n]||{})[f],x=d?i:i[n]||(i[n]={}),w=x[f]||(x[f]={});d&&(r=n);for(s in r)l=!p&&m&&void 0!==m[s],h=(l?m:r)[s],v=b&&l?c(h,e):g&&"function"==typeof h?c(Function.call,h):h,m&&u(m,s,h,t&a.U),x[s]!=h&&o(x,s,v),g&&w[s]!=h&&(w[s]=h)};e.core=i,a.F=1,a.G=2,a.S=4,a.P=8,a.B=16,a.W=32,a.U=64,a.R=128,t.exports=a},function(t,n,r){var e=r(6);t.exports=function(t){if(!e(t))throw TypeError(t+" is not an object!");return t}},function(t,n){var r=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=r)},function(t,n){t.exports=function(t){try{return!!t()}catch(t){return!0}}},function(t,n){var r=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=r)},function(t,n){t.exports=function(t){return"object"==typeof t?null!==t:"function"==typeof t}},function(t,n,r){var e=r(126)("wks"),i=r(76),o=r(3).Symbol,u="function"==typeof o;(t.exports=function(t){return e[t]||(e[t]=u&&o[t]||(u?o:i)("Symbol."+t))}).store=e},function(t,n){var r={}.hasOwnProperty;t.exports=function(t,n){return r.call(t,n)}},function(t,n,r){var e=r(94),i=r(33);t.exports=function(t){return e(i(t))}},function(t,n,r){t.exports=!r(4)(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},function(t,n,r){var e=r(2),i=r(167),o=r(50),u=Object.defineProperty;n.f=r(10)?Object.defineProperty:function(t,n,r){if(e(t),n=o(n,!0),e(r),i)try{return u(t,n,r)}catch(t){}if("get"in r||"set"in r)throw TypeError("Accessors not supported!");return"value"in r&&(t[n]=r.value),t}},function(t,n,r){t.exports=!r(18)(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},function(t,n,r){var e=r(14),i=r(22);t.exports=r(12)?function(t,n,r){return e.f(t,n,i(1,r))}:function(t,n,r){return t[n]=r,t}},function(t,n,r){var e=r(20),i=r(58),o=r(42),u=Object.defineProperty;n.f=r(12)?Object.defineProperty:function(t,n,r){if(e(t),n=o(n,!0),e(r),i)try{return u(t,n,r)}catch(t){}if("get"in r||"set"in r)throw TypeError("Accessors not supported!");return"value"in r&&(t[n]=r.value),t}},function(t,n,r){var e=r(40)("wks"),i=r(23),o=r(5).Symbol,u="function"==typeof o;(t.exports=function(t){return e[t]||(e[t]=u&&o[t]||(u?o:i)("Symbol."+t))}).store=e},function(t,n,r){var e=r(67),i=Math.min;t.exports=function(t){return t>0?i(e(t),9007199254740991):0}},function(t,n,r){var e=r(46);t.exports=function(t){return Object(e(t))}},function(t,n){t.exports=function(t){try{return!!t()}catch(t){return!0}}},function(t,n,r){var e=r(63),i=r(34);t.exports=Object.keys||function(t){return e(t,i)}},function(t,n,r){var e=r(21);t.exports=function(t){if(!e(t))throw TypeError(t+" is not an object!");return t}},function(t,n){t.exports=function(t){return"object"==typeof t?null!==t:"function"==typeof t}},function(t,n){t.exports=function(t,n){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:n}}},function(t,n){var r=0,e=Math.random();t.exports=function(t){return"Symbol(".concat(void 0===t?"":t,")_",(++r+e).toString(36))}},function(t,n){var r={}.hasOwnProperty;t.exports=function(t,n){return r.call(t,n)}},function(t,n){var r=t.exports={version:"2.4.0"};"number"==typeof __e&&(__e=r)},function(t,n){t.exports=function(t){if("function"!=typeof t)throw TypeError(t+" is not a function!");return t}},function(t,n,r){var e=r(11),i=r(66);t.exports=r(10)?function(t,n,r){return e.f(t,n,i(1,r))}:function(t,n,r){return t[n]=r,t}},function(t,n,r){var e=r(3),i=r(27),o=r(24),u=r(76)("src"),c="toString",f=Function[c],a=(""+f).split(c);r(52).inspectSource=function(t){return f.call(t)},(t.exports=function(t,n,r,c){var f="function"==typeof r;f&&(o(r,"name")||i(r,"name",n)),t[n]!==r&&(f&&(o(r,u)||i(r,u,t[n]?""+t[n]:a.join(String(n)))),t===e?t[n]=r:c?t[n]?t[n]=r:i(t,n,r):(delete t[n],i(t,n,r)))})(Function.prototype,c,function(){return"function"==typeof this&&this[u]||f.call(this)})},function(t,n,r){var e=r(1),i=r(4),o=r(46),u=function(t,n,r,e){var i=String(o(t)),u="<"+n;return""!==r&&(u+=" "+r+'="'+String(e).replace(/"/g,"&quot;")+'"'),u+">"+i+"</"+n+">"};t.exports=function(t,n){var r={};r[t]=n(u),e(e.P+e.F*i(function(){var n=""[t]('"');return n!==n.toLowerCase()||n.split('"').length>3}),"String",r)}},function(t,n,r){var e=r(115),i=r(46);t.exports=function(t){return e(i(t))}},function(t,n,r){var e=r(116),i=r(66),o=r(30),u=r(50),c=r(24),f=r(167),a=Object.getOwnPropertyDescriptor;n.f=r(10)?a:function(t,n){if(t=o(t),n=u(n,!0),f)try{return a(t,n)}catch(t){}if(c(t,n))return i(!e.f.call(t,n),t[n])}},function(t,n,r){var e=r(24),i=r(17),o=r(145)("IE_PROTO"),u=Object.prototype;t.exports=Object.getPrototypeOf||function(t){return t=i(t),e(t,o)?t[o]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?u:null}},function(t,n){t.exports=function(t){if(void 0==t)throw TypeError("Can't call method on  "+t);return t}},function(t,n){t.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},function(t,n){t.exports={}},function(t,n){t.exports=!0},function(t,n){n.f={}.propertyIsEnumerable},function(t,n,r){var e=r(14).f,i=r(8),o=r(15)("toStringTag");t.exports=function(t,n,r){t&&!i(t=r?t:t.prototype,o)&&e(t,o,{configurable:!0,value:n})}},function(t,n,r){var e=r(40)("keys"),i=r(23);t.exports=function(t){return e[t]||(e[t]=i(t))}},function(t,n,r){var e=r(5),i="__core-js_shared__",o=e[i]||(e[i]={});t.exports=function(t){return o[t]||(o[t]={})}},function(t,n){var r=Math.ceil,e=Math.floor;t.exports=function(t){return isNaN(t=+t)?0:(t>0?e:r)(t)}},function(t,n,r){var e=r(21);t.exports=function(t,n){if(!e(t))return t;var r,i;if(n&&"function"==typeof(r=t.toString)&&!e(i=r.call(t)))return i;if("function"==typeof(r=t.valueOf)&&!e(i=r.call(t)))return i;if(!n&&"function"==typeof(r=t.toString)&&!e(i=r.call(t)))return i;throw TypeError("Can't convert object to primitive value")}},function(t,n,r){var e=r(5),i=r(25),o=r(36),u=r(44),c=r(14).f;t.exports=function(t){var n=i.Symbol||(i.Symbol=o?{}:e.Symbol||{});"_"==t.charAt(0)||t in n||c(n,t,{value:u.f(t)})}},function(t,n,r){n.f=r(15)},function(t,n){var r={}.toString;t.exports=function(t){return r.call(t).slice(8,-1)}},function(t,n){t.exports=function(t){if(void 0==t)throw TypeError("Can't call method on  "+t);return t}},function(t,n,r){var e=r(4);t.exports=function(t,n){return!!t&&e(function(){n?t.call(null,function(){},1):t.call(null)})}},function(t,n,r){var e=r(53),i=r(115),o=r(17),u=r(16),c=r(203);t.exports=function(t,n){var r=1==t,f=2==t,a=3==t,s=4==t,l=6==t,h=5==t||l,v=n||c;return function(n,c,p){for(var d,y,g=o(n),b=i(g),m=e(c,p,3),x=u(b.length),w=0,S=r?v(n,x):f?v(n,0):void 0;x>w;w++)if((h||w in b)&&(d=b[w],y=m(d,w,g),t))if(r)S[w]=y;else if(y)switch(t){case 3:return!0;case 5:return d;case 6:return w;case 2:S.push(d)}else if(s)return!1;return l?-1:a||s?s:S}}},function(t,n,r){var e=r(1),i=r(52),o=r(4);t.exports=function(t,n){var r=(i.Object||{})[t]||Object[t],u={};u[t]=n(r),e(e.S+e.F*o(function(){r(1)}),"Object",u)}},function(t,n,r){var e=r(6);t.exports=function(t,n){if(!e(t))return t;var r,i;if(n&&"function"==typeof(r=t.toString)&&!e(i=r.call(t)))return i;if("function"==typeof(r=t.valueOf)&&!e(i=r.call(t)))return i;if(!n&&"function"==typeof(r=t.toString)&&!e(i=r.call(t)))return i;throw TypeError("Can't convert object to primitive value")}},function(t,n,r){var e=r(5),i=r(25),o=r(91),u=r(13),c="prototype",f=function(t,n,r){var a,s,l,h=t&f.F,v=t&f.G,p=t&f.S,d=t&f.P,y=t&f.B,g=t&f.W,b=v?i:i[n]||(i[n]={}),m=b[c],x=v?e:p?e[n]:(e[n]||{})[c];v&&(r=n);for(a in r)(s=!h&&x&&void 0!==x[a])&&a in b||(l=s?x[a]:r[a],b[a]=v&&"function"!=typeof x[a]?r[a]:y&&s?o(l,e):g&&x[a]==l?function(t){var n=function(n,r,e){if(this instanceof t){switch(arguments.length){case 0:return new t;case 1:return new t(n);case 2:return new t(n,r)}return new t(n,r,e)}return t.apply(this,arguments)};return n[c]=t[c],n}(l):d&&"function"==typeof l?o(Function.call,l):l,d&&((b.virtual||(b.virtual={}))[a]=l,t&f.R&&m&&!m[a]&&u(m,a,l)))};f.F=1,f.G=2,f.S=4,f.P=8,f.B=16,f.W=32,f.U=64,f.R=128,t.exports=f},function(t,n){var r=t.exports={version:"2.4.0"};"number"==typeof __e&&(__e=r)},function(t,n,r){var e=r(26);t.exports=function(t,n,r){if(e(t),void 0===n)return t;switch(r){case 1:return function(r){return t.call(n,r)};case 2:return function(r,e){return t.call(n,r,e)};case 3:return function(r,e,i){return t.call(n,r,e,i)}}return function(){return t.apply(n,arguments)}}},function(t,n,r){var e=r(183),i=r(1),o=r(126)("metadata"),u=o.store||(o.store=new(r(186))),c=function(t,n,r){var i=u.get(t);if(!i){if(!r)return;u.set(t,i=new e)}var o=i.get(n);if(!o){if(!r)return;i.set(n,o=new e)}return o},f=function(t,n,r){var e=c(n,r,!1);return void 0!==e&&e.has(t)},a=function(t,n,r){var e=c(n,r,!1);return void 0===e?void 0:e.get(t)},s=function(t,n,r,e){c(r,e,!0).set(t,n)},l=function(t,n){var r=c(t,n,!1),e=[];return r&&r.forEach(function(t,n){e.push(n)}),e},h=function(t){return void 0===t||"symbol"==typeof t?t:String(t)},v=function(t){i(i.S,"Reflect",t)};t.exports={store:u,map:c,has:f,get:a,set:s,keys:l,key:h,exp:v}},function(t,n,r){"use strict";if(r(10)){var e=r(69),i=r(3),o=r(4),u=r(1),c=r(127),f=r(152),a=r(53),s=r(68),l=r(66),h=r(27),v=r(73),p=r(67),d=r(16),y=r(75),g=r(50),b=r(24),m=r(180),x=r(114),w=r(6),S=r(17),_=r(137),O=r(70),E=r(32),P=r(71).f,j=r(154),F=r(76),M=r(7),A=r(48),N=r(117),T=r(146),I=r(155),k=r(80),L=r(123),R=r(74),C=r(130),D=r(160),U=r(11),W=r(31),G=U.f,B=W.f,V=i.RangeError,z=i.TypeError,q=i.Uint8Array,K="ArrayBuffer",J="Shared"+K,Y="BYTES_PER_ELEMENT",H="prototype",$=Array[H],X=f.ArrayBuffer,Q=f.DataView,Z=A(0),tt=A(2),nt=A(3),rt=A(4),et=A(5),it=A(6),ot=N(!0),ut=N(!1),ct=I.values,ft=I.keys,at=I.entries,st=$.lastIndexOf,lt=$.reduce,ht=$.reduceRight,vt=$.join,pt=$.sort,dt=$.slice,yt=$.toString,gt=$.toLocaleString,bt=M("iterator"),mt=M("toStringTag"),xt=F("typed_constructor"),wt=F("def_constructor"),St=c.CONSTR,_t=c.TYPED,Ot=c.VIEW,Et="Wrong length!",Pt=A(1,function(t,n){return Tt(T(t,t[wt]),n)}),jt=o(function(){return 1===new q(new Uint16Array([1]).buffer)[0]}),Ft=!!q&&!!q[H].set&&o(function(){new q(1).set({})}),Mt=function(t,n){if(void 0===t)throw z(Et);var r=+t,e=d(t);if(n&&!m(r,e))throw V(Et);return e},At=function(t,n){var r=p(t);if(r<0||r%n)throw V("Wrong offset!");return r},Nt=function(t){if(w(t)&&_t in t)return t;throw z(t+" is not a typed array!")},Tt=function(t,n){if(!(w(t)&&xt in t))throw z("It is not a typed array constructor!");return new t(n)},It=function(t,n){return kt(T(t,t[wt]),n)},kt=function(t,n){for(var r=0,e=n.length,i=Tt(t,e);e>r;)i[r]=n[r++];return i},Lt=function(t,n,r){G(t,n,{get:function(){return this._d[r]}})},Rt=function(t){var n,r,e,i,o,u,c=S(t),f=arguments.length,s=f>1?arguments[1]:void 0,l=void 0!==s,h=j(c);if(void 0!=h&&!_(h)){for(u=h.call(c),e=[],n=0;!(o=u.next()).done;n++)e.push(o.value);c=e}for(l&&f>2&&(s=a(s,arguments[2],2)),n=0,r=d(c.length),i=Tt(this,r);r>n;n++)i[n]=l?s(c[n],n):c[n];return i},Ct=function(){for(var t=0,n=arguments.length,r=Tt(this,n);n>t;)r[t]=arguments[t++];return r},Dt=!!q&&o(function(){gt.call(new q(1))}),Ut=function(){return gt.apply(Dt?dt.call(Nt(this)):Nt(this),arguments)},Wt={copyWithin:function(t,n){return D.call(Nt(this),t,n,arguments.length>2?arguments[2]:void 0)},every:function(t){return rt(Nt(this),t,arguments.length>1?arguments[1]:void 0)},fill:function(t){return C.apply(Nt(this),arguments)},filter:function(t){return It(this,tt(Nt(this),t,arguments.length>1?arguments[1]:void 0))},find:function(t){return et(Nt(this),t,arguments.length>1?arguments[1]:void 0)},findIndex:function(t){return it(Nt(this),t,arguments.length>1?arguments[1]:void 0)},forEach:function(t){Z(Nt(this),t,arguments.length>1?arguments[1]:void 0)},indexOf:function(t){return ut(Nt(this),t,arguments.length>1?arguments[1]:void 0)},includes:function(t){return ot(Nt(this),t,arguments.length>1?arguments[1]:void 0)},join:function(t){return vt.apply(Nt(this),arguments)},lastIndexOf:function(t){return st.apply(Nt(this),arguments)},map:function(t){return Pt(Nt(this),t,arguments.length>1?arguments[1]:void 0)},reduce:function(t){return lt.apply(Nt(this),arguments)},reduceRight:function(t){return ht.apply(Nt(this),arguments)},reverse:function(){for(var t,n=this,r=Nt(n).length,e=Math.floor(r/2),i=0;i<e;)t=n[i],n[i++]=n[--r],n[r]=t;return n},some:function(t){return nt(Nt(this),t,arguments.length>1?arguments[1]:void 0)},sort:function(t){return pt.call(Nt(this),t)},subarray:function(t,n){var r=Nt(this),e=r.length,i=y(t,e);return new(T(r,r[wt]))(r.buffer,r.byteOffset+i*r.BYTES_PER_ELEMENT,d((void 0===n?e:y(n,e))-i))}},Gt=function(t,n){return It(this,dt.call(Nt(this),t,n))},Bt=function(t){Nt(this);var n=At(arguments[1],1),r=this.length,e=S(t),i=d(e.length),o=0;if(i+n>r)throw V(Et);for(;o<i;)this[n+o]=e[o++]},Vt={entries:function(){return at.call(Nt(this))},keys:function(){return ft.call(Nt(this))},values:function(){return ct.call(Nt(this))}},zt=function(t,n){return w(t)&&t[_t]&&"symbol"!=typeof n&&n in t&&String(+n)==String(n)},qt=function(t,n){return zt(t,n=g(n,!0))?l(2,t[n]):B(t,n)},Kt=function(t,n,r){return!(zt(t,n=g(n,!0))&&w(r)&&b(r,"value"))||b(r,"get")||b(r,"set")||r.configurable||b(r,"writable")&&!r.writable||b(r,"enumerable")&&!r.enumerable?G(t,n,r):(t[n]=r.value,t)};St||(W.f=qt,U.f=Kt),u(u.S+u.F*!St,"Object",{getOwnPropertyDescriptor:qt,defineProperty:Kt}),o(function(){yt.call({})})&&(yt=gt=function(){return vt.call(this)});var Jt=v({},Wt);v(Jt,Vt),h(Jt,bt,Vt.values),v(Jt,{slice:Gt,set:Bt,constructor:function(){},toString:yt,toLocaleString:Ut}),Lt(Jt,"buffer","b"),Lt(Jt,"byteOffset","o"),Lt(Jt,"byteLength","l"),Lt(Jt,"length","e"),G(Jt,mt,{get:function(){return this[_t]}}),t.exports=function(t,n,r,f){f=!!f;var a=t+(f?"Clamped":"")+"Array",l="Uint8Array"!=a,v="get"+t,p="set"+t,y=i[a],g=y||{},b=y&&E(y),m=!y||!c.ABV,S={},_=y&&y[H],j=function(t,r){var e=t._d;return e.v[v](r*n+e.o,jt)},F=function(t,r,e){var i=t._d;f&&(e=(e=Math.round(e))<0?0:e>255?255:255&e),i.v[p](r*n+i.o,e,jt)},M=function(t,n){G(t,n,{get:function(){return j(this,n)},set:function(t){return F(this,n,t)},enumerable:!0})};m?(y=r(function(t,r,e,i){s(t,y,a,"_d");var o,u,c,f,l=0,v=0;if(w(r)){if(!(r instanceof X||(f=x(r))==K||f==J))return _t in r?kt(y,r):Rt.call(y,r);o=r,v=At(e,n);var p=r.byteLength;if(void 0===i){if(p%n)throw V(Et);if((u=p-v)<0)throw V(Et)}else if((u=d(i)*n)+v>p)throw V(Et);c=u/n}else c=Mt(r,!0),u=c*n,o=new X(u);for(h(t,"_d",{b:o,o:v,l:u,e:c,v:new Q(o)});l<c;)M(t,l++)}),_=y[H]=O(Jt),h(_,"constructor",y)):L(function(t){new y(null),new y(t)},!0)||(y=r(function(t,r,e,i){s(t,y,a);var o;return w(r)?r instanceof X||(o=x(r))==K||o==J?void 0!==i?new g(r,At(e,n),i):void 0!==e?new g(r,At(e,n)):new g(r):_t in r?kt(y,r):Rt.call(y,r):new g(Mt(r,l))}),Z(b!==Function.prototype?P(g).concat(P(b)):P(g),function(t){t in y||h(y,t,g[t])}),y[H]=_,e||(_.constructor=y));var A=_[bt],N=!!A&&("values"==A.name||void 0==A.name),T=Vt.values;h(y,xt,!0),h(_,_t,a),h(_,Ot,!0),h(_,wt,y),(f?new y(1)[mt]==a:mt in _)||G(_,mt,{get:function(){return a}}),S[a]=y,u(u.G+u.W+u.F*(y!=g),S),u(u.S,a,{BYTES_PER_ELEMENT:n,from:Rt,of:Ct}),Y in _||h(_,Y,n),u(u.P,a,Wt),R(a),u(u.P+u.F*Ft,a,{set:Bt}),u(u.P+u.F*!N,a,Vt),u(u.P+u.F*(_.toString!=yt),a,{toString:yt}),u(u.P+u.F*o(function(){new y(1).slice()}),a,{slice:Gt}),u(u.P+u.F*(o(function(){return[1,2].toLocaleString()!=new y([1,2]).toLocaleString()})||!o(function(){_.toLocaleString.call([1,2])})),a,{toLocaleString:Ut}),k[a]=N?A:T,e||N||h(_,bt,T)}}else t.exports=function(){}},function(t,n){var r={}.toString;t.exports=function(t){return r.call(t).slice(8,-1)}},function(t,n,r){var e=r(21),i=r(5).document,o=e(i)&&e(i.createElement);t.exports=function(t){return o?i.createElement(t):{}}},function(t,n,r){t.exports=!r(12)&&!r(18)(function(){return 7!=Object.defineProperty(r(57)("div"),"a",{get:function(){return 7}}).a})},function(t,n,r){"use strict";var e=r(36),i=r(51),o=r(64),u=r(13),c=r(8),f=r(35),a=r(96),s=r(38),l=r(103),h=r(15)("iterator"),v=!([].keys&&"next"in[].keys()),p="keys",d="values",y=function(){return this};t.exports=function(t,n,r,g,b,m,x){a(r,n,g);var w,S,_,O=function(t){if(!v&&t in F)return F[t];switch(t){case p:case d:return function(){return new r(this,t)}}return function(){return new r(this,t)}},E=n+" Iterator",P=b==d,j=!1,F=t.prototype,M=F[h]||F["@@iterator"]||b&&F[b],A=M||O(b),N=b?P?O("entries"):A:void 0,T="Array"==n?F.entries||M:M;if(T&&(_=l(T.call(new t)))!==Object.prototype&&(s(_,E,!0),e||c(_,h)||u(_,h,y)),P&&M&&M.name!==d&&(j=!0,A=function(){return M.call(this)}),e&&!x||!v&&!j&&F[h]||u(F,h,A),f[n]=A,f[E]=y,b)if(w={values:P?A:O(d),keys:m?A:O(p),entries:N},x)for(S in w)S in F||o(F,S,w[S]);else i(i.P+i.F*(v||j),n,w);return w}},function(t,n,r){var e=r(20),i=r(100),o=r(34),u=r(39)("IE_PROTO"),c=function(){},f="prototype",a=function(){var t,n=r(57)("iframe"),e=o.length;for(n.style.display="none",r(93).appendChild(n),n.src="javascript:",t=n.contentWindow.document,t.open(),t.write("<script>document.F=Object<\/script>"),t.close(),a=t.F;e--;)delete a[f][o[e]];return a()};t.exports=Object.create||function(t,n){var r;return null!==t?(c[f]=e(t),r=new c,c[f]=null,r[u]=t):r=a(),void 0===n?r:i(r,n)}},function(t,n,r){var e=r(63),i=r(34).concat("length","prototype");n.f=Object.getOwnPropertyNames||function(t){return e(t,i)}},function(t,n){n.f=Object.getOwnPropertySymbols},function(t,n,r){var e=r(8),i=r(9),o=r(90)(!1),u=r(39)("IE_PROTO");t.exports=function(t,n){var r,c=i(t),f=0,a=[];for(r in c)r!=u&&e(c,r)&&a.push(r);for(;n.length>f;)e(c,r=n[f++])&&(~o(a,r)||a.push(r));return a}},function(t,n,r){t.exports=r(13)},function(t,n,r){var e=r(76)("meta"),i=r(6),o=r(24),u=r(11).f,c=0,f=Object.isExtensible||function(){return!0},a=!r(4)(function(){return f(Object.preventExtensions({}))}),s=function(t){u(t,e,{value:{i:"O"+ ++c,w:{}}})},l=function(t,n){if(!i(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!o(t,e)){if(!f(t))return"F";if(!n)return"E";s(t)}return t[e].i},h=function(t,n){if(!o(t,e)){if(!f(t))return!0;if(!n)return!1;s(t)}return t[e].w},v=function(t){return a&&p.NEED&&f(t)&&!o(t,e)&&s(t),t},p=t.exports={KEY:e,NEED:!1,fastKey:l,getWeak:h,onFreeze:v}},function(t,n){t.exports=function(t,n){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:n}}},function(t,n){var r=Math.ceil,e=Math.floor;t.exports=function(t){return isNaN(t=+t)?0:(t>0?e:r)(t)}},function(t,n){t.exports=function(t,n,r,e){if(!(t instanceof n)||void 0!==e&&e in t)throw TypeError(r+": incorrect invocation!");return t}},function(t,n){t.exports=!1},function(t,n,r){var e=r(2),i=r(173),o=r(133),u=r(145)("IE_PROTO"),c=function(){},f="prototype",a=function(){var t,n=r(132)("iframe"),e=o.length;for(n.style.display="none",r(135).appendChild(n),n.src="javascript:",t=n.contentWindow.document,t.open(),t.write("<script>document.F=Object<\/script>"),t.close(),a=t.F;e--;)delete a[f][o[e]];return a()};t.exports=Object.create||function(t,n){var r;return null!==t?(c[f]=e(t),r=new c,c[f]=null,r[u]=t):r=a(),void 0===n?r:i(r,n)}},function(t,n,r){var e=r(175),i=r(133).concat("length","prototype");n.f=Object.getOwnPropertyNames||function(t){return e(t,i)}},function(t,n,r){var e=r(175),i=r(133);t.exports=Object.keys||function(t){return e(t,i)}},function(t,n,r){var e=r(28);t.exports=function(t,n,r){for(var i in n)e(t,i,n[i],r);return t}},function(t,n,r){"use strict";var e=r(3),i=r(11),o=r(10),u=r(7)("species");t.exports=function(t){var n=e[t];o&&n&&!n[u]&&i.f(n,u,{configurable:!0,get:function(){return this}})}},function(t,n,r){var e=r(67),i=Math.max,o=Math.min;t.exports=function(t,n){return t=e(t),t<0?i(t+n,0):o(t,n)}},function(t,n){var r=0,e=Math.random();t.exports=function(t){return"Symbol(".concat(void 0===t?"":t,")_",(++r+e).toString(36))}},function(t,n,r){var e=r(33);t.exports=function(t){return Object(e(t))}},function(t,n,r){var e=r(7)("unscopables"),i=Array.prototype;void 0==i[e]&&r(27)(i,e,{}),t.exports=function(t){i[e][t]=!0}},function(t,n,r){var e=r(53),i=r(169),o=r(137),u=r(2),c=r(16),f=r(154),a={},s={},n=t.exports=function(t,n,r,l,h){var v,p,d,y,g=h?function(){return t}:f(t),b=e(r,l,n?2:1),m=0;if("function"!=typeof g)throw TypeError(t+" is not iterable!");if(o(g)){for(v=c(t.length);v>m;m++)if((y=n?b(u(p=t[m])[0],p[1]):b(t[m]))===a||y===s)return y}else for(d=g.call(t);!(p=d.next()).done;)if((y=i(d,b,p.value,n))===a||y===s)return y};n.BREAK=a,n.RETURN=s},function(t,n){t.exports={}},function(t,n,r){var e=r(11).f,i=r(24),o=r(7)("toStringTag");t.exports=function(t,n,r){t&&!i(t=r?t:t.prototype,o)&&e(t,o,{configurable:!0,value:n})}},function(t,n,r){var e=r(1),i=r(46),o=r(4),u=r(150),c="["+u+"]",f="​",a=RegExp("^"+c+c+"*"),s=RegExp(c+c+"*$"),l=function(t,n,r){var i={},c=o(function(){return!!u[t]()||f[t]()!=f}),a=i[t]=c?n(h):u[t];r&&(i[r]=a),e(e.P+e.F*c,"String",i)},h=l.trim=function(t,n){return t=String(i(t)),1&n&&(t=t.replace(a,"")),2&n&&(t=t.replace(s,"")),t};t.exports=l},function(t,n,r){t.exports={default:r(86),__esModule:!0}},function(t,n,r){t.exports={default:r(87),__esModule:!0}},function(t,n,r){"use strict";function e(t){return t&&t.__esModule?t:{default:t}}n.__esModule=!0;var i=r(84),o=e(i),u=r(83),c=e(u),f="function"==typeof c.default&&"symbol"==typeof o.default?function(t){return typeof t}:function(t){return t&&"function"==typeof c.default&&t.constructor===c.default&&t!==c.default.prototype?"symbol":typeof t};n.default="function"==typeof c.default&&"symbol"===f(o.default)?function(t){return void 0===t?"undefined":f(t)}:function(t){return t&&"function"==typeof c.default&&t.constructor===c.default&&t!==c.default.prototype?"symbol":void 0===t?"undefined":f(t)}},function(t,n,r){r(110),r(108),r(111),r(112),t.exports=r(25).Symbol},function(t,n,r){r(109),r(113),t.exports=r(44).f("iterator")},function(t,n){t.exports=function(t){if("function"!=typeof t)throw TypeError(t+" is not a function!");return t}},function(t,n){t.exports=function(){}},function(t,n,r){var e=r(9),i=r(106),o=r(105);t.exports=function(t){return function(n,r,u){var c,f=e(n),a=i(f.length),s=o(u,a);if(t&&r!=r){for(;a>s;)if((c=f[s++])!=c)return!0}else for(;a>s;s++)if((t||s in f)&&f[s]===r)return t||s||0;return!t&&-1}}},function(t,n,r){var e=r(88);t.exports=function(t,n,r){if(e(t),void 0===n)return t;switch(r){case 1:return function(r){return t.call(n,r)};case 2:return function(r,e){return t.call(n,r,e)};case 3:return function(r,e,i){return t.call(n,r,e,i)}}return function(){return t.apply(n,arguments)}}},function(t,n,r){var e=r(19),i=r(62),o=r(37);t.exports=function(t){var n=e(t),r=i.f;if(r)for(var u,c=r(t),f=o.f,a=0;c.length>a;)f.call(t,u=c[a++])&&n.push(u);return n}},function(t,n,r){t.exports=r(5).document&&document.documentElement},function(t,n,r){var e=r(56);t.exports=Object("z").propertyIsEnumerable(0)?Object:function(t){return"String"==e(t)?t.split(""):Object(t)}},function(t,n,r){var e=r(56);t.exports=Array.isArray||function(t){return"Array"==e(t)}},function(t,n,r){"use strict";var e=r(60),i=r(22),o=r(38),u={};r(13)(u,r(15)("iterator"),function(){return this}),t.exports=function(t,n,r){t.prototype=e(u,{next:i(1,r)}),o(t,n+" Iterator")}},function(t,n){t.exports=function(t,n){return{value:n,done:!!t}}},function(t,n,r){var e=r(19),i=r(9);t.exports=function(t,n){for(var r,o=i(t),u=e(o),c=u.length,f=0;c>f;)if(o[r=u[f++]]===n)return r}},function(t,n,r){var e=r(23)("meta"),i=r(21),o=r(8),u=r(14).f,c=0,f=Object.isExtensible||function(){return!0},a=!r(18)(function(){return f(Object.preventExtensions({}))}),s=function(t){u(t,e,{value:{i:"O"+ ++c,w:{}}})},l=function(t,n){if(!i(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!o(t,e)){if(!f(t))return"F";if(!n)return"E";s(t)}return t[e].i},h=function(t,n){if(!o(t,e)){if(!f(t))return!0;if(!n)return!1;s(t)}return t[e].w},v=function(t){return a&&p.NEED&&f(t)&&!o(t,e)&&s(t),t},p=t.exports={KEY:e,NEED:!1,fastKey:l,getWeak:h,onFreeze:v}},function(t,n,r){var e=r(14),i=r(20),o=r(19);t.exports=r(12)?Object.defineProperties:function(t,n){i(t);for(var r,u=o(n),c=u.length,f=0;c>f;)e.f(t,r=u[f++],n[r]);return t}},function(t,n,r){var e=r(37),i=r(22),o=r(9),u=r(42),c=r(8),f=r(58),a=Object.getOwnPropertyDescriptor;n.f=r(12)?a:function(t,n){if(t=o(t),n=u(n,!0),f)try{return a(t,n)}catch(t){}if(c(t,n))return i(!e.f.call(t,n),t[n])}},function(t,n,r){var e=r(9),i=r(61).f,o={}.toString,u="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],c=function(t){try{return i(t)}catch(t){return u.slice()}};t.exports.f=function(t){return u&&"[object Window]"==o.call(t)?c(t):i(e(t))}},function(t,n,r){var e=r(8),i=r(77),o=r(39)("IE_PROTO"),u=Object.prototype;t.exports=Object.getPrototypeOf||function(t){return t=i(t),e(t,o)?t[o]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?u:null}},function(t,n,r){var e=r(41),i=r(33);t.exports=function(t){return function(n,r){var o,u,c=String(i(n)),f=e(r),a=c.length;return f<0||f>=a?t?"":void 0:(o=c.charCodeAt(f),o<55296||o>56319||f+1===a||(u=c.charCodeAt(f+1))<56320||u>57343?t?c.charAt(f):o:t?c.slice(f,f+2):u-56320+(o-55296<<10)+65536)}}},function(t,n,r){var e=r(41),i=Math.max,o=Math.min;t.exports=function(t,n){return t=e(t),t<0?i(t+n,0):o(t,n)}},function(t,n,r){var e=r(41),i=Math.min;t.exports=function(t){return t>0?i(e(t),9007199254740991):0}},function(t,n,r){"use strict";var e=r(89),i=r(97),o=r(35),u=r(9);t.exports=r(59)(Array,"Array",function(t,n){this._t=u(t),this._i=0,this._k=n},function(){var t=this._t,n=this._k,r=this._i++;return!t||r>=t.length?(this._t=void 0,i(1)):"keys"==n?i(0,r):"values"==n?i(0,t[r]):i(0,[r,t[r]])},"values"),o.Arguments=o.Array,e("keys"),e("values"),e("entries")},function(t,n){},function(t,n,r){"use strict";var e=r(104)(!0);r(59)(String,"String",function(t){this._t=String(t),this._i=0},function(){var t,n=this._t,r=this._i;return r>=n.length?{value:void 0,done:!0}:(t=e(n,r),this._i+=t.length,{value:t,done:!1})})},function(t,n,r){"use strict";var e=r(5),i=r(8),o=r(12),u=r(51),c=r(64),f=r(99).KEY,a=r(18),s=r(40),l=r(38),h=r(23),v=r(15),p=r(44),d=r(43),y=r(98),g=r(92),b=r(95),m=r(20),x=r(9),w=r(42),S=r(22),_=r(60),O=r(102),E=r(101),P=r(14),j=r(19),F=E.f,M=P.f,A=O.f,N=e.Symbol,T=e.JSON,I=T&&T.stringify,k="prototype",L=v("_hidden"),R=v("toPrimitive"),C={}.propertyIsEnumerable,D=s("symbol-registry"),U=s("symbols"),W=s("op-symbols"),G=Object[k],B="function"==typeof N,V=e.QObject,z=!V||!V[k]||!V[k].findChild,q=o&&a(function(){return 7!=_(M({},"a",{get:function(){return M(this,"a",{value:7}).a}})).a})?function(t,n,r){var e=F(G,n);e&&delete G[n],M(t,n,r),e&&t!==G&&M(G,n,e)}:M,K=function(t){var n=U[t]=_(N[k]);return n._k=t,n},J=B&&"symbol"==typeof N.iterator?function(t){return"symbol"==typeof t}:function(t){return t instanceof N},Y=function(t,n,r){return t===G&&Y(W,n,r),m(t),n=w(n,!0),m(r),i(U,n)?(r.enumerable?(i(t,L)&&t[L][n]&&(t[L][n]=!1),r=_(r,{enumerable:S(0,!1)})):(i(t,L)||M(t,L,S(1,{})),t[L][n]=!0),q(t,n,r)):M(t,n,r)},H=function(t,n){m(t);for(var r,e=g(n=x(n)),i=0,o=e.length;o>i;)Y(t,r=e[i++],n[r]);return t},$=function(t,n){return void 0===n?_(t):H(_(t),n)},X=function(t){var n=C.call(this,t=w(t,!0));return!(this===G&&i(U,t)&&!i(W,t))&&(!(n||!i(this,t)||!i(U,t)||i(this,L)&&this[L][t])||n)},Q=function(t,n){if(t=x(t),n=w(n,!0),t!==G||!i(U,n)||i(W,n)){var r=F(t,n);return!r||!i(U,n)||i(t,L)&&t[L][n]||(r.enumerable=!0),r}},Z=function(t){for(var n,r=A(x(t)),e=[],o=0;r.length>o;)i(U,n=r[o++])||n==L||n==f||e.push(n);return e},tt=function(t){for(var n,r=t===G,e=A(r?W:x(t)),o=[],u=0;e.length>u;)!i(U,n=e[u++])||r&&!i(G,n)||o.push(U[n]);return o};B||(N=function(){if(this instanceof N)throw TypeError("Symbol is not a constructor!");var t=h(arguments.length>0?arguments[0]:void 0),n=function(r){this===G&&n.call(W,r),i(this,L)&&i(this[L],t)&&(this[L][t]=!1),q(this,t,S(1,r))};return o&&z&&q(G,t,{configurable:!0,set:n}),K(t)},c(N[k],"toString",function(){return this._k}),E.f=Q,P.f=Y,r(61).f=O.f=Z,r(37).f=X,r(62).f=tt,o&&!r(36)&&c(G,"propertyIsEnumerable",X,!0),p.f=function(t){return K(v(t))}),u(u.G+u.W+u.F*!B,{Symbol:N});for(var nt="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),rt=0;nt.length>rt;)v(nt[rt++]);for(var nt=j(v.store),rt=0;nt.length>rt;)d(nt[rt++]);u(u.S+u.F*!B,"Symbol",{for:function(t){return i(D,t+="")?D[t]:D[t]=N(t)},keyFor:function(t){if(J(t))return y(D,t);throw TypeError(t+" is not a symbol!")},useSetter:function(){z=!0},useSimple:function(){z=!1}}),u(u.S+u.F*!B,"Object",{create:$,defineProperty:Y,defineProperties:H,getOwnPropertyDescriptor:Q,getOwnPropertyNames:Z,getOwnPropertySymbols:tt}),T&&u(u.S+u.F*(!B||a(function(){var t=N();return"[null]"!=I([t])||"{}"!=I({a:t})||"{}"!=I(Object(t))})),"JSON",{stringify:function(t){if(void 0!==t&&!J(t)){for(var n,r,e=[t],i=1;arguments.length>i;)e.push(arguments[i++]);return n=e[1],"function"==typeof n&&(r=n),!r&&b(n)||(n=function(t,n){if(r&&(n=r.call(this,t,n)),!J(n))return n}),e[1]=n,I.apply(T,e)}}}),N[k][R]||r(13)(N[k],R,N[k].valueOf),l(N,"Symbol"),l(Math,"Math",!0),l(e.JSON,"JSON",!0)},function(t,n,r){r(43)("asyncIterator")},function(t,n,r){r(43)("observable")},function(t,n,r){r(107);for(var e=r(5),i=r(13),o=r(35),u=r(15)("toStringTag"),c=["NodeList","DOMTokenList","MediaList","StyleSheetList","CSSRuleList"],f=0;f<5;f++){var a=c[f],s=e[a],l=s&&s.prototype;l&&!l[u]&&i(l,u,a),o[a]=o.Array}},function(t,n,r){var e=r(45),i=r(7)("toStringTag"),o="Arguments"==e(function(){return arguments}()),u=function(t,n){try{return t[n]}catch(t){}};t.exports=function(t){var n,r,c;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(r=u(n=Object(t),i))?r:o?e(n):"Object"==(c=e(n))&&"function"==typeof n.callee?"Arguments":c}},function(t,n,r){var e=r(45);t.exports=Object("z").propertyIsEnumerable(0)?Object:function(t){return"String"==e(t)?t.split(""):Object(t)}},function(t,n){n.f={}.propertyIsEnumerable},function(t,n,r){var e=r(30),i=r(16),o=r(75);t.exports=function(t){return function(n,r,u){var c,f=e(n),a=i(f.length),s=o(u,a);if(t&&r!=r){for(;a>s;)if((c=f[s++])!=c)return!0}else for(;a>s;s++)if((t||s in f)&&f[s]===r)return t||s||0;return!t&&-1}}},function(t,n,r){"use strict";var e=r(3),i=r(1),o=r(28),u=r(73),c=r(65),f=r(79),a=r(68),s=r(6),l=r(4),h=r(123),v=r(81),p=r(136);t.exports=function(t,n,r,d,y,g){var b=e[t],m=b,x=y?"set":"add",w=m&&m.prototype,S={},_=function(t){var n=w[t];o(w,t,"delete"==t?function(t){return!(g&&!s(t))&&n.call(this,0===t?0:t)}:"has"==t?function(t){return!(g&&!s(t))&&n.call(this,0===t?0:t)}:"get"==t?function(t){return g&&!s(t)?void 0:n.call(this,0===t?0:t)}:"add"==t?function(t){return n.call(this,0===t?0:t),this}:function(t,r){return n.call(this,0===t?0:t,r),this})};if("function"==typeof m&&(g||w.forEach&&!l(function(){(new m).entries().next()}))){var O=new m,E=O[x](g?{}:-0,1)!=O,P=l(function(){O.has(1)}),j=h(function(t){new m(t)}),F=!g&&l(function(){for(var t=new m,n=5;n--;)t[x](n,n);return!t.has(-0)});j||(m=n(function(n,r){a(n,m,t);var e=p(new b,n,m);return void 0!=r&&f(r,y,e[x],e),e}),m.prototype=w,w.constructor=m),(P||F)&&(_("delete"),_("has"),y&&_("get")),(F||E)&&_(x),g&&w.clear&&delete w.clear}else m=d.getConstructor(n,t,y,x),u(m.prototype,r),c.NEED=!0;return v(m,t),S[t]=m,i(i.G+i.W+i.F*(m!=b),S),g||d.setStrong(m,t,y),m}},function(t,n,r){"use strict";var e=r(27),i=r(28),o=r(4),u=r(46),c=r(7);t.exports=function(t,n,r){var f=c(t),a=r(u,f,""[t]),s=a[0],l=a[1];o(function(){var n={};return n[f]=function(){return 7},7!=""[t](n)})&&(i(String.prototype,t,s),e(RegExp.prototype,f,2==n?function(t,n){return l.call(t,this,n)}:function(t){return l.call(t,this)}))}
},function(t,n,r){"use strict";var e=r(2);t.exports=function(){var t=e(this),n="";return t.global&&(n+="g"),t.ignoreCase&&(n+="i"),t.multiline&&(n+="m"),t.unicode&&(n+="u"),t.sticky&&(n+="y"),n}},function(t,n){t.exports=function(t,n,r){var e=void 0===r;switch(n.length){case 0:return e?t():t.call(r);case 1:return e?t(n[0]):t.call(r,n[0]);case 2:return e?t(n[0],n[1]):t.call(r,n[0],n[1]);case 3:return e?t(n[0],n[1],n[2]):t.call(r,n[0],n[1],n[2]);case 4:return e?t(n[0],n[1],n[2],n[3]):t.call(r,n[0],n[1],n[2],n[3])}return t.apply(r,n)}},function(t,n,r){var e=r(6),i=r(45),o=r(7)("match");t.exports=function(t){var n;return e(t)&&(void 0!==(n=t[o])?!!n:"RegExp"==i(t))}},function(t,n,r){var e=r(7)("iterator"),i=!1;try{var o=[7][e]();o.return=function(){i=!0},Array.from(o,function(){throw 2})}catch(t){}t.exports=function(t,n){if(!n&&!i)return!1;var r=!1;try{var o=[7],u=o[e]();u.next=function(){return{done:r=!0}},o[e]=function(){return u},t(o)}catch(t){}return r}},function(t,n,r){t.exports=r(69)||!r(4)(function(){var t=Math.random();__defineSetter__.call(null,t,function(){}),delete r(3)[t]})},function(t,n){n.f=Object.getOwnPropertySymbols},function(t,n,r){var e=r(3),i="__core-js_shared__",o=e[i]||(e[i]={});t.exports=function(t){return o[t]||(o[t]={})}},function(t,n,r){for(var e,i=r(3),o=r(27),u=r(76),c=u("typed_array"),f=u("view"),a=!(!i.ArrayBuffer||!i.DataView),s=a,l=0,h="Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array".split(",");l<9;)(e=i[h[l++]])?(o(e.prototype,c,!0),o(e.prototype,f,!0)):s=!1;t.exports={ABV:a,CONSTR:s,TYPED:c,VIEW:f}},function(t,n){"use strict";var r={versions:function(){var t=window.navigator.userAgent;return{trident:t.indexOf("Trident")>-1,presto:t.indexOf("Presto")>-1,webKit:t.indexOf("AppleWebKit")>-1,gecko:t.indexOf("Gecko")>-1&&-1==t.indexOf("KHTML"),mobile:!!t.match(/AppleWebKit.*Mobile.*/),ios:!!t.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),android:t.indexOf("Android")>-1||t.indexOf("Linux")>-1,iPhone:t.indexOf("iPhone")>-1||t.indexOf("Mac")>-1,iPad:t.indexOf("iPad")>-1,webApp:-1==t.indexOf("Safari"),weixin:-1==t.indexOf("MicroMessenger")}}()};t.exports=r},function(t,n,r){"use strict";var e=r(85),i=function(t){return t&&t.__esModule?t:{default:t}}(e),o=function(){function t(t,n,e){return n||e?String.fromCharCode(n||e):r[t]||t}function n(t){return e[t]}var r={"&quot;":'"',"&lt;":"<","&gt;":">","&amp;":"&","&nbsp;":" "},e={};for(var u in r)e[r[u]]=u;return r["&apos;"]="'",e["'"]="&#39;",{encode:function(t){return t?(""+t).replace(/['<> "&]/g,n).replace(/\r?\n/g,"<br/>").replace(/\s/g,"&nbsp;"):""},decode:function(n){return n?(""+n).replace(/<br\s*\/?>/gi,"\n").replace(/&quot;|&lt;|&gt;|&amp;|&nbsp;|&apos;|&#(\d+);|&#(\d+)/g,t).replace(/\u00a0/g," "):""},encodeBase16:function(t){if(!t)return t;t+="";for(var n=[],r=0,e=t.length;e>r;r++)n.push(t.charCodeAt(r).toString(16).toUpperCase());return n.join("")},encodeBase16forJSON:function(t){if(!t)return t;t=t.replace(/[\u4E00-\u9FBF]/gi,function(t){return escape(t).replace("%u","\\u")});for(var n=[],r=0,e=t.length;e>r;r++)n.push(t.charCodeAt(r).toString(16).toUpperCase());return n.join("")},decodeBase16:function(t){if(!t)return t;t+="";for(var n=[],r=0,e=t.length;e>r;r+=2)n.push(String.fromCharCode("0x"+t.slice(r,r+2)));return n.join("")},encodeObject:function(t){if(t instanceof Array)for(var n=0,r=t.length;r>n;n++)t[n]=o.encodeObject(t[n]);else if("object"==(void 0===t?"undefined":(0,i.default)(t)))for(var e in t)t[e]=o.encodeObject(t[e]);else if("string"==typeof t)return o.encode(t);return t},loadScript:function(t){var n=document.createElement("script");document.getElementsByTagName("body")[0].appendChild(n),n.setAttribute("src",t)},addLoadEvent:function(t){var n=window.onload;"function"!=typeof window.onload?window.onload=t:window.onload=function(){n(),t()}}}}();t.exports=o},function(t,n,r){"use strict";var e=r(17),i=r(75),o=r(16);t.exports=function(t){for(var n=e(this),r=o(n.length),u=arguments.length,c=i(u>1?arguments[1]:void 0,r),f=u>2?arguments[2]:void 0,a=void 0===f?r:i(f,r);a>c;)n[c++]=t;return n}},function(t,n,r){"use strict";var e=r(11),i=r(66);t.exports=function(t,n,r){n in t?e.f(t,n,i(0,r)):t[n]=r}},function(t,n,r){var e=r(6),i=r(3).document,o=e(i)&&e(i.createElement);t.exports=function(t){return o?i.createElement(t):{}}},function(t,n){t.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},function(t,n,r){var e=r(7)("match");t.exports=function(t){var n=/./;try{"/./"[t](n)}catch(r){try{return n[e]=!1,!"/./"[t](n)}catch(t){}}return!0}},function(t,n,r){t.exports=r(3).document&&document.documentElement},function(t,n,r){var e=r(6),i=r(144).set;t.exports=function(t,n,r){var o,u=n.constructor;return u!==r&&"function"==typeof u&&(o=u.prototype)!==r.prototype&&e(o)&&i&&i(t,o),t}},function(t,n,r){var e=r(80),i=r(7)("iterator"),o=Array.prototype;t.exports=function(t){return void 0!==t&&(e.Array===t||o[i]===t)}},function(t,n,r){var e=r(45);t.exports=Array.isArray||function(t){return"Array"==e(t)}},function(t,n,r){"use strict";var e=r(70),i=r(66),o=r(81),u={};r(27)(u,r(7)("iterator"),function(){return this}),t.exports=function(t,n,r){t.prototype=e(u,{next:i(1,r)}),o(t,n+" Iterator")}},function(t,n,r){"use strict";var e=r(69),i=r(1),o=r(28),u=r(27),c=r(24),f=r(80),a=r(139),s=r(81),l=r(32),h=r(7)("iterator"),v=!([].keys&&"next"in[].keys()),p="keys",d="values",y=function(){return this};t.exports=function(t,n,r,g,b,m,x){a(r,n,g);var w,S,_,O=function(t){if(!v&&t in F)return F[t];switch(t){case p:case d:return function(){return new r(this,t)}}return function(){return new r(this,t)}},E=n+" Iterator",P=b==d,j=!1,F=t.prototype,M=F[h]||F["@@iterator"]||b&&F[b],A=M||O(b),N=b?P?O("entries"):A:void 0,T="Array"==n?F.entries||M:M;if(T&&(_=l(T.call(new t)))!==Object.prototype&&(s(_,E,!0),e||c(_,h)||u(_,h,y)),P&&M&&M.name!==d&&(j=!0,A=function(){return M.call(this)}),e&&!x||!v&&!j&&F[h]||u(F,h,A),f[n]=A,f[E]=y,b)if(w={values:P?A:O(d),keys:m?A:O(p),entries:N},x)for(S in w)S in F||o(F,S,w[S]);else i(i.P+i.F*(v||j),n,w);return w}},function(t,n){var r=Math.expm1;t.exports=!r||r(10)>22025.465794806718||r(10)<22025.465794806718||-2e-17!=r(-2e-17)?function(t){return 0==(t=+t)?t:t>-1e-6&&t<1e-6?t+t*t/2:Math.exp(t)-1}:r},function(t,n){t.exports=Math.sign||function(t){return 0==(t=+t)||t!=t?t:t<0?-1:1}},function(t,n,r){var e=r(3),i=r(151).set,o=e.MutationObserver||e.WebKitMutationObserver,u=e.process,c=e.Promise,f="process"==r(45)(u);t.exports=function(){var t,n,r,a=function(){var e,i;for(f&&(e=u.domain)&&e.exit();t;){i=t.fn,t=t.next;try{i()}catch(e){throw t?r():n=void 0,e}}n=void 0,e&&e.enter()};if(f)r=function(){u.nextTick(a)};else if(o){var s=!0,l=document.createTextNode("");new o(a).observe(l,{characterData:!0}),r=function(){l.data=s=!s}}else if(c&&c.resolve){var h=c.resolve();r=function(){h.then(a)}}else r=function(){i.call(e,a)};return function(e){var i={fn:e,next:void 0};n&&(n.next=i),t||(t=i,r()),n=i}}},function(t,n,r){var e=r(6),i=r(2),o=function(t,n){if(i(t),!e(n)&&null!==n)throw TypeError(n+": can't set as prototype!")};t.exports={set:Object.setPrototypeOf||("__proto__"in{}?function(t,n,e){try{e=r(53)(Function.call,r(31).f(Object.prototype,"__proto__").set,2),e(t,[]),n=!(t instanceof Array)}catch(t){n=!0}return function(t,r){return o(t,r),n?t.__proto__=r:e(t,r),t}}({},!1):void 0),check:o}},function(t,n,r){var e=r(126)("keys"),i=r(76);t.exports=function(t){return e[t]||(e[t]=i(t))}},function(t,n,r){var e=r(2),i=r(26),o=r(7)("species");t.exports=function(t,n){var r,u=e(t).constructor;return void 0===u||void 0==(r=e(u)[o])?n:i(r)}},function(t,n,r){var e=r(67),i=r(46);t.exports=function(t){return function(n,r){var o,u,c=String(i(n)),f=e(r),a=c.length;return f<0||f>=a?t?"":void 0:(o=c.charCodeAt(f),o<55296||o>56319||f+1===a||(u=c.charCodeAt(f+1))<56320||u>57343?t?c.charAt(f):o:t?c.slice(f,f+2):u-56320+(o-55296<<10)+65536)}}},function(t,n,r){var e=r(122),i=r(46);t.exports=function(t,n,r){if(e(n))throw TypeError("String#"+r+" doesn't accept regex!");return String(i(t))}},function(t,n,r){"use strict";var e=r(67),i=r(46);t.exports=function(t){var n=String(i(this)),r="",o=e(t);if(o<0||o==1/0)throw RangeError("Count can't be negative");for(;o>0;(o>>>=1)&&(n+=n))1&o&&(r+=n);return r}},function(t,n){t.exports="\t\n\v\f\r   ᠎             　\u2028\u2029\ufeff"},function(t,n,r){var e,i,o,u=r(53),c=r(121),f=r(135),a=r(132),s=r(3),l=s.process,h=s.setImmediate,v=s.clearImmediate,p=s.MessageChannel,d=0,y={},g="onreadystatechange",b=function(){var t=+this;if(y.hasOwnProperty(t)){var n=y[t];delete y[t],n()}},m=function(t){b.call(t.data)};h&&v||(h=function(t){for(var n=[],r=1;arguments.length>r;)n.push(arguments[r++]);return y[++d]=function(){c("function"==typeof t?t:Function(t),n)},e(d),d},v=function(t){delete y[t]},"process"==r(45)(l)?e=function(t){l.nextTick(u(b,t,1))}:p?(i=new p,o=i.port2,i.port1.onmessage=m,e=u(o.postMessage,o,1)):s.addEventListener&&"function"==typeof postMessage&&!s.importScripts?(e=function(t){s.postMessage(t+"","*")},s.addEventListener("message",m,!1)):e=g in a("script")?function(t){f.appendChild(a("script"))[g]=function(){f.removeChild(this),b.call(t)}}:function(t){setTimeout(u(b,t,1),0)}),t.exports={set:h,clear:v}},function(t,n,r){"use strict";var e=r(3),i=r(10),o=r(69),u=r(127),c=r(27),f=r(73),a=r(4),s=r(68),l=r(67),h=r(16),v=r(71).f,p=r(11).f,d=r(130),y=r(81),g="ArrayBuffer",b="DataView",m="prototype",x="Wrong length!",w="Wrong index!",S=e[g],_=e[b],O=e.Math,E=e.RangeError,P=e.Infinity,j=S,F=O.abs,M=O.pow,A=O.floor,N=O.log,T=O.LN2,I="buffer",k="byteLength",L="byteOffset",R=i?"_b":I,C=i?"_l":k,D=i?"_o":L,U=function(t,n,r){var e,i,o,u=Array(r),c=8*r-n-1,f=(1<<c)-1,a=f>>1,s=23===n?M(2,-24)-M(2,-77):0,l=0,h=t<0||0===t&&1/t<0?1:0;for(t=F(t),t!=t||t===P?(i=t!=t?1:0,e=f):(e=A(N(t)/T),t*(o=M(2,-e))<1&&(e--,o*=2),t+=e+a>=1?s/o:s*M(2,1-a),t*o>=2&&(e++,o/=2),e+a>=f?(i=0,e=f):e+a>=1?(i=(t*o-1)*M(2,n),e+=a):(i=t*M(2,a-1)*M(2,n),e=0));n>=8;u[l++]=255&i,i/=256,n-=8);for(e=e<<n|i,c+=n;c>0;u[l++]=255&e,e/=256,c-=8);return u[--l]|=128*h,u},W=function(t,n,r){var e,i=8*r-n-1,o=(1<<i)-1,u=o>>1,c=i-7,f=r-1,a=t[f--],s=127&a;for(a>>=7;c>0;s=256*s+t[f],f--,c-=8);for(e=s&(1<<-c)-1,s>>=-c,c+=n;c>0;e=256*e+t[f],f--,c-=8);if(0===s)s=1-u;else{if(s===o)return e?NaN:a?-P:P;e+=M(2,n),s-=u}return(a?-1:1)*e*M(2,s-n)},G=function(t){return t[3]<<24|t[2]<<16|t[1]<<8|t[0]},B=function(t){return[255&t]},V=function(t){return[255&t,t>>8&255]},z=function(t){return[255&t,t>>8&255,t>>16&255,t>>24&255]},q=function(t){return U(t,52,8)},K=function(t){return U(t,23,4)},J=function(t,n,r){p(t[m],n,{get:function(){return this[r]}})},Y=function(t,n,r,e){var i=+r,o=l(i);if(i!=o||o<0||o+n>t[C])throw E(w);var u=t[R]._b,c=o+t[D],f=u.slice(c,c+n);return e?f:f.reverse()},H=function(t,n,r,e,i,o){var u=+r,c=l(u);if(u!=c||c<0||c+n>t[C])throw E(w);for(var f=t[R]._b,a=c+t[D],s=e(+i),h=0;h<n;h++)f[a+h]=s[o?h:n-h-1]},$=function(t,n){s(t,S,g);var r=+n,e=h(r);if(r!=e)throw E(x);return e};if(u.ABV){if(!a(function(){new S})||!a(function(){new S(.5)})){S=function(t){return new j($(this,t))};for(var X,Q=S[m]=j[m],Z=v(j),tt=0;Z.length>tt;)(X=Z[tt++])in S||c(S,X,j[X]);o||(Q.constructor=S)}var nt=new _(new S(2)),rt=_[m].setInt8;nt.setInt8(0,2147483648),nt.setInt8(1,2147483649),!nt.getInt8(0)&&nt.getInt8(1)||f(_[m],{setInt8:function(t,n){rt.call(this,t,n<<24>>24)},setUint8:function(t,n){rt.call(this,t,n<<24>>24)}},!0)}else S=function(t){var n=$(this,t);this._b=d.call(Array(n),0),this[C]=n},_=function(t,n,r){s(this,_,b),s(t,S,b);var e=t[C],i=l(n);if(i<0||i>e)throw E("Wrong offset!");if(r=void 0===r?e-i:h(r),i+r>e)throw E(x);this[R]=t,this[D]=i,this[C]=r},i&&(J(S,k,"_l"),J(_,I,"_b"),J(_,k,"_l"),J(_,L,"_o")),f(_[m],{getInt8:function(t){return Y(this,1,t)[0]<<24>>24},getUint8:function(t){return Y(this,1,t)[0]},getInt16:function(t){var n=Y(this,2,t,arguments[1]);return(n[1]<<8|n[0])<<16>>16},getUint16:function(t){var n=Y(this,2,t,arguments[1]);return n[1]<<8|n[0]},getInt32:function(t){return G(Y(this,4,t,arguments[1]))},getUint32:function(t){return G(Y(this,4,t,arguments[1]))>>>0},getFloat32:function(t){return W(Y(this,4,t,arguments[1]),23,4)},getFloat64:function(t){return W(Y(this,8,t,arguments[1]),52,8)},setInt8:function(t,n){H(this,1,t,B,n)},setUint8:function(t,n){H(this,1,t,B,n)},setInt16:function(t,n){H(this,2,t,V,n,arguments[2])},setUint16:function(t,n){H(this,2,t,V,n,arguments[2])},setInt32:function(t,n){H(this,4,t,z,n,arguments[2])},setUint32:function(t,n){H(this,4,t,z,n,arguments[2])},setFloat32:function(t,n){H(this,4,t,K,n,arguments[2])},setFloat64:function(t,n){H(this,8,t,q,n,arguments[2])}});y(S,g),y(_,b),c(_[m],u.VIEW,!0),n[g]=S,n[b]=_},function(t,n,r){var e=r(3),i=r(52),o=r(69),u=r(182),c=r(11).f;t.exports=function(t){var n=i.Symbol||(i.Symbol=o?{}:e.Symbol||{});"_"==t.charAt(0)||t in n||c(n,t,{value:u.f(t)})}},function(t,n,r){var e=r(114),i=r(7)("iterator"),o=r(80);t.exports=r(52).getIteratorMethod=function(t){if(void 0!=t)return t[i]||t["@@iterator"]||o[e(t)]}},function(t,n,r){"use strict";var e=r(78),i=r(170),o=r(80),u=r(30);t.exports=r(140)(Array,"Array",function(t,n){this._t=u(t),this._i=0,this._k=n},function(){var t=this._t,n=this._k,r=this._i++;return!t||r>=t.length?(this._t=void 0,i(1)):"keys"==n?i(0,r):"values"==n?i(0,t[r]):i(0,[r,t[r]])},"values"),o.Arguments=o.Array,e("keys"),e("values"),e("entries")},function(t,n){function r(t,n){t.classList?t.classList.add(n):t.className+=" "+n}t.exports=r},function(t,n){function r(t,n){if(t.classList)t.classList.remove(n);else{var r=new RegExp("(^|\\b)"+n.split(" ").join("|")+"(\\b|$)","gi");t.className=t.className.replace(r," ")}}t.exports=r},function(t,n){function r(){throw new Error("setTimeout has not been defined")}function e(){throw new Error("clearTimeout has not been defined")}function i(t){if(s===setTimeout)return setTimeout(t,0);if((s===r||!s)&&setTimeout)return s=setTimeout,setTimeout(t,0);try{return s(t,0)}catch(n){try{return s.call(null,t,0)}catch(n){return s.call(this,t,0)}}}function o(t){if(l===clearTimeout)return clearTimeout(t);if((l===e||!l)&&clearTimeout)return l=clearTimeout,clearTimeout(t);try{return l(t)}catch(n){try{return l.call(null,t)}catch(n){return l.call(this,t)}}}function u(){d&&v&&(d=!1,v.length?p=v.concat(p):y=-1,p.length&&c())}function c(){if(!d){var t=i(u);d=!0;for(var n=p.length;n;){for(v=p,p=[];++y<n;)v&&v[y].run();y=-1,n=p.length}v=null,d=!1,o(t)}}function f(t,n){this.fun=t,this.array=n}function a(){}var s,l,h=t.exports={};!function(){try{s="function"==typeof setTimeout?setTimeout:r}catch(t){s=r}try{l="function"==typeof clearTimeout?clearTimeout:e}catch(t){l=e}}();var v,p=[],d=!1,y=-1;h.nextTick=function(t){var n=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)n[r-1]=arguments[r];p.push(new f(t,n)),1!==p.length||d||i(c)},f.prototype.run=function(){this.fun.apply(null,this.array)},h.title="browser",h.browser=!0,h.env={},h.argv=[],h.version="",h.versions={},h.on=a,h.addListener=a,h.once=a,h.off=a,h.removeListener=a,h.removeAllListeners=a,h.emit=a,h.prependListener=a,h.prependOnceListener=a,h.listeners=function(t){return[]},h.binding=function(t){throw new Error("process.binding is not supported")},h.cwd=function(){return"/"},h.chdir=function(t){throw new Error("process.chdir is not supported")},h.umask=function(){return 0}},function(t,n,r){var e=r(45);t.exports=function(t,n){if("number"!=typeof t&&"Number"!=e(t))throw TypeError(n);return+t}},function(t,n,r){"use strict";var e=r(17),i=r(75),o=r(16);t.exports=[].copyWithin||function(t,n){var r=e(this),u=o(r.length),c=i(t,u),f=i(n,u),a=arguments.length>2?arguments[2]:void 0,s=Math.min((void 0===a?u:i(a,u))-f,u-c),l=1;for(f<c&&c<f+s&&(l=-1,f+=s-1,c+=s-1);s-- >0;)f in r?r[c]=r[f]:delete r[c],c+=l,f+=l;return r}},function(t,n,r){var e=r(79);t.exports=function(t,n){var r=[];return e(t,!1,r.push,r,n),r}},function(t,n,r){var e=r(26),i=r(17),o=r(115),u=r(16);t.exports=function(t,n,r,c,f){e(n);var a=i(t),s=o(a),l=u(a.length),h=f?l-1:0,v=f?-1:1;if(r<2)for(;;){if(h in s){c=s[h],h+=v;break}if(h+=v,f?h<0:l<=h)throw TypeError("Reduce of empty array with no initial value")}for(;f?h>=0:l>h;h+=v)h in s&&(c=n(c,s[h],h,a));return c}},function(t,n,r){"use strict";var e=r(26),i=r(6),o=r(121),u=[].slice,c={},f=function(t,n,r){if(!(n in c)){for(var e=[],i=0;i<n;i++)e[i]="a["+i+"]";c[n]=Function("F,a","return new F("+e.join(",")+")")}return c[n](t,r)};t.exports=Function.bind||function(t){var n=e(this),r=u.call(arguments,1),c=function(){var e=r.concat(u.call(arguments));return this instanceof c?f(n,e.length,e):o(n,e,t)};return i(n.prototype)&&(c.prototype=n.prototype),c}},function(t,n,r){"use strict";var e=r(11).f,i=r(70),o=r(73),u=r(53),c=r(68),f=r(46),a=r(79),s=r(140),l=r(170),h=r(74),v=r(10),p=r(65).fastKey,d=v?"_s":"size",y=function(t,n){var r,e=p(n);if("F"!==e)return t._i[e];for(r=t._f;r;r=r.n)if(r.k==n)return r};t.exports={getConstructor:function(t,n,r,s){var l=t(function(t,e){c(t,l,n,"_i"),t._i=i(null),t._f=void 0,t._l=void 0,t[d]=0,void 0!=e&&a(e,r,t[s],t)});return o(l.prototype,{clear:function(){for(var t=this,n=t._i,r=t._f;r;r=r.n)r.r=!0,r.p&&(r.p=r.p.n=void 0),delete n[r.i];t._f=t._l=void 0,t[d]=0},delete:function(t){var n=this,r=y(n,t);if(r){var e=r.n,i=r.p;delete n._i[r.i],r.r=!0,i&&(i.n=e),e&&(e.p=i),n._f==r&&(n._f=e),n._l==r&&(n._l=i),n[d]--}return!!r},forEach:function(t){c(this,l,"forEach");for(var n,r=u(t,arguments.length>1?arguments[1]:void 0,3);n=n?n.n:this._f;)for(r(n.v,n.k,this);n&&n.r;)n=n.p},has:function(t){return!!y(this,t)}}),v&&e(l.prototype,"size",{get:function(){return f(this[d])}}),l},def:function(t,n,r){var e,i,o=y(t,n);return o?o.v=r:(t._l=o={i:i=p(n,!0),k:n,v:r,p:e=t._l,n:void 0,r:!1},t._f||(t._f=o),e&&(e.n=o),t[d]++,"F"!==i&&(t._i[i]=o)),t},getEntry:y,setStrong:function(t,n,r){s(t,n,function(t,n){this._t=t,this._k=n,this._l=void 0},function(){for(var t=this,n=t._k,r=t._l;r&&r.r;)r=r.p;return t._t&&(t._l=r=r?r.n:t._t._f)?"keys"==n?l(0,r.k):"values"==n?l(0,r.v):l(0,[r.k,r.v]):(t._t=void 0,l(1))},r?"entries":"values",!r,!0),h(n)}}},function(t,n,r){var e=r(114),i=r(161);t.exports=function(t){return function(){if(e(this)!=t)throw TypeError(t+"#toJSON isn't generic");return i(this)}}},function(t,n,r){"use strict";var e=r(73),i=r(65).getWeak,o=r(2),u=r(6),c=r(68),f=r(79),a=r(48),s=r(24),l=a(5),h=a(6),v=0,p=function(t){return t._l||(t._l=new d)},d=function(){this.a=[]},y=function(t,n){return l(t.a,function(t){return t[0]===n})};d.prototype={get:function(t){var n=y(this,t);if(n)return n[1]},has:function(t){return!!y(this,t)},set:function(t,n){var r=y(this,t);r?r[1]=n:this.a.push([t,n])},delete:function(t){var n=h(this.a,function(n){return n[0]===t});return~n&&this.a.splice(n,1),!!~n}},t.exports={getConstructor:function(t,n,r,o){var a=t(function(t,e){c(t,a,n,"_i"),t._i=v++,t._l=void 0,void 0!=e&&f(e,r,t[o],t)});return e(a.prototype,{delete:function(t){if(!u(t))return!1;var n=i(t);return!0===n?p(this).delete(t):n&&s(n,this._i)&&delete n[this._i]},has:function(t){if(!u(t))return!1;var n=i(t);return!0===n?p(this).has(t):n&&s(n,this._i)}}),a},def:function(t,n,r){var e=i(o(n),!0);return!0===e?p(t).set(n,r):e[t._i]=r,t},ufstore:p}},function(t,n,r){t.exports=!r(10)&&!r(4)(function(){return 7!=Object.defineProperty(r(132)("div"),"a",{get:function(){return 7}}).a})},function(t,n,r){var e=r(6),i=Math.floor;t.exports=function(t){return!e(t)&&isFinite(t)&&i(t)===t}},function(t,n,r){var e=r(2);t.exports=function(t,n,r,i){try{return i?n(e(r)[0],r[1]):n(r)}catch(n){var o=t.return;throw void 0!==o&&e(o.call(t)),n}}},function(t,n){t.exports=function(t,n){return{value:n,done:!!t}}},function(t,n){t.exports=Math.log1p||function(t){return(t=+t)>-1e-8&&t<1e-8?t-t*t/2:Math.log(1+t)}},function(t,n,r){"use strict";var e=r(72),i=r(125),o=r(116),u=r(17),c=r(115),f=Object.assign;t.exports=!f||r(4)(function(){var t={},n={},r=Symbol(),e="abcdefghijklmnopqrst";return t[r]=7,e.split("").forEach(function(t){n[t]=t}),7!=f({},t)[r]||Object.keys(f({},n)).join("")!=e})?function(t,n){for(var r=u(t),f=arguments.length,a=1,s=i.f,l=o.f;f>a;)for(var h,v=c(arguments[a++]),p=s?e(v).concat(s(v)):e(v),d=p.length,y=0;d>y;)l.call(v,h=p[y++])&&(r[h]=v[h]);return r}:f},function(t,n,r){var e=r(11),i=r(2),o=r(72);t.exports=r(10)?Object.defineProperties:function(t,n){i(t);for(var r,u=o(n),c=u.length,f=0;c>f;)e.f(t,r=u[f++],n[r]);return t}},function(t,n,r){var e=r(30),i=r(71).f,o={}.toString,u="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],c=function(t){try{return i(t)}catch(t){return u.slice()}};t.exports.f=function(t){return u&&"[object Window]"==o.call(t)?c(t):i(e(t))}},function(t,n,r){var e=r(24),i=r(30),o=r(117)(!1),u=r(145)("IE_PROTO");t.exports=function(t,n){var r,c=i(t),f=0,a=[];for(r in c)r!=u&&e(c,r)&&a.push(r);for(;n.length>f;)e(c,r=n[f++])&&(~o(a,r)||a.push(r));return a}},function(t,n,r){var e=r(72),i=r(30),o=r(116).f;t.exports=function(t){return function(n){for(var r,u=i(n),c=e(u),f=c.length,a=0,s=[];f>a;)o.call(u,r=c[a++])&&s.push(t?[r,u[r]]:u[r]);return s}}},function(t,n,r){var e=r(71),i=r(125),o=r(2),u=r(3).Reflect;t.exports=u&&u.ownKeys||function(t){var n=e.f(o(t)),r=i.f;return r?n.concat(r(t)):n}},function(t,n,r){var e=r(3).parseFloat,i=r(82).trim;t.exports=1/e(r(150)+"-0")!=-1/0?function(t){var n=i(String(t),3),r=e(n);return 0===r&&"-"==n.charAt(0)?-0:r}:e},function(t,n,r){var e=r(3).parseInt,i=r(82).trim,o=r(150),u=/^[\-+]?0[xX]/;t.exports=8!==e(o+"08")||22!==e(o+"0x16")?function(t,n){var r=i(String(t),3);return e(r,n>>>0||(u.test(r)?16:10))}:e},function(t,n){t.exports=Object.is||function(t,n){return t===n?0!==t||1/t==1/n:t!=t&&n!=n}},function(t,n,r){var e=r(16),i=r(149),o=r(46);t.exports=function(t,n,r,u){var c=String(o(t)),f=c.length,a=void 0===r?" ":String(r),s=e(n);if(s<=f||""==a)return c;var l=s-f,h=i.call(a,Math.ceil(l/a.length));return h.length>l&&(h=h.slice(0,l)),u?h+c:c+h}},function(t,n,r){n.f=r(7)},function(t,n,r){"use strict";var e=r(164);t.exports=r(118)("Map",function(t){return function(){return t(this,arguments.length>0?arguments[0]:void 0)}},{get:function(t){var n=e.getEntry(this,t);return n&&n.v},set:function(t,n){return e.def(this,0===t?0:t,n)}},e,!0)},function(t,n,r){r(10)&&"g"!=/./g.flags&&r(11).f(RegExp.prototype,"flags",{configurable:!0,get:r(120)})},function(t,n,r){"use strict";var e=r(164);t.exports=r(118)("Set",function(t){return function(){return t(this,arguments.length>0?arguments[0]:void 0)}},{add:function(t){return e.def(this,t=0===t?0:t,t)}},e)},function(t,n,r){"use strict";var e,i=r(48)(0),o=r(28),u=r(65),c=r(172),f=r(166),a=r(6),s=u.getWeak,l=Object.isExtensible,h=f.ufstore,v={},p=function(t){return function(){return t(this,arguments.length>0?arguments[0]:void 0)}},d={get:function(t){if(a(t)){var n=s(t);return!0===n?h(this).get(t):n?n[this._i]:void 0}},set:function(t,n){return f.def(this,t,n)}},y=t.exports=r(118)("WeakMap",p,d,f,!0,!0);7!=(new y).set((Object.freeze||Object)(v),7).get(v)&&(e=f.getConstructor(p),c(e.prototype,d),u.NEED=!0,i(["delete","has","get","set"],function(t){var n=y.prototype,r=n[t];o(n,t,function(n,i){if(a(n)&&!l(n)){this._f||(this._f=new e);var o=this._f[t](n,i);return"set"==t?this:o}return r.call(this,n,i)})}))},,,,function(t,n){"use strict";function r(){var t=document.querySelector("#page-nav");if(t&&!document.querySelector("#page-nav .extend.prev")&&(t.innerHTML='<a class="extend prev disabled" rel="prev">&laquo; Prev</a>'+t.innerHTML),t&&!document.querySelector("#page-nav .extend.next")&&(t.innerHTML=t.innerHTML+'<a class="extend next disabled" rel="next">Next &raquo;</a>'),yiliaConfig&&yiliaConfig.open_in_new){document.querySelectorAll(".article-entry a:not(.article-more-a)").forEach(function(t){var n=t.getAttribute("target");n&&""!==n||t.setAttribute("target","_blank")})}if(yiliaConfig&&yiliaConfig.toc_hide_index){document.querySelectorAll(".toc-number").forEach(function(t){t.style.display="none"})}var n=document.querySelector("#js-aboutme");n&&0!==n.length&&(n.innerHTML=n.innerText)}t.exports={init:r}},function(t,n,r){"use strict";function e(t){return t&&t.__esModule?t:{default:t}}function i(t,n){var r=/\/|index.html/g;return t.replace(r,"")===n.replace(r,"")}function o(){for(var t=document.querySelectorAll(".js-header-menu li a"),n=window.location.pathname,r=0,e=t.length;r<e;r++){var o=t[r];i(n,o.getAttribute("href"))&&(0,h.default)(o,"active")}}function u(t){for(var n=t.offsetLeft,r=t.offsetParent;null!==r;)n+=r.offsetLeft,r=r.offsetParent;return n}function c(t){for(var n=t.offsetTop,r=t.offsetParent;null!==r;)n+=r.offsetTop,r=r.offsetParent;return n}function f(t,n,r,e,i){var o=u(t),f=c(t)-n;if(f-r<=i){var a=t.$newDom;a||(a=t.cloneNode(!0),(0,d.default)(t,a),t.$newDom=a,a.style.position="fixed",a.style.top=(r||f)+"px",a.style.left=o+"px",a.style.zIndex=e||2,a.style.width="100%",a.style.color="#fff"),a.style.visibility="visible",t.style.visibility="hidden"}else{t.style.visibility="visible";var s=t.$newDom;s&&(s.style.visibility="hidden")}}function a(){var t=document.querySelector(".js-overlay"),n=document.querySelector(".js-header-menu");f(t,document.body.scrollTop,-63,2,0),f(n,document.body.scrollTop,1,3,0)}function s(){document.querySelector("#container").addEventListener("scroll",function(t){a()}),window.addEventListener("scroll",function(t){a()}),a()}var l=r(156),h=e(l),v=r(157),p=(e(v),r(382)),d=e(p),y=r(128),g=e(y),b=r(190),m=e(b),x=r(129);(function(){g.default.versions.mobile&&window.screen.width<800&&(o(),s())})(),(0,x.addLoadEvent)(function(){m.default.init()}),t.exports={}},,,,function(t,n,r){(function(t){"use strict";function n(t,n,r){t[n]||Object[e](t,n,{writable:!0,configurable:!0,value:r})}if(r(381),r(391),r(198),t._babelPolyfill)throw new Error("only one instance of babel-polyfill is allowed");t._babelPolyfill=!0;var e="defineProperty";n(String.prototype,"padLeft","".padStart),n(String.prototype,"padRight","".padEnd),"pop,reverse,shift,keys,values,entries,indexOf,every,some,forEach,map,filter,find,findIndex,includes,join,slice,concat,push,splice,unshift,sort,lastIndexOf,reduce,reduceRight,copyWithin,fill".split(",").forEach(function(t){[][t]&&n(Array,t,Function.call.bind([][t]))})}).call(n,function(){return this}())},,,function(t,n,r){r(210),t.exports=r(52).RegExp.escape},,,,function(t,n,r){var e=r(6),i=r(138),o=r(7)("species");t.exports=function(t){var n;return i(t)&&(n=t.constructor,"function"!=typeof n||n!==Array&&!i(n.prototype)||(n=void 0),e(n)&&null===(n=n[o])&&(n=void 0)),void 0===n?Array:n}},function(t,n,r){var e=r(202);t.exports=function(t,n){return new(e(t))(n)}},function(t,n,r){"use strict";var e=r(2),i=r(50),o="number";t.exports=function(t){if("string"!==t&&t!==o&&"default"!==t)throw TypeError("Incorrect hint");return i(e(this),t!=o)}},function(t,n,r){var e=r(72),i=r(125),o=r(116);t.exports=function(t){var n=e(t),r=i.f;if(r)for(var u,c=r(t),f=o.f,a=0;c.length>a;)f.call(t,u=c[a++])&&n.push(u);return n}},function(t,n,r){var e=r(72),i=r(30);t.exports=function(t,n){for(var r,o=i(t),u=e(o),c=u.length,f=0;c>f;)if(o[r=u[f++]]===n)return r}},function(t,n,r){"use strict";var e=r(208),i=r(121),o=r(26);t.exports=function(){for(var t=o(this),n=arguments.length,r=Array(n),u=0,c=e._,f=!1;n>u;)(r[u]=arguments[u++])===c&&(f=!0);return function(){var e,o=this,u=arguments.length,a=0,s=0;if(!f&&!u)return i(t,r,o);if(e=r.slice(),f)for(;n>a;a++)e[a]===c&&(e[a]=arguments[s++]);for(;u>s;)e.push(arguments[s++]);return i(t,e,o)}}},function(t,n,r){t.exports=r(3)},function(t,n){t.exports=function(t,n){var r=n===Object(n)?function(t){return n[t]}:n;return function(n){return String(n).replace(t,r)}}},function(t,n,r){var e=r(1),i=r(209)(/[\\^$*+?.()|[\]{}]/g,"\\$&");e(e.S,"RegExp",{escape:function(t){return i(t)}})},function(t,n,r){var e=r(1);e(e.P,"Array",{copyWithin:r(160)}),r(78)("copyWithin")},function(t,n,r){"use strict";var e=r(1),i=r(48)(4);e(e.P+e.F*!r(47)([].every,!0),"Array",{every:function(t){return i(this,t,arguments[1])}})},function(t,n,r){var e=r(1);e(e.P,"Array",{fill:r(130)}),r(78)("fill")},function(t,n,r){"use strict";var e=r(1),i=r(48)(2);e(e.P+e.F*!r(47)([].filter,!0),"Array",{filter:function(t){return i(this,t,arguments[1])}})},function(t,n,r){"use strict";var e=r(1),i=r(48)(6),o="findIndex",u=!0;o in[]&&Array(1)[o](function(){u=!1}),e(e.P+e.F*u,"Array",{findIndex:function(t){return i(this,t,arguments.length>1?arguments[1]:void 0)}}),r(78)(o)},function(t,n,r){"use strict";var e=r(1),i=r(48)(5),o="find",u=!0;o in[]&&Array(1)[o](function(){u=!1}),e(e.P+e.F*u,"Array",{find:function(t){return i(this,t,arguments.length>1?arguments[1]:void 0)}}),r(78)(o)},function(t,n,r){"use strict";var e=r(1),i=r(48)(0),o=r(47)([].forEach,!0);e(e.P+e.F*!o,"Array",{forEach:function(t){return i(this,t,arguments[1])}})},function(t,n,r){"use strict";var e=r(53),i=r(1),o=r(17),u=r(169),c=r(137),f=r(16),a=r(131),s=r(154);i(i.S+i.F*!r(123)(function(t){Array.from(t)}),"Array",{from:function(t){var n,r,i,l,h=o(t),v="function"==typeof this?this:Array,p=arguments.length,d=p>1?arguments[1]:void 0,y=void 0!==d,g=0,b=s(h);if(y&&(d=e(d,p>2?arguments[2]:void 0,2)),void 0==b||v==Array&&c(b))for(n=f(h.length),r=new v(n);n>g;g++)a(r,g,y?d(h[g],g):h[g]);else for(l=b.call(h),r=new v;!(i=l.next()).done;g++)a(r,g,y?u(l,d,[i.value,g],!0):i.value);return r.length=g,r}})},function(t,n,r){"use strict";var e=r(1),i=r(117)(!1),o=[].indexOf,u=!!o&&1/[1].indexOf(1,-0)<0;e(e.P+e.F*(u||!r(47)(o)),"Array",{indexOf:function(t){return u?o.apply(this,arguments)||0:i(this,t,arguments[1])}})},function(t,n,r){var e=r(1);e(e.S,"Array",{isArray:r(138)})},function(t,n,r){"use strict";var e=r(1),i=r(30),o=[].join;e(e.P+e.F*(r(115)!=Object||!r(47)(o)),"Array",{join:function(t){return o.call(i(this),void 0===t?",":t)}})},function(t,n,r){"use strict";var e=r(1),i=r(30),o=r(67),u=r(16),c=[].lastIndexOf,f=!!c&&1/[1].lastIndexOf(1,-0)<0;e(e.P+e.F*(f||!r(47)(c)),"Array",{lastIndexOf:function(t){if(f)return c.apply(this,arguments)||0;var n=i(this),r=u(n.length),e=r-1;for(arguments.length>1&&(e=Math.min(e,o(arguments[1]))),e<0&&(e=r+e);e>=0;e--)if(e in n&&n[e]===t)return e||0;return-1}})},function(t,n,r){"use strict";var e=r(1),i=r(48)(1);e(e.P+e.F*!r(47)([].map,!0),"Array",{map:function(t){return i(this,t,arguments[1])}})},function(t,n,r){"use strict";var e=r(1),i=r(131);e(e.S+e.F*r(4)(function(){function t(){}return!(Array.of.call(t)instanceof t)}),"Array",{of:function(){for(var t=0,n=arguments.length,r=new("function"==typeof this?this:Array)(n);n>t;)i(r,t,arguments[t++]);return r.length=n,r}})},function(t,n,r){"use strict";var e=r(1),i=r(162);e(e.P+e.F*!r(47)([].reduceRight,!0),"Array",{reduceRight:function(t){return i(this,t,arguments.length,arguments[1],!0)}})},function(t,n,r){"use strict";var e=r(1),i=r(162);e(e.P+e.F*!r(47)([].reduce,!0),"Array",{reduce:function(t){return i(this,t,arguments.length,arguments[1],!1)}})},function(t,n,r){"use strict";var e=r(1),i=r(135),o=r(45),u=r(75),c=r(16),f=[].slice;e(e.P+e.F*r(4)(function(){i&&f.call(i)}),"Array",{slice:function(t,n){var r=c(this.length),e=o(this);if(n=void 0===n?r:n,"Array"==e)return f.call(this,t,n);for(var i=u(t,r),a=u(n,r),s=c(a-i),l=Array(s),h=0;h<s;h++)l[h]="String"==e?this.charAt(i+h):this[i+h];return l}})},function(t,n,r){"use strict";var e=r(1),i=r(48)(3);e(e.P+e.F*!r(47)([].some,!0),"Array",{some:function(t){return i(this,t,arguments[1])}})},function(t,n,r){"use strict";var e=r(1),i=r(26),o=r(17),u=r(4),c=[].sort,f=[1,2,3];e(e.P+e.F*(u(function(){f.sort(void 0)})||!u(function(){f.sort(null)})||!r(47)(c)),"Array",{sort:function(t){return void 0===t?c.call(o(this)):c.call(o(this),i(t))}})},function(t,n,r){r(74)("Array")},function(t,n,r){var e=r(1);e(e.S,"Date",{now:function(){return(new Date).getTime()}})},function(t,n,r){"use strict";var e=r(1),i=r(4),o=Date.prototype.getTime,u=function(t){return t>9?t:"0"+t};e(e.P+e.F*(i(function(){return"0385-07-25T07:06:39.999Z"!=new Date(-5e13-1).toISOString()})||!i(function(){new Date(NaN).toISOString()})),"Date",{toISOString:function(){
if(!isFinite(o.call(this)))throw RangeError("Invalid time value");var t=this,n=t.getUTCFullYear(),r=t.getUTCMilliseconds(),e=n<0?"-":n>9999?"+":"";return e+("00000"+Math.abs(n)).slice(e?-6:-4)+"-"+u(t.getUTCMonth()+1)+"-"+u(t.getUTCDate())+"T"+u(t.getUTCHours())+":"+u(t.getUTCMinutes())+":"+u(t.getUTCSeconds())+"."+(r>99?r:"0"+u(r))+"Z"}})},function(t,n,r){"use strict";var e=r(1),i=r(17),o=r(50);e(e.P+e.F*r(4)(function(){return null!==new Date(NaN).toJSON()||1!==Date.prototype.toJSON.call({toISOString:function(){return 1}})}),"Date",{toJSON:function(t){var n=i(this),r=o(n);return"number"!=typeof r||isFinite(r)?n.toISOString():null}})},function(t,n,r){var e=r(7)("toPrimitive"),i=Date.prototype;e in i||r(27)(i,e,r(204))},function(t,n,r){var e=Date.prototype,i="Invalid Date",o="toString",u=e[o],c=e.getTime;new Date(NaN)+""!=i&&r(28)(e,o,function(){var t=c.call(this);return t===t?u.call(this):i})},function(t,n,r){var e=r(1);e(e.P,"Function",{bind:r(163)})},function(t,n,r){"use strict";var e=r(6),i=r(32),o=r(7)("hasInstance"),u=Function.prototype;o in u||r(11).f(u,o,{value:function(t){if("function"!=typeof this||!e(t))return!1;if(!e(this.prototype))return t instanceof this;for(;t=i(t);)if(this.prototype===t)return!0;return!1}})},function(t,n,r){var e=r(11).f,i=r(66),o=r(24),u=Function.prototype,c="name",f=Object.isExtensible||function(){return!0};c in u||r(10)&&e(u,c,{configurable:!0,get:function(){try{var t=this,n=(""+t).match(/^\s*function ([^ (]*)/)[1];return o(t,c)||!f(t)||e(t,c,i(5,n)),n}catch(t){return""}}})},function(t,n,r){var e=r(1),i=r(171),o=Math.sqrt,u=Math.acosh;e(e.S+e.F*!(u&&710==Math.floor(u(Number.MAX_VALUE))&&u(1/0)==1/0),"Math",{acosh:function(t){return(t=+t)<1?NaN:t>94906265.62425156?Math.log(t)+Math.LN2:i(t-1+o(t-1)*o(t+1))}})},function(t,n,r){function e(t){return isFinite(t=+t)&&0!=t?t<0?-e(-t):Math.log(t+Math.sqrt(t*t+1)):t}var i=r(1),o=Math.asinh;i(i.S+i.F*!(o&&1/o(0)>0),"Math",{asinh:e})},function(t,n,r){var e=r(1),i=Math.atanh;e(e.S+e.F*!(i&&1/i(-0)<0),"Math",{atanh:function(t){return 0==(t=+t)?t:Math.log((1+t)/(1-t))/2}})},function(t,n,r){var e=r(1),i=r(142);e(e.S,"Math",{cbrt:function(t){return i(t=+t)*Math.pow(Math.abs(t),1/3)}})},function(t,n,r){var e=r(1);e(e.S,"Math",{clz32:function(t){return(t>>>=0)?31-Math.floor(Math.log(t+.5)*Math.LOG2E):32}})},function(t,n,r){var e=r(1),i=Math.exp;e(e.S,"Math",{cosh:function(t){return(i(t=+t)+i(-t))/2}})},function(t,n,r){var e=r(1),i=r(141);e(e.S+e.F*(i!=Math.expm1),"Math",{expm1:i})},function(t,n,r){var e=r(1),i=r(142),o=Math.pow,u=o(2,-52),c=o(2,-23),f=o(2,127)*(2-c),a=o(2,-126),s=function(t){return t+1/u-1/u};e(e.S,"Math",{fround:function(t){var n,r,e=Math.abs(t),o=i(t);return e<a?o*s(e/a/c)*a*c:(n=(1+c/u)*e,r=n-(n-e),r>f||r!=r?o*(1/0):o*r)}})},function(t,n,r){var e=r(1),i=Math.abs;e(e.S,"Math",{hypot:function(t,n){for(var r,e,o=0,u=0,c=arguments.length,f=0;u<c;)r=i(arguments[u++]),f<r?(e=f/r,o=o*e*e+1,f=r):r>0?(e=r/f,o+=e*e):o+=r;return f===1/0?1/0:f*Math.sqrt(o)}})},function(t,n,r){var e=r(1),i=Math.imul;e(e.S+e.F*r(4)(function(){return-5!=i(4294967295,5)||2!=i.length}),"Math",{imul:function(t,n){var r=65535,e=+t,i=+n,o=r&e,u=r&i;return 0|o*u+((r&e>>>16)*u+o*(r&i>>>16)<<16>>>0)}})},function(t,n,r){var e=r(1);e(e.S,"Math",{log10:function(t){return Math.log(t)/Math.LN10}})},function(t,n,r){var e=r(1);e(e.S,"Math",{log1p:r(171)})},function(t,n,r){var e=r(1);e(e.S,"Math",{log2:function(t){return Math.log(t)/Math.LN2}})},function(t,n,r){var e=r(1);e(e.S,"Math",{sign:r(142)})},function(t,n,r){var e=r(1),i=r(141),o=Math.exp;e(e.S+e.F*r(4)(function(){return-2e-17!=!Math.sinh(-2e-17)}),"Math",{sinh:function(t){return Math.abs(t=+t)<1?(i(t)-i(-t))/2:(o(t-1)-o(-t-1))*(Math.E/2)}})},function(t,n,r){var e=r(1),i=r(141),o=Math.exp;e(e.S,"Math",{tanh:function(t){var n=i(t=+t),r=i(-t);return n==1/0?1:r==1/0?-1:(n-r)/(o(t)+o(-t))}})},function(t,n,r){var e=r(1);e(e.S,"Math",{trunc:function(t){return(t>0?Math.floor:Math.ceil)(t)}})},function(t,n,r){"use strict";var e=r(3),i=r(24),o=r(45),u=r(136),c=r(50),f=r(4),a=r(71).f,s=r(31).f,l=r(11).f,h=r(82).trim,v="Number",p=e[v],d=p,y=p.prototype,g=o(r(70)(y))==v,b="trim"in String.prototype,m=function(t){var n=c(t,!1);if("string"==typeof n&&n.length>2){n=b?n.trim():h(n,3);var r,e,i,o=n.charCodeAt(0);if(43===o||45===o){if(88===(r=n.charCodeAt(2))||120===r)return NaN}else if(48===o){switch(n.charCodeAt(1)){case 66:case 98:e=2,i=49;break;case 79:case 111:e=8,i=55;break;default:return+n}for(var u,f=n.slice(2),a=0,s=f.length;a<s;a++)if((u=f.charCodeAt(a))<48||u>i)return NaN;return parseInt(f,e)}}return+n};if(!p(" 0o1")||!p("0b1")||p("+0x1")){p=function(t){var n=arguments.length<1?0:t,r=this;return r instanceof p&&(g?f(function(){y.valueOf.call(r)}):o(r)!=v)?u(new d(m(n)),r,p):m(n)};for(var x,w=r(10)?a(d):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger".split(","),S=0;w.length>S;S++)i(d,x=w[S])&&!i(p,x)&&l(p,x,s(d,x));p.prototype=y,y.constructor=p,r(28)(e,v,p)}},function(t,n,r){var e=r(1);e(e.S,"Number",{EPSILON:Math.pow(2,-52)})},function(t,n,r){var e=r(1),i=r(3).isFinite;e(e.S,"Number",{isFinite:function(t){return"number"==typeof t&&i(t)}})},function(t,n,r){var e=r(1);e(e.S,"Number",{isInteger:r(168)})},function(t,n,r){var e=r(1);e(e.S,"Number",{isNaN:function(t){return t!=t}})},function(t,n,r){var e=r(1),i=r(168),o=Math.abs;e(e.S,"Number",{isSafeInteger:function(t){return i(t)&&o(t)<=9007199254740991}})},function(t,n,r){var e=r(1);e(e.S,"Number",{MAX_SAFE_INTEGER:9007199254740991})},function(t,n,r){var e=r(1);e(e.S,"Number",{MIN_SAFE_INTEGER:-9007199254740991})},function(t,n,r){var e=r(1),i=r(178);e(e.S+e.F*(Number.parseFloat!=i),"Number",{parseFloat:i})},function(t,n,r){var e=r(1),i=r(179);e(e.S+e.F*(Number.parseInt!=i),"Number",{parseInt:i})},function(t,n,r){"use strict";var e=r(1),i=r(67),o=r(159),u=r(149),c=1..toFixed,f=Math.floor,a=[0,0,0,0,0,0],s="Number.toFixed: incorrect invocation!",l="0",h=function(t,n){for(var r=-1,e=n;++r<6;)e+=t*a[r],a[r]=e%1e7,e=f(e/1e7)},v=function(t){for(var n=6,r=0;--n>=0;)r+=a[n],a[n]=f(r/t),r=r%t*1e7},p=function(){for(var t=6,n="";--t>=0;)if(""!==n||0===t||0!==a[t]){var r=String(a[t]);n=""===n?r:n+u.call(l,7-r.length)+r}return n},d=function(t,n,r){return 0===n?r:n%2==1?d(t,n-1,r*t):d(t*t,n/2,r)},y=function(t){for(var n=0,r=t;r>=4096;)n+=12,r/=4096;for(;r>=2;)n+=1,r/=2;return n};e(e.P+e.F*(!!c&&("0.000"!==8e-5.toFixed(3)||"1"!==.9.toFixed(0)||"1.25"!==1.255.toFixed(2)||"1000000000000000128"!==(0xde0b6b3a7640080).toFixed(0))||!r(4)(function(){c.call({})})),"Number",{toFixed:function(t){var n,r,e,c,f=o(this,s),a=i(t),g="",b=l;if(a<0||a>20)throw RangeError(s);if(f!=f)return"NaN";if(f<=-1e21||f>=1e21)return String(f);if(f<0&&(g="-",f=-f),f>1e-21)if(n=y(f*d(2,69,1))-69,r=n<0?f*d(2,-n,1):f/d(2,n,1),r*=4503599627370496,(n=52-n)>0){for(h(0,r),e=a;e>=7;)h(1e7,0),e-=7;for(h(d(10,e,1),0),e=n-1;e>=23;)v(1<<23),e-=23;v(1<<e),h(1,1),v(2),b=p()}else h(0,r),h(1<<-n,0),b=p()+u.call(l,a);return a>0?(c=b.length,b=g+(c<=a?"0."+u.call(l,a-c)+b:b.slice(0,c-a)+"."+b.slice(c-a))):b=g+b,b}})},function(t,n,r){"use strict";var e=r(1),i=r(4),o=r(159),u=1..toPrecision;e(e.P+e.F*(i(function(){return"1"!==u.call(1,void 0)})||!i(function(){u.call({})})),"Number",{toPrecision:function(t){var n=o(this,"Number#toPrecision: incorrect invocation!");return void 0===t?u.call(n):u.call(n,t)}})},function(t,n,r){var e=r(1);e(e.S+e.F,"Object",{assign:r(172)})},function(t,n,r){var e=r(1);e(e.S,"Object",{create:r(70)})},function(t,n,r){var e=r(1);e(e.S+e.F*!r(10),"Object",{defineProperties:r(173)})},function(t,n,r){var e=r(1);e(e.S+e.F*!r(10),"Object",{defineProperty:r(11).f})},function(t,n,r){var e=r(6),i=r(65).onFreeze;r(49)("freeze",function(t){return function(n){return t&&e(n)?t(i(n)):n}})},function(t,n,r){var e=r(30),i=r(31).f;r(49)("getOwnPropertyDescriptor",function(){return function(t,n){return i(e(t),n)}})},function(t,n,r){r(49)("getOwnPropertyNames",function(){return r(174).f})},function(t,n,r){var e=r(17),i=r(32);r(49)("getPrototypeOf",function(){return function(t){return i(e(t))}})},function(t,n,r){var e=r(6);r(49)("isExtensible",function(t){return function(n){return!!e(n)&&(!t||t(n))}})},function(t,n,r){var e=r(6);r(49)("isFrozen",function(t){return function(n){return!e(n)||!!t&&t(n)}})},function(t,n,r){var e=r(6);r(49)("isSealed",function(t){return function(n){return!e(n)||!!t&&t(n)}})},function(t,n,r){var e=r(1);e(e.S,"Object",{is:r(180)})},function(t,n,r){var e=r(17),i=r(72);r(49)("keys",function(){return function(t){return i(e(t))}})},function(t,n,r){var e=r(6),i=r(65).onFreeze;r(49)("preventExtensions",function(t){return function(n){return t&&e(n)?t(i(n)):n}})},function(t,n,r){var e=r(6),i=r(65).onFreeze;r(49)("seal",function(t){return function(n){return t&&e(n)?t(i(n)):n}})},function(t,n,r){var e=r(1);e(e.S,"Object",{setPrototypeOf:r(144).set})},function(t,n,r){"use strict";var e=r(114),i={};i[r(7)("toStringTag")]="z",i+""!="[object z]"&&r(28)(Object.prototype,"toString",function(){return"[object "+e(this)+"]"},!0)},function(t,n,r){var e=r(1),i=r(178);e(e.G+e.F*(parseFloat!=i),{parseFloat:i})},function(t,n,r){var e=r(1),i=r(179);e(e.G+e.F*(parseInt!=i),{parseInt:i})},function(t,n,r){"use strict";var e,i,o,u=r(69),c=r(3),f=r(53),a=r(114),s=r(1),l=r(6),h=r(26),v=r(68),p=r(79),d=r(146),y=r(151).set,g=r(143)(),b="Promise",m=c.TypeError,x=c.process,w=c[b],x=c.process,S="process"==a(x),_=function(){},O=!!function(){try{var t=w.resolve(1),n=(t.constructor={})[r(7)("species")]=function(t){t(_,_)};return(S||"function"==typeof PromiseRejectionEvent)&&t.then(_)instanceof n}catch(t){}}(),E=function(t,n){return t===n||t===w&&n===o},P=function(t){var n;return!(!l(t)||"function"!=typeof(n=t.then))&&n},j=function(t){return E(w,t)?new F(t):new i(t)},F=i=function(t){var n,r;this.promise=new t(function(t,e){if(void 0!==n||void 0!==r)throw m("Bad Promise constructor");n=t,r=e}),this.resolve=h(n),this.reject=h(r)},M=function(t){try{t()}catch(t){return{error:t}}},A=function(t,n){if(!t._n){t._n=!0;var r=t._c;g(function(){for(var e=t._v,i=1==t._s,o=0;r.length>o;)!function(n){var r,o,u=i?n.ok:n.fail,c=n.resolve,f=n.reject,a=n.domain;try{u?(i||(2==t._h&&I(t),t._h=1),!0===u?r=e:(a&&a.enter(),r=u(e),a&&a.exit()),r===n.promise?f(m("Promise-chain cycle")):(o=P(r))?o.call(r,c,f):c(r)):f(e)}catch(t){f(t)}}(r[o++]);t._c=[],t._n=!1,n&&!t._h&&N(t)})}},N=function(t){y.call(c,function(){var n,r,e,i=t._v;if(T(t)&&(n=M(function(){S?x.emit("unhandledRejection",i,t):(r=c.onunhandledrejection)?r({promise:t,reason:i}):(e=c.console)&&e.error&&e.error("Unhandled promise rejection",i)}),t._h=S||T(t)?2:1),t._a=void 0,n)throw n.error})},T=function(t){if(1==t._h)return!1;for(var n,r=t._a||t._c,e=0;r.length>e;)if(n=r[e++],n.fail||!T(n.promise))return!1;return!0},I=function(t){y.call(c,function(){var n;S?x.emit("rejectionHandled",t):(n=c.onrejectionhandled)&&n({promise:t,reason:t._v})})},k=function(t){var n=this;n._d||(n._d=!0,n=n._w||n,n._v=t,n._s=2,n._a||(n._a=n._c.slice()),A(n,!0))},L=function(t){var n,r=this;if(!r._d){r._d=!0,r=r._w||r;try{if(r===t)throw m("Promise can't be resolved itself");(n=P(t))?g(function(){var e={_w:r,_d:!1};try{n.call(t,f(L,e,1),f(k,e,1))}catch(t){k.call(e,t)}}):(r._v=t,r._s=1,A(r,!1))}catch(t){k.call({_w:r,_d:!1},t)}}};O||(w=function(t){v(this,w,b,"_h"),h(t),e.call(this);try{t(f(L,this,1),f(k,this,1))}catch(t){k.call(this,t)}},e=function(t){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1},e.prototype=r(73)(w.prototype,{then:function(t,n){var r=j(d(this,w));return r.ok="function"!=typeof t||t,r.fail="function"==typeof n&&n,r.domain=S?x.domain:void 0,this._c.push(r),this._a&&this._a.push(r),this._s&&A(this,!1),r.promise},catch:function(t){return this.then(void 0,t)}}),F=function(){var t=new e;this.promise=t,this.resolve=f(L,t,1),this.reject=f(k,t,1)}),s(s.G+s.W+s.F*!O,{Promise:w}),r(81)(w,b),r(74)(b),o=r(52)[b],s(s.S+s.F*!O,b,{reject:function(t){var n=j(this);return(0,n.reject)(t),n.promise}}),s(s.S+s.F*(u||!O),b,{resolve:function(t){if(t instanceof w&&E(t.constructor,this))return t;var n=j(this);return(0,n.resolve)(t),n.promise}}),s(s.S+s.F*!(O&&r(123)(function(t){w.all(t).catch(_)})),b,{all:function(t){var n=this,r=j(n),e=r.resolve,i=r.reject,o=M(function(){var r=[],o=0,u=1;p(t,!1,function(t){var c=o++,f=!1;r.push(void 0),u++,n.resolve(t).then(function(t){f||(f=!0,r[c]=t,--u||e(r))},i)}),--u||e(r)});return o&&i(o.error),r.promise},race:function(t){var n=this,r=j(n),e=r.reject,i=M(function(){p(t,!1,function(t){n.resolve(t).then(r.resolve,e)})});return i&&e(i.error),r.promise}})},function(t,n,r){var e=r(1),i=r(26),o=r(2),u=(r(3).Reflect||{}).apply,c=Function.apply;e(e.S+e.F*!r(4)(function(){u(function(){})}),"Reflect",{apply:function(t,n,r){var e=i(t),f=o(r);return u?u(e,n,f):c.call(e,n,f)}})},function(t,n,r){var e=r(1),i=r(70),o=r(26),u=r(2),c=r(6),f=r(4),a=r(163),s=(r(3).Reflect||{}).construct,l=f(function(){function t(){}return!(s(function(){},[],t)instanceof t)}),h=!f(function(){s(function(){})});e(e.S+e.F*(l||h),"Reflect",{construct:function(t,n){o(t),u(n);var r=arguments.length<3?t:o(arguments[2]);if(h&&!l)return s(t,n,r);if(t==r){switch(n.length){case 0:return new t;case 1:return new t(n[0]);case 2:return new t(n[0],n[1]);case 3:return new t(n[0],n[1],n[2]);case 4:return new t(n[0],n[1],n[2],n[3])}var e=[null];return e.push.apply(e,n),new(a.apply(t,e))}var f=r.prototype,v=i(c(f)?f:Object.prototype),p=Function.apply.call(t,v,n);return c(p)?p:v}})},function(t,n,r){var e=r(11),i=r(1),o=r(2),u=r(50);i(i.S+i.F*r(4)(function(){Reflect.defineProperty(e.f({},1,{value:1}),1,{value:2})}),"Reflect",{defineProperty:function(t,n,r){o(t),n=u(n,!0),o(r);try{return e.f(t,n,r),!0}catch(t){return!1}}})},function(t,n,r){var e=r(1),i=r(31).f,o=r(2);e(e.S,"Reflect",{deleteProperty:function(t,n){var r=i(o(t),n);return!(r&&!r.configurable)&&delete t[n]}})},function(t,n,r){"use strict";var e=r(1),i=r(2),o=function(t){this._t=i(t),this._i=0;var n,r=this._k=[];for(n in t)r.push(n)};r(139)(o,"Object",function(){var t,n=this,r=n._k;do{if(n._i>=r.length)return{value:void 0,done:!0}}while(!((t=r[n._i++])in n._t));return{value:t,done:!1}}),e(e.S,"Reflect",{enumerate:function(t){return new o(t)}})},function(t,n,r){var e=r(31),i=r(1),o=r(2);i(i.S,"Reflect",{getOwnPropertyDescriptor:function(t,n){return e.f(o(t),n)}})},function(t,n,r){var e=r(1),i=r(32),o=r(2);e(e.S,"Reflect",{getPrototypeOf:function(t){return i(o(t))}})},function(t,n,r){function e(t,n){var r,c,s=arguments.length<3?t:arguments[2];return a(t)===s?t[n]:(r=i.f(t,n))?u(r,"value")?r.value:void 0!==r.get?r.get.call(s):void 0:f(c=o(t))?e(c,n,s):void 0}var i=r(31),o=r(32),u=r(24),c=r(1),f=r(6),a=r(2);c(c.S,"Reflect",{get:e})},function(t,n,r){var e=r(1);e(e.S,"Reflect",{has:function(t,n){return n in t}})},function(t,n,r){var e=r(1),i=r(2),o=Object.isExtensible;e(e.S,"Reflect",{isExtensible:function(t){return i(t),!o||o(t)}})},function(t,n,r){var e=r(1);e(e.S,"Reflect",{ownKeys:r(177)})},function(t,n,r){var e=r(1),i=r(2),o=Object.preventExtensions;e(e.S,"Reflect",{preventExtensions:function(t){i(t);try{return o&&o(t),!0}catch(t){return!1}}})},function(t,n,r){var e=r(1),i=r(144);i&&e(e.S,"Reflect",{setPrototypeOf:function(t,n){i.check(t,n);try{return i.set(t,n),!0}catch(t){return!1}}})},function(t,n,r){function e(t,n,r){var f,h,v=arguments.length<4?t:arguments[3],p=o.f(s(t),n);if(!p){if(l(h=u(t)))return e(h,n,r,v);p=a(0)}return c(p,"value")?!(!1===p.writable||!l(v)||(f=o.f(v,n)||a(0),f.value=r,i.f(v,n,f),0)):void 0!==p.set&&(p.set.call(v,r),!0)}var i=r(11),o=r(31),u=r(32),c=r(24),f=r(1),a=r(66),s=r(2),l=r(6);f(f.S,"Reflect",{set:e})},function(t,n,r){var e=r(3),i=r(136),o=r(11).f,u=r(71).f,c=r(122),f=r(120),a=e.RegExp,s=a,l=a.prototype,h=/a/g,v=/a/g,p=new a(h)!==h;if(r(10)&&(!p||r(4)(function(){return v[r(7)("match")]=!1,a(h)!=h||a(v)==v||"/a/i"!=a(h,"i")}))){a=function(t,n){var r=this instanceof a,e=c(t),o=void 0===n;return!r&&e&&t.constructor===a&&o?t:i(p?new s(e&&!o?t.source:t,n):s((e=t instanceof a)?t.source:t,e&&o?f.call(t):n),r?this:l,a)};for(var d=u(s),y=0;d.length>y;)!function(t){t in a||o(a,t,{configurable:!0,get:function(){return s[t]},set:function(n){s[t]=n}})}(d[y++]);l.constructor=a,a.prototype=l,r(28)(e,"RegExp",a)}r(74)("RegExp")},function(t,n,r){r(119)("match",1,function(t,n,r){return[function(r){"use strict";var e=t(this),i=void 0==r?void 0:r[n];return void 0!==i?i.call(r,e):new RegExp(r)[n](String(e))},r]})},function(t,n,r){r(119)("replace",2,function(t,n,r){return[function(e,i){"use strict";var o=t(this),u=void 0==e?void 0:e[n];return void 0!==u?u.call(e,o,i):r.call(String(o),e,i)},r]})},function(t,n,r){r(119)("search",1,function(t,n,r){return[function(r){"use strict";var e=t(this),i=void 0==r?void 0:r[n];return void 0!==i?i.call(r,e):new RegExp(r)[n](String(e))},r]})},function(t,n,r){r(119)("split",2,function(t,n,e){"use strict";var i=r(122),o=e,u=[].push,c="split",f="length",a="lastIndex";if("c"=="abbc"[c](/(b)*/)[1]||4!="test"[c](/(?:)/,-1)[f]||2!="ab"[c](/(?:ab)*/)[f]||4!="."[c](/(.?)(.?)/)[f]||"."[c](/()()/)[f]>1||""[c](/.?/)[f]){var s=void 0===/()??/.exec("")[1];e=function(t,n){var r=String(this);if(void 0===t&&0===n)return[];if(!i(t))return o.call(r,t,n);var e,c,l,h,v,p=[],d=(t.ignoreCase?"i":"")+(t.multiline?"m":"")+(t.unicode?"u":"")+(t.sticky?"y":""),y=0,g=void 0===n?4294967295:n>>>0,b=new RegExp(t.source,d+"g");for(s||(e=new RegExp("^"+b.source+"$(?!\\s)",d));(c=b.exec(r))&&!((l=c.index+c[0][f])>y&&(p.push(r.slice(y,c.index)),!s&&c[f]>1&&c[0].replace(e,function(){for(v=1;v<arguments[f]-2;v++)void 0===arguments[v]&&(c[v]=void 0)}),c[f]>1&&c.index<r[f]&&u.apply(p,c.slice(1)),h=c[0][f],y=l,p[f]>=g));)b[a]===c.index&&b[a]++;return y===r[f]?!h&&b.test("")||p.push(""):p.push(r.slice(y)),p[f]>g?p.slice(0,g):p}}else"0"[c](void 0,0)[f]&&(e=function(t,n){return void 0===t&&0===n?[]:o.call(this,t,n)});return[function(r,i){var o=t(this),u=void 0==r?void 0:r[n];return void 0!==u?u.call(r,o,i):e.call(String(o),r,i)},e]})},function(t,n,r){"use strict";r(184);var e=r(2),i=r(120),o=r(10),u="toString",c=/./[u],f=function(t){r(28)(RegExp.prototype,u,t,!0)};r(4)(function(){return"/a/b"!=c.call({source:"a",flags:"b"})})?f(function(){var t=e(this);return"/".concat(t.source,"/","flags"in t?t.flags:!o&&t instanceof RegExp?i.call(t):void 0)}):c.name!=u&&f(function(){return c.call(this)})},function(t,n,r){"use strict";r(29)("anchor",function(t){return function(n){return t(this,"a","name",n)}})},function(t,n,r){"use strict";r(29)("big",function(t){return function(){return t(this,"big","","")}})},function(t,n,r){"use strict";r(29)("blink",function(t){return function(){return t(this,"blink","","")}})},function(t,n,r){"use strict";r(29)("bold",function(t){return function(){return t(this,"b","","")}})},function(t,n,r){"use strict";var e=r(1),i=r(147)(!1);e(e.P,"String",{codePointAt:function(t){return i(this,t)}})},function(t,n,r){"use strict";var e=r(1),i=r(16),o=r(148),u="endsWith",c=""[u];e(e.P+e.F*r(134)(u),"String",{endsWith:function(t){var n=o(this,t,u),r=arguments.length>1?arguments[1]:void 0,e=i(n.length),f=void 0===r?e:Math.min(i(r),e),a=String(t);return c?c.call(n,a,f):n.slice(f-a.length,f)===a}})},function(t,n,r){"use strict";r(29)("fixed",function(t){return function(){return t(this,"tt","","")}})},function(t,n,r){"use strict";r(29)("fontcolor",function(t){return function(n){return t(this,"font","color",n)}})},function(t,n,r){"use strict";r(29)("fontsize",function(t){return function(n){return t(this,"font","size",n)}})},function(t,n,r){var e=r(1),i=r(75),o=String.fromCharCode,u=String.fromCodePoint;e(e.S+e.F*(!!u&&1!=u.length),"String",{fromCodePoint:function(t){for(var n,r=[],e=arguments.length,u=0;e>u;){if(n=+arguments[u++],i(n,1114111)!==n)throw RangeError(n+" is not a valid code point");r.push(n<65536?o(n):o(55296+((n-=65536)>>10),n%1024+56320))}return r.join("")}})},function(t,n,r){"use strict";var e=r(1),i=r(148),o="includes";e(e.P+e.F*r(134)(o),"String",{includes:function(t){return!!~i(this,t,o).indexOf(t,arguments.length>1?arguments[1]:void 0)}})},function(t,n,r){"use strict";r(29)("italics",function(t){return function(){return t(this,"i","","")}})},function(t,n,r){"use strict";var e=r(147)(!0);r(140)(String,"String",function(t){this._t=String(t),this._i=0},function(){var t,n=this._t,r=this._i;return r>=n.length?{value:void 0,done:!0}:(t=e(n,r),this._i+=t.length,{value:t,done:!1})})},function(t,n,r){"use strict";r(29)("link",function(t){return function(n){return t(this,"a","href",n)}})},function(t,n,r){var e=r(1),i=r(30),o=r(16);e(e.S,"String",{raw:function(t){for(var n=i(t.raw),r=o(n.length),e=arguments.length,u=[],c=0;r>c;)u.push(String(n[c++])),c<e&&u.push(String(arguments[c]));return u.join("")}})},function(t,n,r){var e=r(1);e(e.P,"String",{repeat:r(149)})},function(t,n,r){"use strict";r(29)("small",function(t){return function(){return t(this,"small","","")}})},function(t,n,r){"use strict";var e=r(1),i=r(16),o=r(148),u="startsWith",c=""[u];e(e.P+e.F*r(134)(u),"String",{startsWith:function(t){var n=o(this,t,u),r=i(Math.min(arguments.length>1?arguments[1]:void 0,n.length)),e=String(t);return c?c.call(n,e,r):n.slice(r,r+e.length)===e}})},function(t,n,r){"use strict";r(29)("strike",function(t){return function(){return t(this,"strike","","")}})},function(t,n,r){"use strict";r(29)("sub",function(t){return function(){return t(this,"sub","","")}})},function(t,n,r){"use strict";r(29)("sup",function(t){return function(){return t(this,"sup","","")}})},function(t,n,r){"use strict";r(82)("trim",function(t){return function(){return t(this,3)}})},function(t,n,r){"use strict";var e=r(3),i=r(24),o=r(10),u=r(1),c=r(28),f=r(65).KEY,a=r(4),s=r(126),l=r(81),h=r(76),v=r(7),p=r(182),d=r(153),y=r(206),g=r(205),b=r(138),m=r(2),x=r(30),w=r(50),S=r(66),_=r(70),O=r(174),E=r(31),P=r(11),j=r(72),F=E.f,M=P.f,A=O.f,N=e.Symbol,T=e.JSON,I=T&&T.stringify,k="prototype",L=v("_hidden"),R=v("toPrimitive"),C={}.propertyIsEnumerable,D=s("symbol-registry"),U=s("symbols"),W=s("op-symbols"),G=Object[k],B="function"==typeof N,V=e.QObject,z=!V||!V[k]||!V[k].findChild,q=o&&a(function(){return 7!=_(M({},"a",{get:function(){return M(this,"a",{value:7}).a}})).a})?function(t,n,r){var e=F(G,n);e&&delete G[n],M(t,n,r),e&&t!==G&&M(G,n,e)}:M,K=function(t){var n=U[t]=_(N[k]);return n._k=t,n},J=B&&"symbol"==typeof N.iterator?function(t){return"symbol"==typeof t}:function(t){return t instanceof N},Y=function(t,n,r){return t===G&&Y(W,n,r),m(t),n=w(n,!0),m(r),i(U,n)?(r.enumerable?(i(t,L)&&t[L][n]&&(t[L][n]=!1),r=_(r,{enumerable:S(0,!1)})):(i(t,L)||M(t,L,S(1,{})),t[L][n]=!0),q(t,n,r)):M(t,n,r)},H=function(t,n){m(t);for(var r,e=g(n=x(n)),i=0,o=e.length;o>i;)Y(t,r=e[i++],n[r]);return t},$=function(t,n){return void 0===n?_(t):H(_(t),n)},X=function(t){var n=C.call(this,t=w(t,!0));return!(this===G&&i(U,t)&&!i(W,t))&&(!(n||!i(this,t)||!i(U,t)||i(this,L)&&this[L][t])||n)},Q=function(t,n){if(t=x(t),n=w(n,!0),t!==G||!i(U,n)||i(W,n)){var r=F(t,n);return!r||!i(U,n)||i(t,L)&&t[L][n]||(r.enumerable=!0),r}},Z=function(t){for(var n,r=A(x(t)),e=[],o=0;r.length>o;)i(U,n=r[o++])||n==L||n==f||e.push(n);return e},tt=function(t){for(var n,r=t===G,e=A(r?W:x(t)),o=[],u=0;e.length>u;)!i(U,n=e[u++])||r&&!i(G,n)||o.push(U[n]);return o};B||(N=function(){if(this instanceof N)throw TypeError("Symbol is not a constructor!");var t=h(arguments.length>0?arguments[0]:void 0),n=function(r){this===G&&n.call(W,r),i(this,L)&&i(this[L],t)&&(this[L][t]=!1),q(this,t,S(1,r))};return o&&z&&q(G,t,{configurable:!0,set:n}),K(t)},c(N[k],"toString",function(){return this._k}),E.f=Q,P.f=Y,r(71).f=O.f=Z,r(116).f=X,r(125).f=tt,o&&!r(69)&&c(G,"propertyIsEnumerable",X,!0),p.f=function(t){return K(v(t))}),u(u.G+u.W+u.F*!B,{Symbol:N});for(var nt="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),rt=0;nt.length>rt;)v(nt[rt++]);for(var nt=j(v.store),rt=0;nt.length>rt;)d(nt[rt++]);u(u.S+u.F*!B,"Symbol",{for:function(t){return i(D,t+="")?D[t]:D[t]=N(t)},keyFor:function(t){if(J(t))return y(D,t);throw TypeError(t+" is not a symbol!")},useSetter:function(){z=!0},useSimple:function(){z=!1}}),u(u.S+u.F*!B,"Object",{create:$,defineProperty:Y,defineProperties:H,getOwnPropertyDescriptor:Q,getOwnPropertyNames:Z,getOwnPropertySymbols:tt}),T&&u(u.S+u.F*(!B||a(function(){var t=N();return"[null]"!=I([t])||"{}"!=I({a:t})||"{}"!=I(Object(t))})),"JSON",{stringify:function(t){if(void 0!==t&&!J(t)){for(var n,r,e=[t],i=1;arguments.length>i;)e.push(arguments[i++]);return n=e[1],"function"==typeof n&&(r=n),!r&&b(n)||(n=function(t,n){if(r&&(n=r.call(this,t,n)),!J(n))return n}),e[1]=n,I.apply(T,e)}}}),N[k][R]||r(27)(N[k],R,N[k].valueOf),l(N,"Symbol"),l(Math,"Math",!0),l(e.JSON,"JSON",!0)},function(t,n,r){"use strict";var e=r(1),i=r(127),o=r(152),u=r(2),c=r(75),f=r(16),a=r(6),s=r(3).ArrayBuffer,l=r(146),h=o.ArrayBuffer,v=o.DataView,p=i.ABV&&s.isView,d=h.prototype.slice,y=i.VIEW,g="ArrayBuffer";e(e.G+e.W+e.F*(s!==h),{ArrayBuffer:h}),e(e.S+e.F*!i.CONSTR,g,{isView:function(t){return p&&p(t)||a(t)&&y in t}}),e(e.P+e.U+e.F*r(4)(function(){return!new h(2).slice(1,void 0).byteLength}),g,{slice:function(t,n){if(void 0!==d&&void 0===n)return d.call(u(this),t);for(var r=u(this).byteLength,e=c(t,r),i=c(void 0===n?r:n,r),o=new(l(this,h))(f(i-e)),a=new v(this),s=new v(o),p=0;e<i;)s.setUint8(p++,a.getUint8(e++));return o}}),r(74)(g)},function(t,n,r){var e=r(1);e(e.G+e.W+e.F*!r(127).ABV,{DataView:r(152).DataView})},function(t,n,r){r(55)("Float32",4,function(t){return function(n,r,e){return t(this,n,r,e)}})},function(t,n,r){r(55)("Float64",8,function(t){return function(n,r,e){return t(this,n,r,e)}})},function(t,n,r){r(55)("Int16",2,function(t){return function(n,r,e){return t(this,n,r,e)}})},function(t,n,r){r(55)("Int32",4,function(t){return function(n,r,e){return t(this,n,r,e)}})},function(t,n,r){r(55)("Int8",1,function(t){return function(n,r,e){return t(this,n,r,e)}})},function(t,n,r){r(55)("Uint16",2,function(t){return function(n,r,e){return t(this,n,r,e)}})},function(t,n,r){r(55)("Uint32",4,function(t){return function(n,r,e){return t(this,n,r,e)}})},function(t,n,r){r(55)("Uint8",1,function(t){return function(n,r,e){return t(this,n,r,e)}})},function(t,n,r){r(55)("Uint8",1,function(t){return function(n,r,e){return t(this,n,r,e)}},!0)},function(t,n,r){"use strict";var e=r(166);r(118)("WeakSet",function(t){return function(){return t(this,arguments.length>0?arguments[0]:void 0)}},{add:function(t){return e.def(this,t,!0)}},e,!1,!0)},function(t,n,r){"use strict";var e=r(1),i=r(117)(!0);e(e.P,"Array",{includes:function(t){return i(this,t,arguments.length>1?arguments[1]:void 0)}}),r(78)("includes")},function(t,n,r){var e=r(1),i=r(143)(),o=r(3).process,u="process"==r(45)(o);e(e.G,{asap:function(t){var n=u&&o.domain;i(n?n.bind(t):t)}})},function(t,n,r){var e=r(1),i=r(45);e(e.S,"Error",{isError:function(t){return"Error"===i(t)}})},function(t,n,r){var e=r(1);e(e.P+e.R,"Map",{toJSON:r(165)("Map")})},function(t,n,r){var e=r(1);e(e.S,"Math",{iaddh:function(t,n,r,e){var i=t>>>0,o=n>>>0,u=r>>>0;return o+(e>>>0)+((i&u|(i|u)&~(i+u>>>0))>>>31)|0}})},function(t,n,r){var e=r(1);e(e.S,"Math",{imulh:function(t,n){var r=65535,e=+t,i=+n,o=e&r,u=i&r,c=e>>16,f=i>>16,a=(c*u>>>0)+(o*u>>>16);return c*f+(a>>16)+((o*f>>>0)+(a&r)>>16)}})},function(t,n,r){var e=r(1);e(e.S,"Math",{isubh:function(t,n,r,e){var i=t>>>0,o=n>>>0,u=r>>>0;return o-(e>>>0)-((~i&u|~(i^u)&i-u>>>0)>>>31)|0}})},function(t,n,r){var e=r(1);e(e.S,"Math",{umulh:function(t,n){var r=65535,e=+t,i=+n,o=e&r,u=i&r,c=e>>>16,f=i>>>16,a=(c*u>>>0)+(o*u>>>16);return c*f+(a>>>16)+((o*f>>>0)+(a&r)>>>16)}})},function(t,n,r){"use strict";var e=r(1),i=r(17),o=r(26),u=r(11);r(10)&&e(e.P+r(124),"Object",{__defineGetter__:function(t,n){u.f(i(this),t,{get:o(n),enumerable:!0,configurable:!0})}})},function(t,n,r){"use strict";var e=r(1),i=r(17),o=r(26),u=r(11);r(10)&&e(e.P+r(124),"Object",{__defineSetter__:function(t,n){u.f(i(this),t,{set:o(n),enumerable:!0,configurable:!0})}})},function(t,n,r){var e=r(1),i=r(176)(!0);e(e.S,"Object",{entries:function(t){return i(t)}})},function(t,n,r){var e=r(1),i=r(177),o=r(30),u=r(31),c=r(131);e(e.S,"Object",{getOwnPropertyDescriptors:function(t){for(var n,r=o(t),e=u.f,f=i(r),a={},s=0;f.length>s;)c(a,n=f[s++],e(r,n));return a}})},function(t,n,r){"use strict";var e=r(1),i=r(17),o=r(50),u=r(32),c=r(31).f;r(10)&&e(e.P+r(124),"Object",{__lookupGetter__:function(t){var n,r=i(this),e=o(t,!0);do{if(n=c(r,e))return n.get}while(r=u(r))}})},function(t,n,r){"use strict";var e=r(1),i=r(17),o=r(50),u=r(32),c=r(31).f;r(10)&&e(e.P+r(124),"Object",{__lookupSetter__:function(t){var n,r=i(this),e=o(t,!0);do{if(n=c(r,e))return n.set}while(r=u(r))}})},function(t,n,r){var e=r(1),i=r(176)(!1);e(e.S,"Object",{values:function(t){return i(t)}})},function(t,n,r){"use strict";var e=r(1),i=r(3),o=r(52),u=r(143)(),c=r(7)("observable"),f=r(26),a=r(2),s=r(68),l=r(73),h=r(27),v=r(79),p=v.RETURN,d=function(t){return null==t?void 0:f(t)},y=function(t){var n=t._c;n&&(t._c=void 0,n())},g=function(t){return void 0===t._o},b=function(t){g(t)||(t._o=void 0,y(t))},m=function(t,n){a(t),this._c=void 0,this._o=t,t=new x(this);try{var r=n(t),e=r;null!=r&&("function"==typeof r.unsubscribe?r=function(){e.unsubscribe()}:f(r),this._c=r)}catch(n){return void t.error(n)}g(this)&&y(this)};m.prototype=l({},{unsubscribe:function(){b(this)}});var x=function(t){this._s=t};x.prototype=l({},{next:function(t){var n=this._s;if(!g(n)){var r=n._o;try{var e=d(r.next);if(e)return e.call(r,t)}catch(t){try{b(n)}finally{throw t}}}},error:function(t){var n=this._s;if(g(n))throw t;var r=n._o;n._o=void 0;try{var e=d(r.error);if(!e)throw t;t=e.call(r,t)}catch(t){try{y(n)}finally{throw t}}return y(n),t},complete:function(t){var n=this._s;if(!g(n)){var r=n._o;n._o=void 0;try{var e=d(r.complete);t=e?e.call(r,t):void 0}catch(t){try{y(n)}finally{throw t}}return y(n),t}}});var w=function(t){s(this,w,"Observable","_f")._f=f(t)};l(w.prototype,{subscribe:function(t){return new m(t,this._f)},forEach:function(t){var n=this;return new(o.Promise||i.Promise)(function(r,e){f(t);var i=n.subscribe({next:function(n){try{return t(n)}catch(t){e(t),i.unsubscribe()}},error:e,complete:r})})}}),l(w,{from:function(t){var n="function"==typeof this?this:w,r=d(a(t)[c]);if(r){var e=a(r.call(t));return e.constructor===n?e:new n(function(t){return e.subscribe(t)})}return new n(function(n){var r=!1;return u(function(){if(!r){try{if(v(t,!1,function(t){if(n.next(t),r)return p})===p)return}catch(t){if(r)throw t;return void n.error(t)}n.complete()}}),function(){r=!0}})},of:function(){for(var t=0,n=arguments.length,r=Array(n);t<n;)r[t]=arguments[t++];return new("function"==typeof this?this:w)(function(t){var n=!1;return u(function(){if(!n){for(var e=0;e<r.length;++e)if(t.next(r[e]),n)return;t.complete()}}),function(){n=!0}})}}),h(w.prototype,c,function(){return this}),e(e.G,{Observable:w}),r(74)("Observable")},function(t,n,r){var e=r(54),i=r(2),o=e.key,u=e.set;e.exp({defineMetadata:function(t,n,r,e){u(t,n,i(r),o(e))}})},function(t,n,r){var e=r(54),i=r(2),o=e.key,u=e.map,c=e.store;e.exp({deleteMetadata:function(t,n){var r=arguments.length<3?void 0:o(arguments[2]),e=u(i(n),r,!1);if(void 0===e||!e.delete(t))return!1;if(e.size)return!0;var f=c.get(n);return f.delete(r),!!f.size||c.delete(n)}})},function(t,n,r){var e=r(185),i=r(161),o=r(54),u=r(2),c=r(32),f=o.keys,a=o.key,s=function(t,n){var r=f(t,n),o=c(t);if(null===o)return r;var u=s(o,n);return u.length?r.length?i(new e(r.concat(u))):u:r};o.exp({getMetadataKeys:function(t){return s(u(t),arguments.length<2?void 0:a(arguments[1]))}})},function(t,n,r){var e=r(54),i=r(2),o=r(32),u=e.has,c=e.get,f=e.key,a=function(t,n,r){if(u(t,n,r))return c(t,n,r);var e=o(n);return null!==e?a(t,e,r):void 0};e.exp({getMetadata:function(t,n){return a(t,i(n),arguments.length<3?void 0:f(arguments[2]))}})},function(t,n,r){var e=r(54),i=r(2),o=e.keys,u=e.key;e.exp({getOwnMetadataKeys:function(t){
return o(i(t),arguments.length<2?void 0:u(arguments[1]))}})},function(t,n,r){var e=r(54),i=r(2),o=e.get,u=e.key;e.exp({getOwnMetadata:function(t,n){return o(t,i(n),arguments.length<3?void 0:u(arguments[2]))}})},function(t,n,r){var e=r(54),i=r(2),o=r(32),u=e.has,c=e.key,f=function(t,n,r){if(u(t,n,r))return!0;var e=o(n);return null!==e&&f(t,e,r)};e.exp({hasMetadata:function(t,n){return f(t,i(n),arguments.length<3?void 0:c(arguments[2]))}})},function(t,n,r){var e=r(54),i=r(2),o=e.has,u=e.key;e.exp({hasOwnMetadata:function(t,n){return o(t,i(n),arguments.length<3?void 0:u(arguments[2]))}})},function(t,n,r){var e=r(54),i=r(2),o=r(26),u=e.key,c=e.set;e.exp({metadata:function(t,n){return function(r,e){c(t,n,(void 0!==e?i:o)(r),u(e))}}})},function(t,n,r){var e=r(1);e(e.P+e.R,"Set",{toJSON:r(165)("Set")})},function(t,n,r){"use strict";var e=r(1),i=r(147)(!0);e(e.P,"String",{at:function(t){return i(this,t)}})},function(t,n,r){"use strict";var e=r(1),i=r(46),o=r(16),u=r(122),c=r(120),f=RegExp.prototype,a=function(t,n){this._r=t,this._s=n};r(139)(a,"RegExp String",function(){var t=this._r.exec(this._s);return{value:t,done:null===t}}),e(e.P,"String",{matchAll:function(t){if(i(this),!u(t))throw TypeError(t+" is not a regexp!");var n=String(this),r="flags"in f?String(t.flags):c.call(t),e=new RegExp(t.source,~r.indexOf("g")?r:"g"+r);return e.lastIndex=o(t.lastIndex),new a(e,n)}})},function(t,n,r){"use strict";var e=r(1),i=r(181);e(e.P,"String",{padEnd:function(t){return i(this,t,arguments.length>1?arguments[1]:void 0,!1)}})},function(t,n,r){"use strict";var e=r(1),i=r(181);e(e.P,"String",{padStart:function(t){return i(this,t,arguments.length>1?arguments[1]:void 0,!0)}})},function(t,n,r){"use strict";r(82)("trimLeft",function(t){return function(){return t(this,1)}},"trimStart")},function(t,n,r){"use strict";r(82)("trimRight",function(t){return function(){return t(this,2)}},"trimEnd")},function(t,n,r){r(153)("asyncIterator")},function(t,n,r){r(153)("observable")},function(t,n,r){var e=r(1);e(e.S,"System",{global:r(3)})},function(t,n,r){for(var e=r(155),i=r(28),o=r(3),u=r(27),c=r(80),f=r(7),a=f("iterator"),s=f("toStringTag"),l=c.Array,h=["NodeList","DOMTokenList","MediaList","StyleSheetList","CSSRuleList"],v=0;v<5;v++){var p,d=h[v],y=o[d],g=y&&y.prototype;if(g){g[a]||u(g,a,l),g[s]||u(g,s,d),c[d]=l;for(p in e)g[p]||i(g,p,e[p],!0)}}},function(t,n,r){var e=r(1),i=r(151);e(e.G+e.B,{setImmediate:i.set,clearImmediate:i.clear})},function(t,n,r){var e=r(3),i=r(1),o=r(121),u=r(207),c=e.navigator,f=!!c&&/MSIE .\./.test(c.userAgent),a=function(t){return f?function(n,r){return t(o(u,[].slice.call(arguments,2),"function"==typeof n?n:Function(n)),r)}:t};i(i.G+i.B+i.F*f,{setTimeout:a(e.setTimeout),setInterval:a(e.setInterval)})},function(t,n,r){r(330),r(269),r(271),r(270),r(273),r(275),r(280),r(274),r(272),r(282),r(281),r(277),r(278),r(276),r(268),r(279),r(283),r(284),r(236),r(238),r(237),r(286),r(285),r(256),r(266),r(267),r(257),r(258),r(259),r(260),r(261),r(262),r(263),r(264),r(265),r(239),r(240),r(241),r(242),r(243),r(244),r(245),r(246),r(247),r(248),r(249),r(250),r(251),r(252),r(253),r(254),r(255),r(317),r(322),r(329),r(320),r(312),r(313),r(318),r(323),r(325),r(308),r(309),r(310),r(311),r(314),r(315),r(316),r(319),r(321),r(324),r(326),r(327),r(328),r(231),r(233),r(232),r(235),r(234),r(220),r(218),r(224),r(221),r(227),r(229),r(217),r(223),r(214),r(228),r(212),r(226),r(225),r(219),r(222),r(211),r(213),r(216),r(215),r(230),r(155),r(302),r(307),r(184),r(303),r(304),r(305),r(306),r(287),r(183),r(185),r(186),r(342),r(331),r(332),r(337),r(340),r(341),r(335),r(338),r(336),r(339),r(333),r(334),r(288),r(289),r(290),r(291),r(292),r(295),r(293),r(294),r(296),r(297),r(298),r(299),r(301),r(300),r(343),r(369),r(372),r(371),r(373),r(374),r(370),r(375),r(376),r(354),r(357),r(353),r(351),r(352),r(355),r(356),r(346),r(368),r(377),r(345),r(347),r(349),r(348),r(350),r(359),r(360),r(362),r(361),r(364),r(363),r(365),r(366),r(367),r(344),r(358),r(380),r(379),r(378),t.exports=r(52)},function(t,n){function r(t,n){if("string"==typeof n)return t.insertAdjacentHTML("afterend",n);var r=t.nextSibling;return r?t.parentNode.insertBefore(n,r):t.parentNode.appendChild(n)}t.exports=r},,,,,,,,,function(t,n,r){(function(n,r){!function(n){"use strict";function e(t,n,r,e){var i=n&&n.prototype instanceof o?n:o,u=Object.create(i.prototype),c=new p(e||[]);return u._invoke=s(t,r,c),u}function i(t,n,r){try{return{type:"normal",arg:t.call(n,r)}}catch(t){return{type:"throw",arg:t}}}function o(){}function u(){}function c(){}function f(t){["next","throw","return"].forEach(function(n){t[n]=function(t){return this._invoke(n,t)}})}function a(t){function n(r,e,o,u){var c=i(t[r],t,e);if("throw"!==c.type){var f=c.arg,a=f.value;return a&&"object"==typeof a&&m.call(a,"__await")?Promise.resolve(a.__await).then(function(t){n("next",t,o,u)},function(t){n("throw",t,o,u)}):Promise.resolve(a).then(function(t){f.value=t,o(f)},u)}u(c.arg)}function e(t,r){function e(){return new Promise(function(e,i){n(t,r,e,i)})}return o=o?o.then(e,e):e()}"object"==typeof r&&r.domain&&(n=r.domain.bind(n));var o;this._invoke=e}function s(t,n,r){var e=P;return function(o,u){if(e===F)throw new Error("Generator is already running");if(e===M){if("throw"===o)throw u;return y()}for(r.method=o,r.arg=u;;){var c=r.delegate;if(c){var f=l(c,r);if(f){if(f===A)continue;return f}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(e===P)throw e=M,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);e=F;var a=i(t,n,r);if("normal"===a.type){if(e=r.done?M:j,a.arg===A)continue;return{value:a.arg,done:r.done}}"throw"===a.type&&(e=M,r.method="throw",r.arg=a.arg)}}}function l(t,n){var r=t.iterator[n.method];if(r===g){if(n.delegate=null,"throw"===n.method){if(t.iterator.return&&(n.method="return",n.arg=g,l(t,n),"throw"===n.method))return A;n.method="throw",n.arg=new TypeError("The iterator does not provide a 'throw' method")}return A}var e=i(r,t.iterator,n.arg);if("throw"===e.type)return n.method="throw",n.arg=e.arg,n.delegate=null,A;var o=e.arg;return o?o.done?(n[t.resultName]=o.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=g),n.delegate=null,A):o:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,A)}function h(t){var n={tryLoc:t[0]};1 in t&&(n.catchLoc=t[1]),2 in t&&(n.finallyLoc=t[2],n.afterLoc=t[3]),this.tryEntries.push(n)}function v(t){var n=t.completion||{};n.type="normal",delete n.arg,t.completion=n}function p(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(h,this),this.reset(!0)}function d(t){if(t){var n=t[w];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,e=function n(){for(;++r<t.length;)if(m.call(t,r))return n.value=t[r],n.done=!1,n;return n.value=g,n.done=!0,n};return e.next=e}}return{next:y}}function y(){return{value:g,done:!0}}var g,b=Object.prototype,m=b.hasOwnProperty,x="function"==typeof Symbol?Symbol:{},w=x.iterator||"@@iterator",S=x.asyncIterator||"@@asyncIterator",_=x.toStringTag||"@@toStringTag",O="object"==typeof t,E=n.regeneratorRuntime;if(E)return void(O&&(t.exports=E));E=n.regeneratorRuntime=O?t.exports:{},E.wrap=e;var P="suspendedStart",j="suspendedYield",F="executing",M="completed",A={},N={};N[w]=function(){return this};var T=Object.getPrototypeOf,I=T&&T(T(d([])));I&&I!==b&&m.call(I,w)&&(N=I);var k=c.prototype=o.prototype=Object.create(N);u.prototype=k.constructor=c,c.constructor=u,c[_]=u.displayName="GeneratorFunction",E.isGeneratorFunction=function(t){var n="function"==typeof t&&t.constructor;return!!n&&(n===u||"GeneratorFunction"===(n.displayName||n.name))},E.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,c):(t.__proto__=c,_ in t||(t[_]="GeneratorFunction")),t.prototype=Object.create(k),t},E.awrap=function(t){return{__await:t}},f(a.prototype),a.prototype[S]=function(){return this},E.AsyncIterator=a,E.async=function(t,n,r,i){var o=new a(e(t,n,r,i));return E.isGeneratorFunction(n)?o:o.next().then(function(t){return t.done?t.value:o.next()})},f(k),k[_]="Generator",k.toString=function(){return"[object Generator]"},E.keys=function(t){var n=[];for(var r in t)n.push(r);return n.reverse(),function r(){for(;n.length;){var e=n.pop();if(e in t)return r.value=e,r.done=!1,r}return r.done=!0,r}},E.values=d,p.prototype={constructor:p,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=g,this.done=!1,this.delegate=null,this.method="next",this.arg=g,this.tryEntries.forEach(v),!t)for(var n in this)"t"===n.charAt(0)&&m.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=g)},stop:function(){this.done=!0;var t=this.tryEntries[0],n=t.completion;if("throw"===n.type)throw n.arg;return this.rval},dispatchException:function(t){function n(n,e){return o.type="throw",o.arg=t,r.next=n,e&&(r.method="next",r.arg=g),!!e}if(this.done)throw t;for(var r=this,e=this.tryEntries.length-1;e>=0;--e){var i=this.tryEntries[e],o=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var u=m.call(i,"catchLoc"),c=m.call(i,"finallyLoc");if(u&&c){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(t,n){for(var r=this.tryEntries.length-1;r>=0;--r){var e=this.tryEntries[r];if(e.tryLoc<=this.prev&&m.call(e,"finallyLoc")&&this.prev<e.finallyLoc){var i=e;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=n&&n<=i.finallyLoc&&(i=null);var o=i?i.completion:{};return o.type=t,o.arg=n,i?(this.method="next",this.next=i.finallyLoc,A):this.complete(o)},complete:function(t,n){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&n&&(this.next=n),A},finish:function(t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),v(r),A}},catch:function(t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc===t){var e=r.completion;if("throw"===e.type){var i=e.arg;v(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,n,r){return this.delegate={iterator:d(t),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=g),A}}}("object"==typeof n?n:"object"==typeof window?window:"object"==typeof self?self:this)}).call(n,function(){return this}(),r(158))}])</script><script src="/./main.0cf68a.js"></script><script>!function(){!function(e){var t=document.createElement("script");document.getElementsByTagName("body")[0].appendChild(t),t.setAttribute("src",e)}("/slider.e37972.js")}()</script>


<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


    
<div class="tools-col" q-class="show:isShow,hide:isShow|isFalse" q-on="click:stop(e)">
  <div class="tools-nav header-menu">
    
    
      
      
      
    
      
      
      
    
      
      
      
    
    

    <ul style="width: 70%">
    
    
      
      <li style="width: 33.333333333333336%" q-on="click: openSlider(e, 'innerArchive')"><a href="javascript:void(0)" q-class="active:innerArchive">所有文章</a></li>
      
        
      
      <li style="width: 33.333333333333336%" q-on="click: openSlider(e, 'friends')"><a href="javascript:void(0)" q-class="active:friends">友链</a></li>
      
        
      
      <li style="width: 33.333333333333336%" q-on="click: openSlider(e, 'aboutme')"><a href="javascript:void(0)" q-class="active:aboutme">关于我</a></li>
      
        
    </ul>
  </div>
  <div class="tools-wrap">
    
    	<section class="tools-section tools-section-all" q-show="innerArchive">
        <div class="search-wrap">
          <input class="search-ipt" q-model="search" type="text" placeholder="find something…">
          <i class="icon-search icon" q-show="search|isEmptyStr"></i>
          <i class="icon-close icon" q-show="search|isNotEmptyStr" q-on="click:clearChose(e)"></i>
        </div>
        <div class="widget tagcloud search-tag">
          <p class="search-tag-wording">tag:</p>
          <label class="search-switch">
            <input type="checkbox" q-on="click:toggleTag(e)" q-attr="checked:showTags">
          </label>
          <ul class="article-tag-list" q-show="showTags">
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color3">随笔</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color4">数据库</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color1">工具和环境</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color3">后端</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color5">编程语言</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color1">linux</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color3">前端</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color5">数据库#</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color4">about me</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color3">编程</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color1">计算机技术</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color3">数据结构与算法</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color4">分布式</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color5">工作日记</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color2">计算机专业课</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color3">数学</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color3">论文</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color3">默认</a>
              </li>
            
            <div class="clearfix"></div>
          </ul>
        </div>
        <ul class="search-ul">
          <p q-show="jsonFail" style="padding: 20px; font-size: 12px;">
            缺失模块。<br/>1、请确保node版本大于6.2<br/>2、在博客根目录（注意不是yilia根目录）执行以下命令：<br/> npm i hexo-generator-json-content --save<br/><br/>
            3、在根目录_config.yml里添加配置：
<pre style="font-size: 12px;" q-show="jsonFail">
  jsonContent:
    meta: false
    pages: false
    posts:
      title: true
      date: true
      path: true
      text: false
      raw: false
      content: false
      slug: false
      updated: false
      comments: false
      link: false
      permalink: false
      excerpt: false
      categories: false
      tags: true
</pre>
          </p>
          <li class="search-li" q-repeat="items" q-show="isShow">
            <a q-attr="href:path|urlformat" class="search-title"><i class="icon-quo-left icon"></i><span q-text="title"></span></a>
            <p class="search-time">
              <i class="icon-calendar icon"></i>
              <span q-text="date|dateformat"></span>
            </p>
            <p class="search-tag">
              <i class="icon-price-tags icon"></i>
              <span q-repeat="tags" q-on="click:choseTag(e, name)" q-text="name|tagformat"></span>
            </p>
          </li>
        </ul>
    	</section>
    

    
    	<section class="tools-section tools-section-friends" q-show="friends">
  		
        <ul class="search-ul">
          
            <li class="search-li">
              <a href="http://localhost:4000/" target="_blank" class="search-title"><i class="icon-quo-left icon"></i>友情链接1</a>
            </li>
          
            <li class="search-li">
              <a href="http://localhost:4000/" target="_blank" class="search-title"><i class="icon-quo-left icon"></i>友情链接2</a>
            </li>
          
            <li class="search-li">
              <a href="http://localhost:4000/" target="_blank" class="search-title"><i class="icon-quo-left icon"></i>友情链接3</a>
            </li>
          
            <li class="search-li">
              <a href="http://localhost:4000/" target="_blank" class="search-title"><i class="icon-quo-left icon"></i>友情链接4</a>
            </li>
          
            <li class="search-li">
              <a href="http://localhost:4000/" target="_blank" class="search-title"><i class="icon-quo-left icon"></i>友情链接5</a>
            </li>
          
            <li class="search-li">
              <a href="http://localhost:4000/" target="_blank" class="search-title"><i class="icon-quo-left icon"></i>友情链接6</a>
            </li>
          
        </ul>
  		
    	</section>
    

    
    	<section class="tools-section tools-section-me" q-show="aboutme">
  	  	
  	  		<div class="aboutme-wrap" id="js-aboutme">很惭愧&lt;br&gt;&lt;br&gt;只做了一点微小的工作&lt;br&gt;谢谢大家</div>
  	  	
    	</section>
    
  </div>
  
</div>
    <!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" style="display:none" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div> 
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>
  </div>
</body>
</html>